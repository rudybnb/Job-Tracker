{"file_contents":{"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/clock-in-widget.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Clock, MapPin } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\n\ninterface ClockInWidgetProps {\n  isClockedIn: boolean;\n  currentSite?: string;\n  clockInTime?: string;\n  onClockIn?: () => void;\n  onClockOut?: () => void;\n}\n\nexport function ClockInWidget({\n  isClockedIn,\n  currentSite,\n  clockInTime,\n  onClockIn,\n  onClockOut,\n}: ClockInWidgetProps) {\n  const [currentTime, setCurrentTime] = useState(new Date());\n  const [duration, setDuration] = useState(\"0h 0m\");\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(new Date());\n\n      if (isClockedIn && clockInTime) {\n        const start = new Date();\n        const [hours, minutes] = clockInTime.split(\":\");\n        start.setHours(parseInt(hours), parseInt(minutes), 0);\n        const diff = new Date().getTime() - start.getTime();\n        const h = Math.floor(diff / 1000 / 60 / 60);\n        const m = Math.floor((diff / 1000 / 60) % 60);\n        setDuration(`${h}h ${m}m`);\n      }\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [isClockedIn, clockInTime]);\n\n  return (\n    <Card data-testid=\"clock-in-widget\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg\">Time Clock</CardTitle>\n          {isClockedIn && (\n            <Badge className=\"bg-chart-5/10 text-chart-5 border-chart-5/20\" variant=\"outline\">\n              <div className=\"w-2 h-2 rounded-full bg-chart-5 animate-pulse mr-2\" />\n              Clocked In\n            </Badge>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"text-center py-4\">\n          <p className=\"text-5xl font-bold font-mono\">\n            {currentTime.toLocaleTimeString(\"en-GB\", {\n              hour: \"2-digit\",\n              minute: \"2-digit\",\n            })}\n          </p>\n          <p className=\"text-sm text-muted-foreground mt-2\">\n            {currentTime.toLocaleDateString(\"en-GB\", {\n              weekday: \"long\",\n              day: \"numeric\",\n              month: \"long\",\n              year: \"numeric\",\n            })}\n          </p>\n        </div>\n\n        {isClockedIn && (\n          <div className=\"bg-card rounded-lg p-4 space-y-2 border\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm text-muted-foreground\">Clock In Time</span>\n              <span className=\"font-mono font-medium\">{clockInTime}</span>\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm text-muted-foreground\">Duration</span>\n              <span className=\"font-mono font-medium\">{duration}</span>\n            </div>\n            {currentSite && (\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground pt-2 border-t\">\n                <MapPin className=\"h-3 w-3\" />\n                <span>{currentSite}</span>\n              </div>\n            )}\n          </div>\n        )}\n\n        <Button\n          size=\"lg\"\n          className=\"w-full\"\n          variant={isClockedIn ? \"destructive\" : \"default\"}\n          onClick={isClockedIn ? onClockOut : onClockIn}\n          data-testid={isClockedIn ? \"button-clock-out\" : \"button-clock-in\"}\n        >\n          <Clock className=\"h-5 w-5 mr-2\" />\n          {isClockedIn ? \"Clock Out\" : \"Clock In\"}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":3615},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/App.tsx":{"content":"import { Switch, Route, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { ThemeProvider } from \"@/lib/theme-provider\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { RoleRedirect } from \"@/components/role-redirect\";\nimport { AuthWrapper } from \"@/components/auth-wrapper\";\nimport NotFound from \"@/pages/not-found\";\nimport Login from \"@/pages/login\";\n\nimport Dashboard from \"@/pages/dashboard\";\nimport Rota from \"@/pages/rota\";\nimport Attendance from \"@/pages/attendance\";\nimport Rooms from \"@/pages/rooms\";\nimport Payroll from \"@/pages/payroll\";\nimport Reports from \"@/pages/reports\";\nimport Queries from \"@/pages/queries\";\nimport Sites from \"@/pages/sites\";\nimport Directory from \"@/pages/directory\";\nimport Settings from \"@/pages/settings\";\nimport WorkerHome from \"@/pages/worker-home\";\nimport WorkerClock from \"@/pages/worker-clock\";\nimport WorkerPay from \"@/pages/worker-pay\";\nimport WorkerScan from \"@/pages/worker-scan\";\nimport WorkerProfile from \"@/pages/worker-profile\";\n\nfunction AdminLayout({ children }: { children: React.ReactNode }) {\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar />\n        <div className=\"flex flex-col flex-1\">\n          <header className=\"flex items-center justify-between p-4 border-b\">\n            <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n            <ThemeToggle />\n          </header>\n          <main className=\"flex-1 overflow-auto p-6\">{children}</main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction AdminDashboard() {\n  return (\n    <AdminLayout>\n      <Dashboard />\n    </AdminLayout>\n  );\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      {/* Public Login Route */}\n      <Route path=\"/login\" component={Login} />\n\n      {/* Protected Home Route - Auto-redirect based on role */}\n      <Route path=\"/\">\n        <AuthWrapper>\n          <RoleRedirect adminComponent={AdminDashboard} workerRedirect=\"/worker\" />\n        </AuthWrapper>\n      </Route>\n\n      {/* Protected Admin Routes */}\n      <Route path=\"/rota\">\n        <AuthWrapper>\n          <AdminLayout>\n            <Rota />\n          </AdminLayout>\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/attendance\">\n        <AuthWrapper>\n          <AdminLayout>\n            <Attendance />\n          </AdminLayout>\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/rooms\">\n        <AuthWrapper>\n          <AdminLayout>\n            <Rooms />\n          </AdminLayout>\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/payroll\">\n        <AuthWrapper>\n          <AdminLayout>\n            <Payroll />\n          </AdminLayout>\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/reports\">\n        <AuthWrapper>\n          <AdminLayout>\n            <Reports />\n          </AdminLayout>\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/queries\">\n        <AuthWrapper>\n          <AdminLayout>\n            <Queries />\n          </AdminLayout>\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/sites\">\n        <AuthWrapper>\n          <AdminLayout>\n            <Sites />\n          </AdminLayout>\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/directory\">\n        <AuthWrapper>\n          <AdminLayout>\n            <Directory />\n          </AdminLayout>\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/settings\">\n        <AuthWrapper>\n          <AdminLayout>\n            <Settings />\n          </AdminLayout>\n        </AuthWrapper>\n      </Route>\n\n      {/* Protected Worker Routes - Mobile-First */}\n      <Route path=\"/worker\">\n        <AuthWrapper>\n          <WorkerHome />\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/worker/clock\">\n        <AuthWrapper>\n          <WorkerClock />\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/worker/pay\">\n        <AuthWrapper>\n          <WorkerPay />\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/worker/scan\">\n        <AuthWrapper>\n          <WorkerScan />\n        </AuthWrapper>\n      </Route>\n      <Route path=\"/worker/profile\">\n        <AuthWrapper>\n          <WorkerProfile />\n        </AuthWrapper>\n      </Route>\n\n      {/* Fallback to 404 */}\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nexport default function App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n","size_bytes":4972},"replit.md":{"content":"# Workforce Management Platform - 3-Site System\n\n## Overview\n\nA comprehensive workforce management platform designed for managing operations across 3 care sites (Kent, London, Essex). The system handles staff scheduling (rota) with conflict detection, attendance tracking with manual clock-in/out and approval workflows, room monitoring via QR code scanning with time-expiring tokens, payroll processing with overtime calculation (1.5x after 8 hours per shift) and detailed breakdowns, and HR query management. Built with a focus on data clarity and efficient workflows for both administrative and worker interfaces.\n\n**Status**: Fully operational - all core features implemented and tested\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React with TypeScript using Vite as the build tool\n- **UI Framework**: Shadcn/ui component library built on Radix UI primitives\n- **Styling**: Tailwind CSS with custom design system following productivity/enterprise patterns\n- **State Management**: TanStack Query (React Query) for server state management\n- **Routing**: Wouter for lightweight client-side routing\n- **Design Approach**: Design system optimized for data-heavy enterprise applications with dual interfaces:\n  - Admin/Manager: Desktop-optimized with sidebar navigation\n  - Worker: Mobile-first with bottom navigation\n\n### Backend Architecture\n- **Runtime**: Node.js with Express.js framework\n- **Language**: TypeScript with ES modules\n- **API Design**: RESTful API following OpenAPI 3.0 patterns\n- **Authentication**: Replit Auth integration using OpenID Connect (OIDC)\n- **Session Management**: PostgreSQL-backed sessions using connect-pg-simple\n- **Validation**: Zod schemas for request/response validation\n- **Development**: Hot module replacement via Vite in development mode\n\n### Database Layer\n- **ORM**: Drizzle ORM for type-safe database operations\n- **Database**: PostgreSQL via Neon serverless (WebSocket-based connection pooling)\n- **Schema Management**: Drizzle Kit for migrations and schema management\n- **Connection Strategy**: Serverless-optimized connection pooling with WebSocket support\n\n### Core Data Models\nThe system is built around these primary entities:\n- **Sites**: 3 distinct locations with color-coding (purple/teal/orange) for visual identification\n- **Users**: Staff members (firstName, lastName) with roles (admin, site_manager, worker) and site assignments. Uses varchar UUID primary keys for OIDC compatibility\n- **Shifts**: Scheduled work periods with automatic conflict detection for overlapping times\n- **Attendance**: Clock-in/out records with approval workflow (pending/approved/rejected states)\n- **Rooms**: Physical spaces with time-expiring QR codes (10-minute validity, refreshable)\n- **Room Scans**: Visit logs with confidence scoring based on QR token freshness\n- **Payroll Runs**: Pay period processing with draft/processing/finalized states\n- **Payslips**: Detailed breakdowns with line items for regular hours, overtime (1.5x), and deductions\n- **Queries**: Support ticket system for pay/HR/scheduling questions with message threads\n\n### Security Architecture\n- **Authentication Flow**: Replit Auth with OpenID Connect\n- **Authorization**: Role-based access control (RBAC) with middleware guards\n- **Session Security**: HTTP-only secure cookies with 1-week TTL\n- **QR Token Security**: Time-expiring signed tokens for room access verification\n- **Data Isolation**: Site-scoped queries for multi-tenant data separation\n\n### Key Architectural Decisions\n\n**1. Dual Interface Pattern**\n- **Problem**: Different user roles (admin vs worker) have vastly different needs and contexts\n- **Solution**: Separate UI architectures - desktop sidebar for admins, mobile-first bottom navigation for workers\n- **Rationale**: Admins need information density and multi-tasking, workers need quick mobile access to essential functions\n\n**2. Replit Auth Integration**\n- **Problem**: Need secure authentication without managing user credentials\n- **Solution**: Leverage Replit's OpenID Connect provider with passport.js strategy\n- **Rationale**: Reduces security burden, provides seamless integration with Replit ecosystem\n- **Trade-offs**: Vendor lock-in to Replit platform, but gains managed authentication infrastructure\n\n**3. PostgreSQL with Drizzle ORM**\n- **Problem**: Need type-safe database operations with good developer experience\n- **Solution**: Drizzle ORM with Neon serverless PostgreSQL\n- **Rationale**: Type safety from database to frontend, serverless scaling, WebSocket-based pooling for edge deployment\n- **Alternatives Considered**: Prisma (more abstractions), raw SQL (less type safety)\n\n**4. Time-Expiring QR Codes for Room Scans**\n- **Problem**: Need to verify room visits while preventing QR code replay attacks\n- **Solution**: Rotating QR codes with expiry timestamps and confidence scoring\n- **Rationale**: Security through time-bound tokens, confidence degradation alerts staff to refresh codes\n- **Implementation**: QR codes expire and must be refreshed, with confidence scores based on remaining validity\n\n**5. Payroll Line-Item Architecture**\n- **Problem**: Staff need transparency on all pay components (regular hours, overtime, deductions with reasons)\n- **Solution**: Granular line-item breakdown in payslips with source shift references\n- **Rationale**: Reduces HR queries by providing self-service transparency\n- **Benefits**: Audit trail, dispute resolution, compliance reporting\n\n**6. Query/Ticket System with SLA Workflow**\n- **Problem**: Staff have questions about pay, schedules, HR matters\n- **Solution**: Integrated ticket system with category routing and status tracking\n- **Rationale**: Centralizes support requests, provides accountability and resolution tracking\n\n**7. Role-Based Automatic Routing**\n- **Problem**: Different user roles need different interfaces, but all login through same auth flow\n- **Solution**: Automatic redirect on home page (/) based on user role - workers→/worker, admins/managers→dashboard\n- **Rationale**: Provides appropriate interface automatically without manual navigation\n- **Implementation**: RoleRedirect component fetches user role from /api/auth/user and routes accordingly\n\n**8. Charcoal Dark Theme by Default**\n- **Problem**: Need consistent, professional appearance for workforce management\n- **Solution**: Dark charcoal theme (HSL 0 0% 12%) with purple primary, white text, gold/brown accents - default on all interfaces\n- **Rationale**: Reduces eye strain for long work sessions, professional appearance, high contrast (7:1) for accessibility\n- **Implementation**: ThemeProvider defaults to \"dark\" mode, users can toggle to light if preferred\n\n## External Dependencies\n\n### Third-Party Services\n- **Replit Auth**: OpenID Connect authentication provider\n- **Neon Database**: Serverless PostgreSQL hosting with WebSocket support\n\n### UI Component Libraries\n- **Radix UI**: Headless accessible component primitives (@radix-ui/react-*)\n- **Shadcn/ui**: Pre-built component library built on Radix UI\n- **Lucide React**: Icon library for consistent iconography\n\n### Development Tools\n- **Vite**: Build tool and development server\n- **Replit Vite Plugins**: Development banner, cartographer, runtime error overlay\n- **Drizzle Kit**: Database schema management and migrations\n\n### Data & Utilities\n- **TanStack Query**: Server state management and caching\n- **React Hook Form**: Form state management with Zod validation\n- **date-fns**: Date manipulation and formatting\n- **wouter**: Lightweight routing library\n\n### Styling & Theming\n- **Tailwind CSS**: Utility-first CSS framework\n- **class-variance-authority**: Component variant management\n- **tailwind-merge**: Intelligent class merging\n\n### Session & Storage\n- **connect-pg-simple**: PostgreSQL session store for Express\n- **express-session**: Session middleware\n\n### Implemented Features (October 2025)\nAll core features are fully operational:\n1. **Site Management**: CRUD operations for managing 3 sites with color identification\n2. **Staff Directory**: User management with role-based access control (admin/site_manager/worker)\n3. **Shift Scheduling**: Rota system with automatic conflict detection for overlapping shifts\n4. **Attendance Tracking**: Manual clock-in/out with approval workflows and duration calculation\n5. **Room Monitoring**: QR code generation with 10-minute expiry and scan logging with confidence scores\n6. **Payroll Processing**: Automated payroll runs with overtime calculation (1.5x after 8hrs), deductions, and detailed breakdowns\n7. **Query System**: Staff support ticket system with message threads and status tracking\n8. **Analytics Dashboard**: Reports showing hours summary, cost analysis, attendance metrics, and site performance\n9. **Mobile Worker Views**: Dedicated mobile-optimized interface for workers (home, clock, pay, scan, profile)\n\n### Future Integration Points\n- **Payroll Export**: CSV generation for Sage/Xero/BrightPay integration\n- **Biometric SDK**: Fingerprint device integration for kiosk clock-in\n- **Geofencing**: Location verification for clock-in/out events  \n- **SMS/Email**: Notification service for alerts and reminders\n- **Advanced Reporting**: Custom report builder with date ranges and filters\n\n### Testing Notes\n- Database uses firstName/lastName columns (not fullName)\n- OIDC testing: Auth middleware allows testing without expires_at validation\n- All SelectItems must have non-empty value props (Radix UI requirement)\n- Object Storage is pre-configured for QR code assets","size_bytes":9601},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/pages/queries.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Plus, MessageSquare, Clock, AlertCircle, CheckCircle, XCircle } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Query, QueryMessage, User } from \"@shared/schema\";\n\nconst createQuerySchema = z.object({\n  subject: z.string().min(1, \"Subject is required\"),\n  category: z.enum([\"pay\", \"hr\", \"scheduling\", \"other\"]),\n  priority: z.enum([\"low\", \"medium\", \"high\"]),\n  description: z.string().min(1, \"Description is required\"),\n});\n\ntype CreateQueryData = z.infer<typeof createQuerySchema>;\n\ntype QueryWithUser = Query & { user: User };\ntype QueryWithMessages = Query & { user: User; messages: (QueryMessage & { user: User })[] };\n\nconst categoryColors = {\n  pay: \"bg-emerald-500/10 text-emerald-500 border-emerald-500/20\",\n  hr: \"bg-blue-500/10 text-blue-500 border-blue-500/20\",\n  scheduling: \"bg-purple-500/10 text-purple-500 border-purple-500/20\",\n  other: \"bg-slate-500/10 text-slate-500 border-slate-500/20\",\n};\n\nconst statusColors = {\n  open: \"bg-amber-500/10 text-amber-500 border-amber-500/20\",\n  in_progress: \"bg-blue-500/10 text-blue-500 border-blue-500/20\",\n  closed: \"bg-slate-500/10 text-slate-500 border-slate-500/20\",\n};\n\nconst priorityColors = {\n  low: \"bg-slate-500/10 text-slate-500 border-slate-500/20\",\n  medium: \"bg-amber-500/10 text-amber-500 border-amber-500/20\",\n  high: \"bg-rose-500/10 text-rose-500 border-rose-500/20\",\n};\n\nconst statusIcons = {\n  open: Clock,\n  in_progress: AlertCircle,\n  closed: CheckCircle,\n};\n\nexport default function Queries() {\n  const [selectedQuery, setSelectedQuery] = useState<number | null>(null);\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [statusFilter, setStatusFilter] = useState<string>(\"open\");\n  const { user } = useAuth();\n  const { toast } = useToast();\n\n  const { data: queries = [], isLoading } = useQuery<QueryWithUser[]>({\n    queryKey: [\"/api/queries\", statusFilter],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (statusFilter !== \"all\") {\n        params.append(\"status\", statusFilter);\n      }\n      const response = await fetch(`/api/queries?${params}`);\n      if (!response.ok) throw new Error(\"Failed to fetch queries\");\n      return response.json();\n    },\n  });\n\n  const createForm = useForm<CreateQueryData>({\n    resolver: zodResolver(createQuerySchema),\n    defaultValues: {\n      subject: \"\",\n      category: \"pay\",\n      priority: \"medium\",\n      description: \"\",\n    },\n  });\n\n  const createQueryMutation = useMutation({\n    mutationFn: async (data: CreateQueryData) => {\n      return await apiRequest(\"POST\", \"/api/queries\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/queries\"] });\n      setCreateDialogOpen(false);\n      createForm.reset();\n      toast({\n        title: \"Query created\",\n        description: \"Your query has been submitted successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create query. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onCreateSubmit = (data: CreateQueryData) => {\n    createQueryMutation.mutate(data);\n  };\n\n  const getStatusIcon = (status: string) => {\n    const Icon = statusIcons[status as keyof typeof statusIcons] || Clock;\n    return <Icon className=\"h-3 w-3\" />;\n  };\n\n  const getInitials = (user: User) => {\n    if (user.firstName && user.lastName) {\n      return `${user.firstName[0]}${user.lastName[0]}`.toUpperCase();\n    }\n    return user.email?.[0]?.toUpperCase() || \"U\";\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">Staff Queries</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Pay, HR, and scheduling support tickets\n          </p>\n        </div>\n        <Dialog open={createDialogOpen} onOpenChange={setCreateDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-create-query\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Query\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\" data-testid=\"dialog-create-query\">\n            <DialogHeader>\n              <DialogTitle>Create New Query</DialogTitle>\n              <DialogDescription>\n                Submit a question about pay, HR, or scheduling\n              </DialogDescription>\n            </DialogHeader>\n            <Form {...createForm}>\n              <form onSubmit={createForm.handleSubmit(onCreateSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={createForm.control}\n                  name=\"subject\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Subject</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Brief description of your query\"\n                          data-testid=\"input-subject\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={createForm.control}\n                    name=\"category\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Category</FormLabel>\n                        <Select\n                          onValueChange={field.onChange}\n                          defaultValue={field.value}\n                        >\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-category\">\n                              <SelectValue placeholder=\"Select category\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"pay\">Pay</SelectItem>\n                            <SelectItem value=\"hr\">HR</SelectItem>\n                            <SelectItem value=\"scheduling\">Scheduling</SelectItem>\n                            <SelectItem value=\"other\">Other</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={createForm.control}\n                    name=\"priority\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Priority</FormLabel>\n                        <Select\n                          onValueChange={field.onChange}\n                          defaultValue={field.value}\n                        >\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-priority\">\n                              <SelectValue placeholder=\"Select priority\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"low\">Low</SelectItem>\n                            <SelectItem value=\"medium\">Medium</SelectItem>\n                            <SelectItem value=\"high\">High</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <FormField\n                  control={createForm.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Provide details about your query...\"\n                          className=\"min-h-32\"\n                          data-testid=\"textarea-description\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setCreateDialogOpen(false)}\n                    data-testid=\"button-cancel\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createQueryMutation.isPending}\n                    data-testid=\"button-submit-query\"\n                  >\n                    {createQueryMutation.isPending ? \"Creating...\" : \"Create Query\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Tabs value={statusFilter} onValueChange={setStatusFilter} className=\"w-full\">\n        <TabsList>\n          <TabsTrigger value=\"open\" data-testid=\"tab-open\">\n            Open\n          </TabsTrigger>\n          <TabsTrigger value=\"in_progress\" data-testid=\"tab-in-progress\">\n            In Progress\n          </TabsTrigger>\n          <TabsTrigger value=\"closed\" data-testid=\"tab-closed\">\n            Closed\n          </TabsTrigger>\n          <TabsTrigger value=\"all\" data-testid=\"tab-all\">\n            All\n          </TabsTrigger>\n        </TabsList>\n\n        <div className=\"mt-6\">\n          {isLoading ? (\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n              {[...Array(4)].map((_, i) => (\n                <Card key={i} className=\"animate-pulse\">\n                  <CardHeader className=\"space-y-2\">\n                    <div className=\"h-4 bg-muted rounded w-3/4\" />\n                    <div className=\"h-3 bg-muted rounded w-1/2\" />\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"h-3 bg-muted rounded w-full\" />\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : queries.length === 0 ? (\n            <Card>\n              <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                <MessageSquare className=\"h-12 w-12 text-muted-foreground mb-4\" />\n                <p className=\"text-muted-foreground\">\n                  No queries found for this status\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n              {queries.map((query) => (\n                <Card\n                  key={query.id}\n                  className=\"hover-elevate cursor-pointer\"\n                  onClick={() => setSelectedQuery(query.id)}\n                  data-testid={`card-query-${query.id}`}\n                >\n                  <CardHeader className=\"space-y-0 pb-2\">\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"flex-1 min-w-0\">\n                        <CardTitle className=\"text-base line-clamp-1\">\n                          {query.subject}\n                        </CardTitle>\n                        <CardDescription className=\"mt-1\">\n                          {query.user.firstName} {query.user.lastName} •{\" \"}\n                          {formatDistanceToNow(new Date(query.createdAt), { addSuffix: true })}\n                        </CardDescription>\n                      </div>\n                      <Badge\n                        variant=\"outline\"\n                        className={priorityColors[query.priority as keyof typeof priorityColors]}\n                        data-testid={`badge-priority-${query.id}`}\n                      >\n                        {query.priority}\n                      </Badge>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                      {query.description}\n                    </p>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge\n                        variant=\"outline\"\n                        className={categoryColors[query.category as keyof typeof categoryColors]}\n                        data-testid={`badge-category-${query.id}`}\n                      >\n                        {query.category}\n                      </Badge>\n                      <Badge\n                        variant=\"outline\"\n                        className={statusColors[query.status as keyof typeof statusColors]}\n                        data-testid={`badge-status-${query.id}`}\n                      >\n                        {getStatusIcon(query.status)}\n                        <span className=\"ml-1\">{query.status.replace(\"_\", \" \")}</span>\n                      </Badge>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </div>\n      </Tabs>\n\n      {selectedQuery && (\n        <QueryDetailDialog\n          queryId={selectedQuery}\n          onClose={() => setSelectedQuery(null)}\n          userRole={user?.role || \"worker\"}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction QueryDetailDialog({\n  queryId,\n  onClose,\n  userRole,\n}: {\n  queryId: number;\n  onClose: () => void;\n  userRole: string;\n}) {\n  const [replyMessage, setReplyMessage] = useState(\"\");\n  const { toast } = useToast();\n\n  const { data: query, isLoading } = useQuery<QueryWithMessages>({\n    queryKey: [\"/api/queries\", queryId],\n    queryFn: async () => {\n      const response = await fetch(`/api/queries/${queryId}`);\n      if (!response.ok) throw new Error(\"Failed to fetch query\");\n      return response.json();\n    },\n  });\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async (status: string) => {\n      return await apiRequest(\"PATCH\", `/api/queries/${queryId}/status`, { status });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/queries\"] });\n      toast({\n        title: \"Status updated\",\n        description: \"Query status has been updated successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update status. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updatePriorityMutation = useMutation({\n    mutationFn: async (priority: string) => {\n      return await apiRequest(\"PATCH\", `/api/queries/${queryId}/priority`, { priority });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/queries\"] });\n      toast({\n        title: \"Priority updated\",\n        description: \"Query priority has been updated successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update priority. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const addMessageMutation = useMutation({\n    mutationFn: async (message: string) => {\n      return await apiRequest(\"POST\", `/api/queries/${queryId}/messages`, { message });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/queries\", queryId] });\n      setReplyMessage(\"\");\n      toast({\n        title: \"Message sent\",\n        description: \"Your message has been added to the query.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to send message. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSendReply = () => {\n    if (replyMessage.trim()) {\n      addMessageMutation.mutate(replyMessage.trim());\n    }\n  };\n\n  const getInitials = (user: User) => {\n    if (user.firstName && user.lastName) {\n      return `${user.firstName[0]}${user.lastName[0]}`.toUpperCase();\n    }\n    return user.email?.[0]?.toUpperCase() || \"U\";\n  };\n\n  const canManageQuery = userRole === \"admin\" || userRole === \"site_manager\";\n\n  return (\n    <Dialog open={true} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh]\" data-testid=\"dialog-query-detail\">\n        {isLoading ? (\n          <div className=\"space-y-4 p-6\">\n            <div className=\"h-6 bg-muted rounded w-3/4 animate-pulse\" />\n            <div className=\"h-4 bg-muted rounded w-1/2 animate-pulse\" />\n          </div>\n        ) : query ? (\n          <div className=\"flex flex-col h-full\">\n            <DialogHeader>\n              <DialogTitle className=\"text-xl\">{query.subject}</DialogTitle>\n              <DialogDescription>\n                Created by {query.user.firstName} {query.user.lastName} •{\" \"}\n                {formatDistanceToNow(new Date(query.createdAt), { addSuffix: true })}\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className=\"flex items-center gap-2 my-4 flex-wrap\">\n              <Badge\n                variant=\"outline\"\n                className={categoryColors[query.category as keyof typeof categoryColors]}\n              >\n                {query.category}\n              </Badge>\n              <Badge\n                variant=\"outline\"\n                className={statusColors[query.status as keyof typeof statusColors]}\n              >\n                {query.status.replace(\"_\", \" \")}\n              </Badge>\n              <Badge\n                variant=\"outline\"\n                className={priorityColors[query.priority as keyof typeof priorityColors]}\n              >\n                {query.priority}\n              </Badge>\n              {canManageQuery && (\n                <>\n                  <Select\n                    value={query.status}\n                    onValueChange={updateStatusMutation.mutate}\n                    disabled={updateStatusMutation.isPending}\n                  >\n                    <SelectTrigger className=\"w-auto\" data-testid=\"select-status\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"open\">Open</SelectItem>\n                      <SelectItem value=\"in_progress\">In Progress</SelectItem>\n                      <SelectItem value=\"closed\">Closed</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <Select\n                    value={query.priority}\n                    onValueChange={updatePriorityMutation.mutate}\n                    disabled={updatePriorityMutation.isPending}\n                  >\n                    <SelectTrigger className=\"w-auto\" data-testid=\"select-priority-update\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"low\">Low Priority</SelectItem>\n                      <SelectItem value=\"medium\">Medium Priority</SelectItem>\n                      <SelectItem value=\"high\">High Priority</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </>\n              )}\n            </div>\n\n            <Card className=\"mb-4\">\n              <CardContent className=\"pt-4\">\n                <p className=\"text-sm\">{query.description}</p>\n              </CardContent>\n            </Card>\n\n            <Separator className=\"my-2\" />\n\n            <div className=\"flex-1 min-h-0\">\n              <h3 className=\"font-medium mb-3\">Conversation</h3>\n              <ScrollArea className=\"h-[300px] pr-4\">\n                <div className=\"space-y-4\">\n                  {query.messages.map((message) => (\n                    <div key={message.id} className=\"flex gap-3\" data-testid={`message-${message.id}`}>\n                      <Avatar className=\"h-8 w-8\">\n                        <AvatarImage src={message.user.profileImageUrl || undefined} />\n                        <AvatarFallback>{getInitials(message.user)}</AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-baseline gap-2\">\n                          <span className=\"font-medium text-sm\">\n                            {message.user.firstName} {message.user.lastName}\n                          </span>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {formatDistanceToNow(new Date(message.createdAt), { addSuffix: true })}\n                          </span>\n                        </div>\n                        <p className=\"text-sm mt-1\">{message.message}</p>\n                      </div>\n                    </div>\n                  ))}\n                  {query.messages.length === 0 && (\n                    <p className=\"text-sm text-muted-foreground text-center py-8\">\n                      No messages yet. Start the conversation below.\n                    </p>\n                  )}\n                </div>\n              </ScrollArea>\n            </div>\n\n            <div className=\"mt-4 space-y-2\">\n              <Textarea\n                placeholder=\"Type your reply...\"\n                value={replyMessage}\n                onChange={(e) => setReplyMessage(e.target.value)}\n                className=\"min-h-20\"\n                data-testid=\"textarea-reply\"\n              />\n              <div className=\"flex justify-end\">\n                <Button\n                  onClick={handleSendReply}\n                  disabled={!replyMessage.trim() || addMessageMutation.isPending}\n                  data-testid=\"button-send-reply\"\n                >\n                  {addMessageMutation.isPending ? \"Sending...\" : \"Send Reply\"}\n                </Button>\n              </div>\n            </div>\n          </div>\n        ) : null}\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":23378},"client/src/components/room-scan-log.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Clock, MapPin, Smartphone } from \"lucide-react\";\n\ninterface RoomScanLogProps {\n  id: string;\n  roomName: string;\n  staffName: string;\n  timestamp: string;\n  confidence: number;\n  deviceId: string;\n  status: \"verified\" | \"low-confidence\" | \"failed\";\n}\n\nconst statusConfig = {\n  verified: { label: \"Verified\", className: \"bg-chart-5/10 text-chart-5 border-chart-5/20\" },\n  \"low-confidence\": {\n    label: \"Low Confidence\",\n    className: \"bg-chart-4/10 text-chart-4 border-chart-4/20\",\n  },\n  failed: { label: \"Failed\", className: \"bg-destructive/10 text-destructive border-destructive/20\" },\n};\n\nexport function RoomScanLog({\n  id,\n  roomName,\n  staffName,\n  timestamp,\n  confidence,\n  deviceId,\n  status,\n}: RoomScanLogProps) {\n  return (\n    <div\n      className=\"flex items-center justify-between p-3 border-b hover-elevate transition-all\"\n      data-testid={`room-scan-${id}`}\n    >\n      <div className=\"flex items-center gap-3 flex-1\">\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <MapPin className=\"h-3 w-3 text-muted-foreground\" />\n            <p className=\"font-medium text-sm truncate\">{roomName}</p>\n          </div>\n          <p className=\"text-xs text-muted-foreground truncate\">{staffName}</p>\n        </div>\n      </div>\n      <div className=\"flex items-center gap-4\">\n        <div className=\"text-right hidden md:block\">\n          <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n            <Clock className=\"h-3 w-3\" />\n            <span className=\"font-mono\">{timestamp}</span>\n          </div>\n        </div>\n        <div className=\"text-right hidden lg:block\">\n          <p className=\"text-xs text-muted-foreground\">Confidence</p>\n          <p className=\"font-mono text-sm\">{confidence}%</p>\n        </div>\n        <div className=\"hidden xl:block\">\n          <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n            <Smartphone className=\"h-3 w-3\" />\n            <span className=\"font-mono\">{deviceId}</span>\n          </div>\n        </div>\n        <Badge variant=\"outline\" className={statusConfig[status].className}>\n          {statusConfig[status].label}\n        </Badge>\n      </div>\n    </div>\n  );\n}\n","size_bytes":2290},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2066},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/lib/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState | undefined>(\n  undefined\n);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"dark\",\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(\"theme\") as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  return (\n    <ThemeProviderContext.Provider value={{ theme, setTheme }}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  return context;\n};\n","size_bytes":1121},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/app-sidebar.tsx":{"content":"import {\n  Calendar,\n  Clock,\n  DollarSign,\n  Home,\n  QrCode,\n  Settings,\n  BarChart3,\n  MessageSquare,\n  Users,\n  Building2,\n} from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport { Link, useLocation } from \"wouter\";\n\nconst adminMenuItems = [\n  { title: \"Overview\", url: \"/\", icon: Home },\n  { title: \"Rota\", url: \"/rota\", icon: Calendar },\n  { title: \"Attendance\", url: \"/attendance\", icon: Clock },\n  { title: \"Room Scans\", url: \"/rooms\", icon: QrCode },\n  { title: \"Payroll\", url: \"/payroll\", icon: DollarSign },\n  { title: \"Reports\", url: \"/reports\", icon: BarChart3 },\n  { title: \"Queries\", url: \"/queries\", icon: MessageSquare },\n];\n\nconst settingsItems = [\n  { title: \"Directory\", url: \"/directory\", icon: Users },\n  { title: \"Sites\", url: \"/sites\", icon: Building2 },\n  { title: \"Settings\", url: \"/settings\", icon: Settings },\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-4\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"h-8 w-8 rounded-md bg-primary flex items-center justify-center\">\n            <Building2 className=\"h-5 w-5 text-primary-foreground\" />\n          </div>\n          <div>\n            <h2 className=\"font-semibold text-sm\">Workforce</h2>\n            <p className=\"text-xs text-muted-foreground\">Management</p>\n          </div>\n        </div>\n      </SidebarHeader>\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>Main Menu</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {adminMenuItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`link-${item.title.toLowerCase().replace(/\\s/g, '-')}`}\n                  >\n                    <Link href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n        <SidebarGroup>\n          <SidebarGroupLabel>Administration</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {settingsItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`link-${item.title.toLowerCase().replace(/\\s/g, '-')}`}\n                  >\n                    <Link href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n      <SidebarFooter className=\"p-4\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"h-8 w-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-medium\">\n            AM\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm font-medium truncate\">Admin User</p>\n            <p className=\"text-xs text-muted-foreground truncate\">Site Manager</p>\n          </div>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","size_bytes":3815},"client/src/hooks/useAuth.ts":{"content":"// Following Replit Auth blueprint patterns for client-side auth\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","size_bytes":372},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  for (const domain of process.env.REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated()) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  // If no expires_at (e.g., in testing), just proceed\n  if (!user.expires_at) {\n    return next();\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n\nexport function hasRole(roles: string[]): RequestHandler {\n  return async (req, res, next) => {\n    const user = req.user as any;\n    if (!user || !user.claims) {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n\n    const userId = user.claims.sub;\n    const dbUser = await storage.getUser(userId);\n\n    if (!dbUser || !roles.includes(dbUser.role)) {\n      return res.status(403).json({ message: \"Forbidden\" });\n    }\n\n    next();\n  };\n}\n","size_bytes":4754},"client/src/components/examples/payslip-card.tsx":{"content":"import { PayslipCard } from \"../payslip-card\";\n\nexport default function PayslipCardExample() {\n  const lineItems = [\n    {\n      id: \"1\",\n      description: \"Base Pay\",\n      type: \"earning\" as const,\n      hours: 40,\n      rate: 12.5,\n      amount: 500,\n    },\n    {\n      id: \"2\",\n      description: \"Overtime (1.5x)\",\n      type: \"earning\" as const,\n      hours: 5,\n      rate: 18.75,\n      amount: 93.75,\n    },\n    {\n      id: \"3\",\n      description: \"PAYE Tax\",\n      type: \"deduction\" as const,\n      amount: 118.75,\n      reason: \"Income tax\",\n    },\n    {\n      id: \"4\",\n      description: \"National Insurance\",\n      type: \"deduction\" as const,\n      amount: 47.5,\n      reason: \"NI contributions\",\n    },\n  ];\n\n  return (\n    <div className=\"p-4 max-w-md\">\n      <PayslipCard\n        id=\"1\"\n        period=\"Week 15, 2025\"\n        site=\"Kent Site\"\n        grossPay={593.75}\n        deductions={166.25}\n        netPay={427.5}\n        lineItems={lineItems}\n        onDownload={() => console.log(\"Download payslip\")}\n      />\n    </div>\n  );\n}\n","size_bytes":1051},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/pages/directory.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertUserSchema, type InsertUser, type User, type Site } from \"@shared/schema\";\nimport { UserPlus, Edit2, Trash2, Filter } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { z } from \"zod\";\n\nconst roleOptions = [\n  { value: \"admin\", label: \"Admin\" },\n  { value: \"site_manager\", label: \"Site Manager\" },\n  { value: \"worker\", label: \"Worker\" },\n];\n\nconst userFormSchema = insertUserSchema.extend({\n  hourlyRate: z.string().optional().transform((val) => val ? val : undefined),\n});\n\nexport default function Directory() {\n  const { toast } = useToast();\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [editingUser, setEditingUser] = useState<User | null>(null);\n  const [filterRole, setFilterRole] = useState<string>(\"all\");\n  const [filterSite, setFilterSite] = useState<string>(\"all\");\n\n  const { data: users, isLoading: usersLoading } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: sites, isLoading: sitesLoading } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertUser) => {\n      return await apiRequest(\"POST\", \"/api/users\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setIsCreateOpen(false);\n      toast({\n        title: \"Success\",\n        description: \"User created successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create user\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<InsertUser> }) => {\n      return await apiRequest(\"PATCH\", `/api/users/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setEditingUser(null);\n      toast({\n        title: \"Success\",\n        description: \"User updated successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update user\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"DELETE\", `/api/users/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"Success\",\n        description: \"User deactivated successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to deactivate user\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const form = useForm<z.infer<typeof userFormSchema>>({\n    resolver: zodResolver(userFormSchema),\n    defaultValues: {\n      email: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      role: \"worker\",\n      siteId: undefined,\n      hourlyRate: \"\",\n      isActive: true,\n    },\n  });\n\n  const onSubmit = (data: z.infer<typeof userFormSchema>) => {\n    const submitData: any = {\n      ...data,\n      hourlyRate: data.hourlyRate ? data.hourlyRate : undefined,\n    };\n\n    if (editingUser) {\n      updateMutation.mutate({ id: editingUser.id, data: submitData });\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const handleEdit = (user: User) => {\n    setEditingUser(user);\n    form.reset({\n      email: user.email || \"\",\n      firstName: user.firstName || \"\",\n      lastName: user.lastName || \"\",\n      role: user.role,\n      siteId: user.siteId || undefined,\n      hourlyRate: user.hourlyRate || \"\",\n      isActive: user.isActive,\n    });\n  };\n\n  const handleDelete = (userId: string) => {\n    if (confirm(\"Are you sure you want to deactivate this user?\")) {\n      deleteMutation.mutate(userId);\n    }\n  };\n\n  const handleCloseDialog = () => {\n    if (editingUser) {\n      setEditingUser(null);\n    } else {\n      setIsCreateOpen(false);\n    }\n    form.reset({\n      email: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      role: \"worker\",\n      siteId: undefined,\n      hourlyRate: \"\",\n      isActive: true,\n    });\n  };\n\n  const getInitials = (firstName?: string | null, lastName?: string | null) => {\n    const first = firstName?.charAt(0) || \"\";\n    const last = lastName?.charAt(0) || \"\";\n    return (first + last).toUpperCase() || \"U\";\n  };\n\n  const getRoleBadgeVariant = (role: string) => {\n    switch (role) {\n      case \"admin\":\n        return \"default\";\n      case \"site_manager\":\n        return \"secondary\";\n      default:\n        return \"outline\";\n    }\n  };\n\n  const getSiteById = (siteId?: number | null) => {\n    if (!siteId || !sites) return null;\n    return sites.find((site) => site.id === siteId);\n  };\n\n  const filteredUsers = users?.filter((user) => {\n    if (filterRole !== \"all\" && user.role !== filterRole) return false;\n    if (filterSite !== \"all\" && user.siteId?.toString() !== filterSite) return false;\n    return true;\n  }) || [];\n\n  const isLoading = usersLoading || sitesLoading;\n\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\" data-testid=\"text-page-title\">\n            Staff Directory\n          </h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Manage your team members and their assignments\n          </p>\n        </div>\n        <Button\n          onClick={() => setIsCreateOpen(true)}\n          data-testid=\"button-create-user\"\n        >\n          <UserPlus className=\"h-4 w-4 mr-2\" />\n          Add Staff\n        </Button>\n      </div>\n\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex gap-4 items-center\">\n            <Filter className=\"h-4 w-4 text-muted-foreground\" />\n            <Select value={filterRole} onValueChange={setFilterRole}>\n              <SelectTrigger className=\"w-48\" data-testid=\"select-filter-role\">\n                <SelectValue placeholder=\"Filter by role\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Roles</SelectItem>\n                {roleOptions.map((role) => (\n                  <SelectItem key={role.value} value={role.value}>\n                    {role.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            <Select value={filterSite} onValueChange={setFilterSite}>\n              <SelectTrigger className=\"w-48\" data-testid=\"select-filter-site\">\n                <SelectValue placeholder=\"Filter by site\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Sites</SelectItem>\n                {sites?.map((site) => (\n                  <SelectItem key={site.id} value={site.id.toString()}>\n                    {site.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardContent className=\"p-0\">\n          {isLoading ? (\n            <div className=\"p-6 space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <div key={i} className=\"flex items-center gap-4\">\n                  <Skeleton className=\"h-10 w-10 rounded-full\" />\n                  <div className=\"space-y-2 flex-1\">\n                    <Skeleton className=\"h-4 w-32\" />\n                    <Skeleton className=\"h-3 w-48\" />\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : filteredUsers.length > 0 ? (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Staff Member</TableHead>\n                  <TableHead>Role</TableHead>\n                  <TableHead>Site</TableHead>\n                  <TableHead>Hourly Rate</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredUsers.map((user) => {\n                  const site = getSiteById(user.siteId);\n                  return (\n                    <TableRow key={user.id} data-testid={`row-user-${user.id}`}>\n                      <TableCell>\n                        <div className=\"flex items-center gap-3\">\n                          <Avatar>\n                            <AvatarImage src={user.profileImageUrl || undefined} />\n                            <AvatarFallback>\n                              {getInitials(user.firstName, user.lastName)}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <div className=\"font-medium\" data-testid={`text-user-name-${user.id}`}>\n                              {user.firstName} {user.lastName}\n                            </div>\n                            <div className=\"text-xs text-muted-foreground\" data-testid={`text-user-email-${user.id}`}>\n                              {user.email}\n                            </div>\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={getRoleBadgeVariant(user.role)} data-testid={`badge-role-${user.id}`}>\n                          {roleOptions.find((r) => r.value === user.role)?.label || user.role}\n                        </Badge>\n                      </TableCell>\n                      <TableCell data-testid={`text-site-${user.id}`}>\n                        {site ? site.name : \"-\"}\n                      </TableCell>\n                      <TableCell className=\"font-mono\" data-testid={`text-rate-${user.id}`}>\n                        {user.hourlyRate ? `£${user.hourlyRate}/hr` : \"-\"}\n                      </TableCell>\n                      <TableCell data-testid={`text-status-${user.id}`}>\n                        <Badge variant={user.isActive ? \"default\" : \"outline\"}>\n                          {user.isActive ? \"Active\" : \"Inactive\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex justify-end gap-2\">\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => handleEdit(user)}\n                            data-testid={`button-edit-user-${user.id}`}\n                          >\n                            <Edit2 className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => handleDelete(user.id)}\n                            data-testid={`button-delete-user-${user.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          ) : (\n            <div className=\"p-12 text-center\">\n              <div className=\"mx-auto h-12 w-12 rounded-full bg-muted flex items-center justify-center\">\n                <UserPlus className=\"h-6 w-6 text-muted-foreground\" />\n              </div>\n              <h3 className=\"font-medium mt-4\">No staff members found</h3>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                {filterRole !== \"all\" || filterSite !== \"all\"\n                  ? \"Try adjusting your filters\"\n                  : \"Get started by adding your first team member\"}\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={isCreateOpen || !!editingUser} onOpenChange={handleCloseDialog}>\n        <DialogContent data-testid=\"dialog-user-form\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingUser ? \"Edit Staff Member\" : \"Add New Staff Member\"}\n            </DialogTitle>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"firstName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>First Name</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"John\"\n                          {...field}\n                          value={field.value || \"\"}\n                          data-testid=\"input-first-name\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"lastName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Last Name</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Doe\"\n                          {...field}\n                          value={field.value || \"\"}\n                          data-testid=\"input-last-name\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"email\"\n                        placeholder=\"john.doe@example.com\"\n                        {...field}\n                        value={field.value || \"\"}\n                        data-testid=\"input-email\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"role\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Role</FormLabel>\n                    <Select\n                      onValueChange={field.onChange}\n                      defaultValue={field.value}\n                    >\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-role\">\n                          <SelectValue placeholder=\"Select a role\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {roleOptions.map((role) => (\n                          <SelectItem key={role.value} value={role.value}>\n                            {role.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"siteId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Assigned Site</FormLabel>\n                    <Select\n                      onValueChange={(value) => field.onChange(value ? parseInt(value) : undefined)}\n                      value={field.value?.toString()}\n                    >\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-site\">\n                          <SelectValue placeholder=\"Select a site\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {sites?.map((site) => (\n                          <SelectItem key={site.id} value={site.id.toString()}>\n                            {site.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"hourlyRate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Hourly Rate (£)</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        placeholder=\"15.00\"\n                        {...field}\n                        value={field.value || \"\"}\n                        data-testid=\"input-hourly-rate\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={handleCloseDialog}\n                  data-testid=\"button-cancel\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending || updateMutation.isPending}\n                  data-testid=\"button-submit-user\"\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? \"Saving...\"\n                    : editingUser\n                    ? \"Update Staff\"\n                    : \"Add Staff\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":19268},"client/src/components/examples/worker-bottom-nav.tsx":{"content":"import { WorkerBottomNav } from \"../worker-bottom-nav\";\nimport { ThemeProvider } from \"@/lib/theme-provider\";\n\nexport default function WorkerBottomNavExample() {\n  return (\n    <ThemeProvider>\n      <div className=\"h-screen flex flex-col\">\n        <div className=\"flex-1 p-4\">\n          <p className=\"text-sm text-muted-foreground\">Content area</p>\n        </div>\n        <WorkerBottomNav />\n      </div>\n    </ThemeProvider>\n  );\n}\n","size_bytes":433},"client/src/components/examples/query-ticket.tsx":{"content":"import { QueryTicket } from \"../query-ticket\";\n\nexport default function QueryTicketExample() {\n  return (\n    <div className=\"grid grid-cols-1 gap-4 p-4 max-w-2xl\">\n      <QueryTicket\n        id=\"1\"\n        subject=\"Missing overtime payment\"\n        description=\"I worked 5 hours overtime last week but it's not showing in my payslip. Can someone check?\"\n        staffName=\"Sarah Johnson\"\n        category=\"pay\"\n        status=\"open\"\n        createdAt=\"2 hours ago\"\n        relatedTo=\"Week 15 Payslip\"\n        onClick={() => console.log(\"Ticket clicked\")}\n      />\n      <QueryTicket\n        id=\"2\"\n        subject=\"Holiday request approval\"\n        description=\"Submitted holiday request for next month but haven't received confirmation yet.\"\n        staffName=\"Mike Chen\"\n        category=\"hr\"\n        status=\"in-progress\"\n        createdAt=\"1 day ago\"\n        onClick={() => console.log(\"Ticket clicked\")}\n      />\n      <QueryTicket\n        id=\"3\"\n        subject=\"Shift swap request\"\n        description=\"Need to swap my Thursday shift with Emma. Both parties agreed.\"\n        staffName=\"David Brown\"\n        category=\"schedule\"\n        status=\"resolved\"\n        createdAt=\"3 days ago\"\n        onClick={() => console.log(\"Ticket clicked\")}\n      />\n    </div>\n  );\n}\n","size_bytes":1272},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/worker-bottom-nav.tsx":{"content":"import { Home, Clock, DollarSign, QrCode, User } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\n\nconst navItems = [\n  { title: \"Home\", url: \"/worker\", icon: Home },\n  { title: \"Clock\", url: \"/worker/clock\", icon: Clock },\n  { title: \"Pay\", url: \"/worker/pay\", icon: DollarSign },\n  { title: \"Scan\", url: \"/worker/scan\", icon: QrCode },\n  { title: \"Profile\", url: \"/worker/profile\", icon: User },\n];\n\nexport function WorkerBottomNav() {\n  const [location] = useLocation();\n\n  return (\n    <nav className=\"fixed bottom-0 left-0 right-0 bg-card border-t z-50 md:hidden\">\n      <div className=\"flex items-center justify-around\">\n        {navItems.map((item) => {\n          const isActive = location === item.url;\n          return (\n            <Link\n              key={item.title}\n              href={item.url}\n              className={`flex flex-col items-center gap-1 p-3 flex-1 transition-colors ${\n                isActive\n                  ? \"text-primary\"\n                  : \"text-muted-foreground hover:text-foreground\"\n              }`}\n              data-testid={`nav-${item.title.toLowerCase()}`}\n            >\n              <item.icon className=\"h-5 w-5\" />\n              <span className=\"text-xs font-medium\">{item.title}</span>\n            </Link>\n          );\n        })}\n      </div>\n    </nav>\n  );\n}\n","size_bytes":1332},"client/src/components/query-ticket.tsx":{"content":"import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { MessageSquare, Clock } from \"lucide-react\";\n\ninterface QueryTicketProps {\n  id: string;\n  subject: string;\n  description: string;\n  staffName: string;\n  category: \"pay\" | \"hr\" | \"schedule\" | \"general\";\n  status: \"open\" | \"in-progress\" | \"resolved\";\n  createdAt: string;\n  relatedTo?: string;\n  onClick?: () => void;\n}\n\nconst categoryColors = {\n  pay: \"bg-chart-1/10 text-chart-1 border-chart-1/20\",\n  hr: \"bg-chart-3/10 text-chart-3 border-chart-3/20\",\n  schedule: \"bg-chart-2/10 text-chart-2 border-chart-2/20\",\n  general: \"bg-secondary text-secondary-foreground\",\n};\n\nconst statusColors = {\n  open: \"bg-chart-4/10 text-chart-4 border-chart-4/20\",\n  \"in-progress\": \"bg-chart-1/10 text-chart-1 border-chart-1/20\",\n  resolved: \"bg-chart-5/10 text-chart-5 border-chart-5/20\",\n};\n\nexport function QueryTicket({\n  id,\n  subject,\n  description,\n  staffName,\n  category,\n  status,\n  createdAt,\n  relatedTo,\n  onClick,\n}: QueryTicketProps) {\n  return (\n    <Card\n      className=\"hover-elevate cursor-pointer transition-all\"\n      onClick={onClick}\n      data-testid={`query-ticket-${id}`}\n    >\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <h4 className=\"font-medium text-sm truncate\">{subject}</h4>\n            <p className=\"text-xs text-muted-foreground mt-1\">{staffName}</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Badge variant=\"outline\" className={categoryColors[category]}>\n              {category}\n            </Badge>\n            <Badge variant=\"outline\" className={statusColors[status]}>\n              {status.replace(\"-\", \" \")}\n            </Badge>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <p className=\"text-sm text-muted-foreground line-clamp-2 mb-3\">{description}</p>\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n            <Clock className=\"h-3 w-3\" />\n            <span>{createdAt}</span>\n          </div>\n          {relatedTo && (\n            <span className=\"text-xs text-muted-foreground\">\n              Related to: {relatedTo}\n            </span>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":2480},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"shared/schema.ts":{"content":"import { pgTable, text, integer, timestamp, boolean, decimal, jsonb, varchar, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { sql } from \"drizzle-orm\";\n\n// Session storage table (required for Replit Auth)\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Sites Table\nexport const sites = pgTable(\"sites\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: text(\"name\").notNull().unique(),\n  color: text(\"color\").notNull(), // purple, teal, orange\n  location: text(\"location\").notNull(),\n  clockInQrCode: text(\"clock_in_qr_code\").notNull().default(''), // QR code for clock-in verification\n  clockInQrExpiry: timestamp(\"clock_in_qr_expiry\"), // Expiry time for QR code\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertSiteSchema = createInsertSchema(sites).omit({\n  id: true,\n  createdAt: true,\n  clockInQrCode: true,\n  clockInQrExpiry: true,\n});\nexport type InsertSite = z.infer<typeof insertSiteSchema>;\nexport type Site = typeof sites.$inferSelect;\n\n// Users Table (compatible with Replit Auth)\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  role: text(\"role\").notNull().default(\"worker\"), // admin, site_manager, worker\n  siteId: integer(\"site_id\").references(() => sites.id),\n  hourlyRate: decimal(\"hourly_rate\", { precision: 10, scale: 2 }),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const upsertUserSchema = createInsertSchema(users).omit({\n  createdAt: true,\n  updatedAt: true,\n  role: true,\n  siteId: true,\n  hourlyRate: true,\n  isActive: true,\n});\nexport type UpsertUser = z.infer<typeof upsertUserSchema>;\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// Shifts Table\nexport const shifts = pgTable(\"shifts\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  siteId: integer(\"site_id\").notNull().references(() => sites.id),\n  date: text(\"date\").notNull(), // YYYY-MM-DD format\n  startTime: text(\"start_time\").notNull(), // HH:MM format\n  endTime: text(\"end_time\").notNull(), // HH:MM format\n  role: text(\"role\").notNull(),\n  status: text(\"status\").notNull().default(\"scheduled\"), // scheduled, in-progress, completed, cancelled, conflict\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertShiftSchema = createInsertSchema(shifts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertShift = z.infer<typeof insertShiftSchema>;\nexport type Shift = typeof shifts.$inferSelect;\n\n// Attendance Table\nexport const attendance = pgTable(\"attendance\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  siteId: integer(\"site_id\").notNull().references(() => sites.id),\n  shiftId: integer(\"shift_id\").references(() => shifts.id),\n  date: text(\"date\").notNull(), // YYYY-MM-DD format\n  clockIn: text(\"clock_in\").notNull(), // HH:MM format\n  clockOut: text(\"clock_out\"), // HH:MM format\n  approvalStatus: text(\"approval_status\").notNull().default(\"pending\"), // pending, approved, rejected\n  approvedBy: varchar(\"approved_by\").references(() => users.id),\n  approvedAt: timestamp(\"approved_at\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertAttendanceSchema = createInsertSchema(attendance).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertAttendance = z.infer<typeof insertAttendanceSchema>;\nexport type Attendance = typeof attendance.$inferSelect;\n\n// Rooms Table\nexport const rooms = pgTable(\"rooms\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: text(\"name\").notNull(),\n  siteId: integer(\"site_id\").notNull().references(() => sites.id),\n  qrCode: text(\"qr_code\").notNull(),\n  qrCodeExpiry: timestamp(\"qr_code_expiry\").notNull(),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertRoomSchema = createInsertSchema(rooms).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertRoom = z.infer<typeof insertRoomSchema>;\nexport type Room = typeof rooms.$inferSelect;\n\n// Room Scans Table\nexport const roomScans = pgTable(\"room_scans\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  roomId: integer(\"room_id\").notNull().references(() => rooms.id),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  scannedAt: timestamp(\"scanned_at\").notNull().defaultNow(),\n  deviceId: text(\"device_id\").notNull(),\n  confidence: integer(\"confidence\").notNull(), // 0-100\n  status: text(\"status\").notNull(), // verified, low-confidence, failed\n  location: jsonb(\"location\"), // {lat, lng} for geofencing\n  notes: text(\"notes\"),\n});\n\nexport const insertRoomScanSchema = createInsertSchema(roomScans).omit({\n  id: true,\n  scannedAt: true,\n});\nexport type InsertRoomScan = z.infer<typeof insertRoomScanSchema>;\nexport type RoomScan = typeof roomScans.$inferSelect;\n\n// Payroll Runs Table\nexport const payrollRuns = pgTable(\"payroll_runs\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  period: text(\"period\").notNull(), // \"Week 15, 2025\"\n  startDate: text(\"start_date\").notNull(), // YYYY-MM-DD\n  endDate: text(\"end_date\").notNull(), // YYYY-MM-DD\n  status: text(\"status\").notNull().default(\"draft\"), // draft, finalized, exported\n  createdBy: varchar(\"created_by\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  finalizedAt: timestamp(\"finalized_at\"),\n});\n\nexport const insertPayrollRunSchema = createInsertSchema(payrollRuns).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertPayrollRun = z.infer<typeof insertPayrollRunSchema>;\nexport type PayrollRun = typeof payrollRuns.$inferSelect;\n\n// Payslips Table\nexport const payslips = pgTable(\"payslips\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  payrollRunId: integer(\"payroll_run_id\").notNull().references(() => payrollRuns.id),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  siteId: integer(\"site_id\").notNull().references(() => sites.id),\n  grossPay: decimal(\"gross_pay\", { precision: 10, scale: 2 }).notNull(),\n  deductions: decimal(\"deductions\", { precision: 10, scale: 2 }).notNull(),\n  netPay: decimal(\"net_pay\", { precision: 10, scale: 2 }).notNull(),\n  lineItems: jsonb(\"line_items\").notNull(), // Array of {id, description, type, hours, rate, amount, reason}\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertPayslipSchema = createInsertSchema(payslips).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertPayslip = z.infer<typeof insertPayslipSchema>;\nexport type Payslip = typeof payslips.$inferSelect;\n\n// Queries Table (Support Tickets)\nexport const queries = pgTable(\"queries\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  subject: text(\"subject\").notNull(),\n  description: text(\"description\").notNull(),\n  category: text(\"category\").notNull(), // pay, hr, scheduling, other\n  priority: text(\"priority\").notNull().default(\"medium\"), // low, medium, high\n  status: text(\"status\").notNull().default(\"open\"), // open, in_progress, closed\n  relatedTo: text(\"related_to\"), // e.g., \"Week 15 Payslip\"\n  assignedTo: varchar(\"assigned_to\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertQuerySchema = createInsertSchema(queries).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertQuery = z.infer<typeof insertQuerySchema>;\nexport type Query = typeof queries.$inferSelect;\n\n// Query Messages Table (For ticket conversation threads)\nexport const queryMessages = pgTable(\"query_messages\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  queryId: integer(\"query_id\").notNull().references(() => queries.id),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  message: text(\"message\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertQueryMessageSchema = createInsertSchema(queryMessages).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertQueryMessage = z.infer<typeof insertQueryMessageSchema>;\nexport type QueryMessage = typeof queryMessages.$inferSelect;\n","size_bytes":9436},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/qr-scanner.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { QrCode, RefreshCw } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\ninterface QRScannerProps {\n  roomName: string;\n  roomId: number;\n  qrCode: string;\n  qrCodeExpiry: string;\n  onRefresh?: () => void;\n}\n\nexport function QRScanner({ roomName, roomId, qrCode, qrCodeExpiry, onRefresh }: QRScannerProps) {\n  const [timeLeft, setTimeLeft] = useState(0);\n\n  useEffect(() => {\n    const calculateTimeLeft = () => {\n      const expiryTime = new Date(qrCodeExpiry).getTime();\n      const now = Date.now();\n      const diff = Math.max(0, Math.floor((expiryTime - now) / 1000));\n      return diff;\n    };\n\n    setTimeLeft(calculateTimeLeft());\n\n    const interval = setInterval(() => {\n      const newTimeLeft = calculateTimeLeft();\n      setTimeLeft(newTimeLeft);\n      \n      if (newTimeLeft <= 0) {\n        onRefresh?.();\n      }\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [qrCodeExpiry, onRefresh]);\n\n  const minutes = Math.floor(timeLeft / 60);\n  const seconds = timeLeft % 60;\n\n  return (\n    <Card data-testid={`qr-scanner-${roomId}`}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg\">{roomName}</CardTitle>\n          <Badge variant=\"outline\" className=\"font-mono\">\n            {minutes}:{seconds.toString().padStart(2, \"0\")}\n          </Badge>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col items-center gap-4\">\n          <div className=\"w-64 h-64 bg-background border-2 border-border rounded-lg flex items-center justify-center\">\n            <QrCode className=\"h-48 w-48 text-muted-foreground\" />\n          </div>\n          <p className=\"text-xs text-muted-foreground text-center font-mono break-all max-w-64\">\n            {qrCode}\n          </p>\n          <Button\n            variant=\"outline\"\n            onClick={onRefresh}\n            className=\"w-full\"\n            data-testid={`button-refresh-qr-${roomId}`}\n          >\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            Generate New Code\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":2322},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/pages/worker-clock.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { WorkerBottomNav } from \"@/components/worker-bottom-nav\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Clock, MapPin, Calendar, CheckCircle2, XCircle, AlertCircle } from \"lucide-react\";\nimport { format, startOfWeek, endOfWeek } from \"date-fns\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { User, Site, Shift, Attendance } from \"@shared/schema\";\n\nexport default function WorkerClock() {\n  const { toast } = useToast();\n  const [currentTime, setCurrentTime] = useState(new Date());\n  const [notes, setNotes] = useState(\"\");\n  const [selectedSiteId, setSelectedSiteId] = useState<number | null>(null);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 1000);\n    return () => clearInterval(interval);\n  }, []);\n\n  const { data: user, isLoading: userLoading } = useQuery<User>({\n    queryKey: ['/api/auth/user'],\n  });\n\n  const { data: sites = [], isLoading: sitesLoading } = useQuery<Site[]>({\n    queryKey: ['/api/sites'],\n  });\n\n  const today = format(new Date(), 'yyyy-MM-dd');\n  const weekStart = format(startOfWeek(new Date(), { weekStartsOn: 1 }), 'yyyy-MM-dd');\n  const weekEnd = format(endOfWeek(new Date(), { weekStartsOn: 1 }), 'yyyy-MM-dd');\n\n  const { data: todayShifts = [], isLoading: shiftsLoading } = useQuery<Shift[]>({\n    queryKey: ['/api/shifts', { date: today, userId: user?.id }],\n    enabled: !!user,\n  });\n\n  const { data: weekAttendance = [], isLoading: attendanceLoading } = useQuery<Attendance[]>({\n    queryKey: ['/api/attendance', { userId: user?.id }],\n    enabled: !!user,\n  });\n\n  const currentShift = todayShifts.find(s => s.status === 'in-progress' || s.status === 'scheduled');\n  const todayAttendance = weekAttendance.filter(a => a.date === today);\n  const lastAttendance = todayAttendance.sort((a, b) => \n    new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n  )[0];\n  const isClockedIn = lastAttendance && !lastAttendance.clockOut;\n\n  const clockInMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedSiteId) {\n        throw new Error(\"Please select a site\");\n      }\n      return apiRequest('POST', '/api/attendance/clock-in', {\n        siteId: selectedSiteId,\n        shiftId: currentShift?.id,\n        notes: notes || undefined,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/attendance'] });\n      setNotes(\"\");\n      toast({\n        title: \"Clocked In\",\n        description: \"You have successfully clocked in\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const clockOutMutation = useMutation({\n    mutationFn: async () => {\n      if (!lastAttendance) {\n        throw new Error(\"No active clock-in found\");\n      }\n      return apiRequest('PATCH', `/api/attendance/${lastAttendance.id}/clock-out`, {\n        notes: notes || undefined,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/attendance'] });\n      setNotes(\"\");\n      toast({\n        title: \"Clocked Out\",\n        description: \"You have successfully clocked out\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const calculateDuration = (clockIn: string, clockOut?: string | null) => {\n    const start = new Date();\n    const [hours, minutes] = clockIn.split(\":\");\n    start.setHours(parseInt(hours), parseInt(minutes), 0);\n    \n    const end = clockOut ? (() => {\n      const e = new Date();\n      const [h, m] = clockOut.split(\":\");\n      e.setHours(parseInt(h), parseInt(m), 0);\n      return e;\n    })() : new Date();\n\n    const diff = end.getTime() - start.getTime();\n    const h = Math.floor(diff / 1000 / 60 / 60);\n    const m = Math.floor((diff / 1000 / 60) % 60);\n    return `${h}h ${m}m`;\n  };\n\n  if (userLoading || sitesLoading) {\n    return (\n      <div className=\"min-h-screen pb-20 md:pb-0\">\n        <div className=\"max-w-2xl mx-auto p-4 space-y-6\">\n          <Skeleton className=\"h-16 w-full\" />\n          <Skeleton className=\"h-64 w-full\" />\n        </div>\n        <WorkerBottomNav />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen pb-20 md:pb-0 bg-background\">\n      <div className=\"max-w-2xl mx-auto p-4 space-y-6\">\n        {/* Header */}\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-clock-title\">Time Clock</h1>\n          <p className=\"text-muted-foreground mt-1\" data-testid=\"text-clock-date\">\n            {format(currentTime, 'EEEE, d MMMM yyyy')}\n          </p>\n        </div>\n\n        {/* Clock Display */}\n        <Card className=\"border-2\" data-testid=\"card-clock-display\">\n          <CardContent className=\"p-8\">\n            <div className=\"text-center space-y-4\">\n              <div>\n                <p className=\"text-6xl font-bold font-mono\" data-testid=\"text-current-time\">\n                  {format(currentTime, 'HH:mm:ss')}\n                </p>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Current Time\n                </p>\n              </div>\n\n              {isClockedIn && lastAttendance && (\n                <div className=\"bg-card rounded-lg p-4 border space-y-2\">\n                  <div className=\"flex items-center justify-center gap-2\">\n                    <div className=\"w-2 h-2 rounded-full bg-chart-5 animate-pulse\" />\n                    <Badge className=\"bg-chart-5/10 text-chart-5 border-chart-5/20\" variant=\"outline\">\n                      Clocked In\n                    </Badge>\n                  </div>\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Clock In Time</span>\n                    <span className=\"font-mono font-medium\">{lastAttendance.clockIn}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Duration</span>\n                    <span className=\"font-mono font-medium\">\n                      {calculateDuration(lastAttendance.clockIn)}\n                    </span>\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Today's Shift Info */}\n        {currentShift && (\n          <Card data-testid=\"card-shift-info\">\n            <CardHeader>\n              <CardTitle className=\"text-base\">Today's Shift</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-2\">\n              <div className=\"flex items-center gap-2\">\n                <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"font-mono\">{currentShift.startTime} - {currentShift.endTime}</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n                <span>{currentShift.role}</span>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Clock In/Out Controls */}\n        <Card data-testid=\"card-clock-controls\">\n          <CardContent className=\"p-6 space-y-4\">\n            {!isClockedIn && (\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Select Site</label>\n                <Select \n                  value={selectedSiteId?.toString()} \n                  onValueChange={(value) => setSelectedSiteId(parseInt(value))}\n                  data-testid=\"select-site\"\n                >\n                  <SelectTrigger className=\"min-h-12\">\n                    <SelectValue placeholder=\"Choose a site\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {sites.filter(s => s.isActive).map(site => (\n                      <SelectItem key={site.id} value={site.id.toString()}>\n                        <div className=\"flex items-center gap-2\">\n                          <MapPin className=\"h-4 w-4\" />\n                          {site.name} - {site.location}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Notes (Optional)</label>\n              <Textarea\n                placeholder=\"Add any notes about your shift...\"\n                value={notes}\n                onChange={(e) => setNotes(e.target.value)}\n                className=\"min-h-20\"\n                data-testid=\"input-notes\"\n              />\n            </div>\n\n            <Button\n              size=\"lg\"\n              className=\"w-full min-h-14\"\n              variant={isClockedIn ? \"destructive\" : \"default\"}\n              onClick={() => isClockedIn ? clockOutMutation.mutate() : clockInMutation.mutate()}\n              disabled={clockInMutation.isPending || clockOutMutation.isPending || (!isClockedIn && !selectedSiteId)}\n              data-testid={isClockedIn ? \"button-clock-out-action\" : \"button-clock-in-action\"}\n            >\n              <Clock className=\"h-5 w-5 mr-2\" />\n              {isClockedIn ? \"Clock Out\" : \"Clock In\"}\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* This Week's Attendance */}\n        <Card data-testid=\"card-week-attendance\">\n          <CardHeader>\n            <CardTitle className=\"text-base\">This Week's Attendance</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {attendanceLoading ? (\n              <div className=\"space-y-2\">\n                <Skeleton className=\"h-16 w-full\" />\n                <Skeleton className=\"h-16 w-full\" />\n              </div>\n            ) : weekAttendance.length > 0 ? (\n              <div className=\"space-y-3\">\n                {weekAttendance\n                  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\n                  .map((record) => (\n                    <div\n                      key={record.id}\n                      className=\"flex items-start gap-3 p-3 rounded-lg border\"\n                      data-testid={`attendance-record-${record.id}`}\n                    >\n                      <Calendar className=\"h-5 w-5 text-muted-foreground mt-0.5\" />\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center justify-between mb-1\">\n                          <p className=\"font-medium text-sm\">\n                            {format(new Date(record.date), 'EEE, d MMM')}\n                          </p>\n                          {record.approvalStatus === 'approved' && (\n                            <CheckCircle2 className=\"h-4 w-4 text-chart-5\" />\n                          )}\n                          {record.approvalStatus === 'rejected' && (\n                            <XCircle className=\"h-4 w-4 text-destructive\" />\n                          )}\n                          {record.approvalStatus === 'pending' && (\n                            <AlertCircle className=\"h-4 w-4 text-chart-1\" />\n                          )}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground font-mono\">\n                          {record.clockIn} {record.clockOut ? `- ${record.clockOut}` : '(in progress)'}\n                        </p>\n                        {record.clockOut && (\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            Duration: {calculateDuration(record.clockIn, record.clockOut)}\n                          </p>\n                        )}\n                        {record.notes && (\n                          <p className=\"text-xs text-muted-foreground mt-1 italic\">\n                            {record.notes}\n                          </p>\n                        )}\n                      </div>\n                      <Badge \n                        variant=\"outline\" \n                        className={\n                          record.approvalStatus === 'approved'\n                            ? 'bg-chart-5/10 text-chart-5 border-chart-5/20'\n                            : record.approvalStatus === 'rejected'\n                            ? 'bg-destructive/10 text-destructive border-destructive/20'\n                            : ''\n                        }\n                      >\n                        {record.approvalStatus}\n                      </Badge>\n                    </div>\n                  ))}\n              </div>\n            ) : (\n              <p className=\"text-center py-8 text-sm text-muted-foreground\">\n                No attendance records this week\n              </p>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n      <WorkerBottomNav />\n    </div>\n  );\n}\n","size_bytes":13516},"client/src/components/attendance-row.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Clock, CheckCircle, XCircle } from \"lucide-react\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\n\ninterface AttendanceRowProps {\n  id: string;\n  staffName: string;\n  initials: string;\n  site: string;\n  clockIn: string;\n  clockOut?: string;\n  status: \"on-time\" | \"late\" | \"pending-approval\" | \"approved\" | \"rejected\";\n  duration?: string;\n  onApprove?: () => void;\n  onReject?: () => void;\n}\n\nconst statusConfig = {\n  \"on-time\": { label: \"On Time\", className: \"bg-chart-5/10 text-chart-5 border-chart-5/20\" },\n  late: { label: \"Late\", className: \"bg-chart-4/10 text-chart-4 border-chart-4/20\" },\n  \"pending-approval\": { label: \"Pending\", className: \"bg-secondary text-secondary-foreground\" },\n  approved: { label: \"Approved\", className: \"bg-chart-5/10 text-chart-5 border-chart-5/20\" },\n  rejected: { label: \"Rejected\", className: \"bg-destructive/10 text-destructive border-destructive/20\" },\n};\n\nexport function AttendanceRow({\n  id,\n  staffName,\n  initials,\n  site,\n  clockIn,\n  clockOut,\n  status,\n  duration,\n  onApprove,\n  onReject,\n}: AttendanceRowProps) {\n  return (\n    <div\n      className=\"flex items-center justify-between p-4 border-b hover-elevate transition-all\"\n      data-testid={`attendance-row-${id}`}\n    >\n      <div className=\"flex items-center gap-4 flex-1\">\n        <Avatar className=\"h-10 w-10\">\n          <AvatarFallback className=\"bg-primary text-primary-foreground text-sm\">\n            {initials}\n          </AvatarFallback>\n        </Avatar>\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"font-medium text-sm truncate\">{staffName}</p>\n          <p className=\"text-xs text-muted-foreground\">{site}</p>\n        </div>\n      </div>\n      <div className=\"flex items-center gap-4\">\n        <div className=\"text-right hidden md:block\">\n          <p className=\"text-xs text-muted-foreground\">Clock In</p>\n          <p className=\"font-mono text-sm\">{clockIn}</p>\n        </div>\n        <div className=\"text-right hidden md:block\">\n          <p className=\"text-xs text-muted-foreground\">Clock Out</p>\n          <p className=\"font-mono text-sm\">{clockOut || \"-\"}</p>\n        </div>\n        {duration && (\n          <div className=\"text-right hidden lg:block\">\n            <p className=\"text-xs text-muted-foreground\">Duration</p>\n            <p className=\"font-mono text-sm\">{duration}</p>\n          </div>\n        )}\n        <Badge variant=\"outline\" className={statusConfig[status].className}>\n          {statusConfig[status].label}\n        </Badge>\n        {status === \"pending-approval\" && (\n          <div className=\"flex gap-2\">\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              className=\"h-8 w-8\"\n              onClick={onApprove}\n              data-testid={`button-approve-${id}`}\n            >\n              <CheckCircle className=\"h-4 w-4 text-chart-5\" />\n            </Button>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              className=\"h-8 w-8\"\n              onClick={onReject}\n              data-testid={`button-reject-${id}`}\n            >\n              <XCircle className=\"h-4 w-4 text-destructive\" />\n            </Button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":3339},"client/src/pages/worker-home.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { WorkerBottomNav } from \"@/components/worker-bottom-nav\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Clock, Calendar, DollarSign, QrCode, MessageSquare, MapPin, AlertCircle } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { format, isToday } from \"date-fns\";\nimport type { User, Shift, Attendance, Payslip, Query } from \"@shared/schema\";\n\nexport default function WorkerHome() {\n  const { data: user, isLoading: userLoading } = useQuery<User>({\n    queryKey: ['/api/auth/user'],\n  });\n\n  const today = format(new Date(), 'yyyy-MM-dd');\n\n  const { data: todayShifts = [], isLoading: shiftsLoading } = useQuery<Shift[]>({\n    queryKey: ['/api/shifts', { date: today, userId: user?.id }],\n    enabled: !!user,\n  });\n\n  const { data: attendance = [], isLoading: attendanceLoading } = useQuery<Attendance[]>({\n    queryKey: ['/api/attendance', { userId: user?.id }],\n    enabled: !!user,\n  });\n\n  const { data: payslips = [], isLoading: payslipsLoading } = useQuery<Payslip[]>({\n    queryKey: ['/api/payslips', { userId: user?.id }],\n    enabled: !!user,\n  });\n\n  const { data: queries = [], isLoading: queriesLoading } = useQuery<Query[]>({\n    queryKey: ['/api/queries', { userId: user?.id }],\n    enabled: !!user,\n  });\n\n  const currentShift = todayShifts.find(s => s.status === 'in-progress' || s.status === 'scheduled');\n  const lastAttendance = attendance.sort((a, b) => \n    new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n  )[0];\n  const latestPayslip = payslips.sort((a, b) => \n    new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n  )[0];\n  const openQueries = queries.filter(q => q.status === 'open' || q.status === 'in_progress');\n\n  const isClockedIn = lastAttendance && !lastAttendance.clockOut;\n\n  const siteColors = {\n    purple: \"bg-chart-3/10 text-chart-3 border-chart-3/20\",\n    teal: \"bg-chart-2/10 text-chart-2 border-chart-2/20\",\n    orange: \"bg-chart-4/10 text-chart-4 border-chart-4/20\",\n  } as const;\n\n  const statusColors = {\n    scheduled: \"bg-secondary text-secondary-foreground\",\n    \"in-progress\": \"bg-chart-5/10 text-chart-5 border-chart-5/20\",\n    completed: \"bg-muted text-muted-foreground\",\n    conflict: \"bg-destructive/10 text-destructive border-destructive/20\",\n  } as const;\n\n  if (userLoading) {\n    return (\n      <div className=\"min-h-screen pb-20 md:pb-0\">\n        <div className=\"max-w-2xl mx-auto p-4 space-y-6\">\n          <Skeleton className=\"h-16 w-full\" />\n          <Skeleton className=\"h-48 w-full\" />\n          <Skeleton className=\"h-32 w-full\" />\n        </div>\n        <WorkerBottomNav />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen pb-20 md:pb-0 bg-background\">\n      <div className=\"max-w-2xl mx-auto p-4 space-y-6\">\n        {/* Welcome Header */}\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-welcome\">\n            Welcome back, {user?.firstName || 'Worker'}\n          </h1>\n          <p className=\"text-muted-foreground mt-1\" data-testid=\"text-date\">\n            {format(new Date(), 'EEEE, d MMMM yyyy')}\n          </p>\n        </div>\n\n        {/* Clock In/Out Quick Action */}\n        <Card className=\"border-2\" data-testid=\"card-clock-status\">\n          <CardContent className=\"p-6\">\n            {isClockedIn ? (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-3 h-3 rounded-full bg-chart-5 animate-pulse\" />\n                    <div>\n                      <p className=\"font-medium\">Currently Clocked In</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Since {lastAttendance.clockIn}\n                      </p>\n                    </div>\n                  </div>\n                  <Badge className=\"bg-chart-5/10 text-chart-5 border-chart-5/20\" variant=\"outline\">\n                    Active\n                  </Badge>\n                </div>\n                <Button \n                  variant=\"destructive\" \n                  size=\"lg\" \n                  className=\"w-full min-h-12\" \n                  asChild\n                  data-testid=\"button-clock-out\"\n                >\n                  <Link href=\"/worker/clock\">\n                    <Clock className=\"h-5 w-5 mr-2\" />\n                    Clock Out\n                  </Link>\n                </Button>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                <div className=\"text-center\">\n                  <Clock className=\"h-12 w-12 mx-auto text-muted-foreground mb-2\" />\n                  <p className=\"font-medium\">Ready to start your shift?</p>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    {currentShift ? `Shift starts at ${currentShift.startTime}` : 'No shift scheduled today'}\n                  </p>\n                </div>\n                <Button \n                  size=\"lg\" \n                  className=\"w-full min-h-12\" \n                  asChild\n                  data-testid=\"button-clock-in\"\n                >\n                  <Link href=\"/worker/clock\">\n                    <Clock className=\"h-5 w-5 mr-2\" />\n                    Clock In\n                  </Link>\n                </Button>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Today's Shift (if exists) */}\n        {currentShift && (\n          <Card data-testid=\"card-todays-shift\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Today's Shift</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                  <span className=\"font-mono font-medium\">\n                    {currentShift.startTime} - {currentShift.endTime}\n                  </span>\n                </div>\n                <Badge className={statusColors[currentShift.status as keyof typeof statusColors]} variant=\"outline\">\n                  {currentShift.status.replace('-', ' ')}\n                </Badge>\n              </div>\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <MapPin className=\"h-4 w-4\" />\n                <span>{currentShift.role}</span>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Quick Actions */}\n        <div className=\"space-y-3\">\n          <h2 className=\"text-lg font-semibold\">Quick Actions</h2>\n          \n          <Button \n            variant=\"outline\" \n            size=\"lg\" \n            className=\"w-full min-h-12 justify-start\" \n            asChild\n            data-testid=\"button-view-schedule\"\n          >\n            <Link href=\"/worker/clock\">\n              <Calendar className=\"h-5 w-5 mr-3\" />\n              View My Schedule\n            </Link>\n          </Button>\n\n          <Button \n            variant=\"outline\" \n            size=\"lg\" \n            className=\"w-full min-h-12 justify-start\" \n            asChild\n            data-testid=\"button-view-pay\"\n          >\n            <Link href=\"/worker/pay\">\n              <DollarSign className=\"h-5 w-5 mr-3\" />\n              View My Pay\n            </Link>\n          </Button>\n\n          <Button \n            variant=\"outline\" \n            size=\"lg\" \n            className=\"w-full min-h-12 justify-start\" \n            asChild\n            data-testid=\"button-scan-room\"\n          >\n            <Link href=\"/worker/scan\">\n              <QrCode className=\"h-5 w-5 mr-3\" />\n              Scan Room QR\n            </Link>\n          </Button>\n\n          <Button \n            variant=\"outline\" \n            size=\"lg\" \n            className=\"w-full min-h-12 justify-start\" \n            asChild\n            data-testid=\"button-submit-query\"\n          >\n            <Link href=\"/queries\">\n              <MessageSquare className=\"h-5 w-5 mr-3\" />\n              Submit Query\n              {openQueries.length > 0 && (\n                <Badge variant=\"destructive\" className=\"ml-auto\">\n                  {openQueries.length}\n                </Badge>\n              )}\n            </Link>\n          </Button>\n        </div>\n\n        {/* Recent Activity */}\n        <Card data-testid=\"card-recent-activity\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Recent Activity</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {/* Last Attendance */}\n            {lastAttendance && (\n              <div className=\"flex items-start gap-3 pb-3 border-b\">\n                <Clock className=\"h-5 w-5 text-muted-foreground mt-0.5\" />\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium\">Last Attendance</p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {format(new Date(lastAttendance.date), 'EEE, d MMM')} • {lastAttendance.clockIn}\n                    {lastAttendance.clockOut && ` - ${lastAttendance.clockOut}`}\n                  </p>\n                </div>\n                <Badge \n                  variant=\"outline\" \n                  className={\n                    lastAttendance.approvalStatus === 'approved' \n                      ? 'bg-chart-5/10 text-chart-5 border-chart-5/20'\n                      : lastAttendance.approvalStatus === 'rejected'\n                      ? 'bg-destructive/10 text-destructive border-destructive/20'\n                      : ''\n                  }\n                >\n                  {lastAttendance.approvalStatus}\n                </Badge>\n              </div>\n            )}\n\n            {/* Last Payslip */}\n            {latestPayslip && (\n              <div className=\"flex items-start gap-3 pb-3 border-b\">\n                <DollarSign className=\"h-5 w-5 text-muted-foreground mt-0.5\" />\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium\">Latest Payslip</p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Net Pay: £{Number(latestPayslip.netPay).toFixed(2)}\n                  </p>\n                </div>\n                <Button variant=\"ghost\" size=\"sm\" asChild data-testid=\"button-view-payslip\">\n                  <Link href=\"/worker/pay\">View</Link>\n                </Button>\n              </div>\n            )}\n\n            {/* Open Queries */}\n            {openQueries.length > 0 ? (\n              <div className=\"flex items-start gap-3\">\n                <AlertCircle className=\"h-5 w-5 text-chart-1 mt-0.5\" />\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium\">Open Queries</p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    You have {openQueries.length} open {openQueries.length === 1 ? 'query' : 'queries'}\n                  </p>\n                </div>\n                <Button variant=\"ghost\" size=\"sm\" asChild data-testid=\"button-view-queries\">\n                  <Link href=\"/queries\">View</Link>\n                </Button>\n              </div>\n            ) : (\n              <div className=\"text-center py-4 text-sm text-muted-foreground\">\n                No recent activity\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n      <WorkerBottomNav />\n    </div>\n  );\n}\n","size_bytes":11760},"client/src/pages/rooms.tsx":{"content":"import { QRScanner } from \"@/components/qr-scanner\";\nimport { RoomScanLog } from \"@/components/room-scan-log\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertRoomSchema, type Room, type Site, type RoomScan, type User } from \"@shared/schema\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Plus, Loader2 } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { format } from \"date-fns\";\n\nexport default function Rooms() {\n  const { toast } = useToast();\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n\n  const { data: rooms, isLoading: roomsLoading } = useQuery<(Room & { site: Site })[]>({\n    queryKey: ['/api/rooms'],\n  });\n\n  const { data: scans, isLoading: scansLoading } = useQuery<(RoomScan & { room: Room & { site: Site }, user: User })[]>({\n    queryKey: ['/api/room-scans'],\n  });\n\n  const { data: sites } = useQuery<Site[]>({\n    queryKey: ['/api/sites'],\n  });\n\n  const refreshQRMutation = useMutation({\n    mutationFn: async (roomId: number) => {\n      return await apiRequest<Room>('POST', `/api/rooms/${roomId}/refresh-qr`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/rooms'] });\n      toast({\n        title: \"QR Code Refreshed\",\n        description: \"A new QR code has been generated for this room.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to refresh QR code\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const roomFormSchema = insertRoomSchema.omit({ qrCode: true, qrCodeExpiry: true });\n  \n  const createRoomForm = useForm({\n    resolver: zodResolver(roomFormSchema),\n    defaultValues: {\n      name: \"\",\n      siteId: undefined,\n      isActive: true,\n    },\n  });\n\n  const createRoomMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest<Room>('POST', '/api/rooms', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/rooms'] });\n      setCreateDialogOpen(false);\n      createRoomForm.reset();\n      toast({\n        title: \"Room Created\",\n        description: \"The room has been created with a new QR code.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create room\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCreateRoom = (data: any) => {\n    createRoomMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">Room Scans</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            QR code scanning for room entry monitoring\n          </p>\n        </div>\n        <Dialog open={createDialogOpen} onOpenChange={setCreateDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-create-room\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Room\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Create New Room</DialogTitle>\n              <DialogDescription>\n                Add a new room with automatic QR code generation\n              </DialogDescription>\n            </DialogHeader>\n            <Form {...createRoomForm}>\n              <form onSubmit={createRoomForm.handleSubmit(handleCreateRoom)} className=\"space-y-4\">\n                <FormField\n                  control={createRoomForm.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Room Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"e.g., Room 101 - Patient Ward\" {...field} data-testid=\"input-room-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={createRoomForm.control}\n                  name=\"siteId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Site</FormLabel>\n                      <Select onValueChange={(value) => field.onChange(parseInt(value))} value={field.value?.toString()}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-site\">\n                            <SelectValue placeholder=\"Select a site\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {sites?.map((site) => (\n                            <SelectItem key={site.id} value={site.id.toString()}>\n                              {site.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <DialogFooter>\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setCreateDialogOpen(false)} data-testid=\"button-cancel\">\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\" disabled={createRoomMutation.isPending} data-testid=\"button-submit-room\">\n                    {createRoomMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                    Create Room\n                  </Button>\n                </DialogFooter>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Tabs defaultValue=\"qr-codes\" className=\"w-full\">\n        <TabsList>\n          <TabsTrigger value=\"qr-codes\" data-testid=\"tab-qr-codes\">\n            QR Codes\n          </TabsTrigger>\n          <TabsTrigger value=\"scan-log\" data-testid=\"tab-scan-log\">\n            Scan Log ({scans?.length || 0})\n          </TabsTrigger>\n          <TabsTrigger value=\"compliance\" data-testid=\"tab-compliance\">\n            Compliance\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"qr-codes\" className=\"mt-6\">\n          {roomsLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {[1, 2, 3].map((i) => (\n                <Card key={i}>\n                  <CardHeader>\n                    <Skeleton className=\"h-6 w-3/4\" />\n                  </CardHeader>\n                  <CardContent>\n                    <Skeleton className=\"h-64 w-full\" />\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : rooms && rooms.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {rooms.map((room) => (\n                <QRScanner\n                  key={room.id}\n                  roomId={room.id}\n                  roomName={room.name}\n                  qrCode={room.qrCode}\n                  qrCodeExpiry={new Date(room.qrCodeExpiry).toISOString()}\n                  onRefresh={() => refreshQRMutation.mutate(room.id)}\n                />\n              ))}\n            </div>\n          ) : (\n            <Card>\n              <CardContent className=\"py-12\">\n                <p className=\"text-sm text-muted-foreground text-center\">\n                  No rooms found. Create a room to get started.\n                </p>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"scan-log\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Recent Scans</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              {scansLoading ? (\n                <div className=\"p-4 space-y-3\">\n                  {[1, 2, 3, 4].map((i) => (\n                    <Skeleton key={i} className=\"h-16 w-full\" />\n                  ))}\n                </div>\n              ) : scans && scans.length > 0 ? (\n                scans.map((scan) => (\n                  <RoomScanLog\n                    key={scan.id}\n                    id={scan.id.toString()}\n                    roomName={scan.room.name}\n                    staffName={`${scan.user.firstName || ''} ${scan.user.lastName || ''}`.trim() || scan.user.email || 'Unknown'}\n                    timestamp={format(new Date(scan.scannedAt), 'HH:mm')}\n                    confidence={scan.confidence}\n                    deviceId={scan.deviceId}\n                    status={scan.status as \"verified\" | \"low-confidence\" | \"failed\"}\n                  />\n                ))\n              ) : (\n                <div className=\"p-8\">\n                  <p className=\"text-sm text-muted-foreground text-center\">\n                    No scans recorded yet\n                  </p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"compliance\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Room Rounds Compliance</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground text-center py-8\">\n                Compliance tracking coming soon\n              </p>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","size_bytes":10341},"client/src/pages/worker-scan.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { WorkerBottomNav } from \"@/components/worker-bottom-nav\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { QrCode, Camera, CheckCircle2, XCircle, AlertTriangle, Clock } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { User, RoomScan, Room } from \"@shared/schema\";\n\nexport default function WorkerScan() {\n  const { toast } = useToast();\n  const [manualCode, setManualCode] = useState(\"\");\n  const [isScanning, setIsScanning] = useState(false);\n\n  const { data: user, isLoading: userLoading } = useQuery<User>({\n    queryKey: ['/api/auth/user'],\n  });\n\n  const { data: rooms = [], isLoading: roomsLoading } = useQuery<Room[]>({\n    queryKey: ['/api/rooms'],\n  });\n\n  const { data: recentScans = [], isLoading: scansLoading } = useQuery<RoomScan[]>({\n    queryKey: ['/api/room-scans', { userId: user?.id }],\n    enabled: !!user,\n  });\n\n  const scanMutation = useMutation({\n    mutationFn: async (qrCode: string) => {\n      const room = rooms.find(r => r.qrCode === qrCode);\n      \n      if (!room) {\n        throw new Error(\"Invalid QR code\");\n      }\n\n      // Check if QR code is expired\n      const expiryTime = new Date(room.qrCodeExpiry).getTime();\n      const now = Date.now();\n      \n      if (now > expiryTime) {\n        throw new Error(\"QR code has expired\");\n      }\n\n      // Calculate confidence based on time remaining\n      const timeRemaining = expiryTime - now;\n      const totalValidity = 3600000; // 1 hour in ms\n      const confidence = Math.floor((timeRemaining / totalValidity) * 100);\n\n      const status = confidence > 80 ? 'verified' : confidence > 50 ? 'low-confidence' : 'failed';\n\n      return apiRequest('POST', '/api/room-scans', {\n        roomId: room.id,\n        userId: user?.id,\n        deviceId: navigator.userAgent.slice(0, 50), // Use user agent as device ID\n        confidence,\n        status,\n        notes: status === 'low-confidence' ? 'QR code expiring soon' : undefined,\n      });\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/room-scans'] });\n      setManualCode(\"\");\n      setIsScanning(false);\n      \n      const status = data.status;\n      toast({\n        title: status === 'verified' ? \"Scan Successful\" : status === 'low-confidence' ? \"Scan Completed (Low Confidence)\" : \"Scan Failed\",\n        description: status === 'verified' \n          ? \"Room verified successfully\" \n          : status === 'low-confidence'\n          ? \"QR code may be expiring soon\"\n          : \"QR code verification failed\",\n        variant: status === 'failed' ? \"destructive\" : \"default\",\n      });\n    },\n    onError: (error: Error) => {\n      setIsScanning(false);\n      toast({\n        title: \"Scan Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleManualScan = () => {\n    if (!manualCode.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a room code\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    scanMutation.mutate(manualCode.trim());\n  };\n\n  const handleCameraScan = () => {\n    setIsScanning(true);\n    // In a real implementation, this would open the device camera\n    // For now, we'll show a placeholder message\n    toast({\n      title: \"Camera Not Available\",\n      description: \"Please use manual room code entry\",\n      variant: \"default\",\n    });\n    setIsScanning(false);\n  };\n\n  const getRoomName = (roomId: number) => {\n    const room = rooms.find(r => r.id === roomId);\n    return room?.name || \"Unknown Room\";\n  };\n\n  const statusIcons = {\n    verified: <CheckCircle2 className=\"h-5 w-5 text-chart-5\" />,\n    'low-confidence': <AlertTriangle className=\"h-5 w-5 text-chart-1\" />,\n    failed: <XCircle className=\"h-5 w-5 text-destructive\" />,\n  };\n\n  const statusColors = {\n    verified: \"bg-chart-5/10 text-chart-5 border-chart-5/20\",\n    'low-confidence': \"bg-chart-1/10 text-chart-1 border-chart-1/20\",\n    failed: \"bg-destructive/10 text-destructive border-destructive/20\",\n  };\n\n  if (userLoading || roomsLoading) {\n    return (\n      <div className=\"min-h-screen pb-20 md:pb-0\">\n        <div className=\"max-w-2xl mx-auto p-4 space-y-6\">\n          <Skeleton className=\"h-16 w-full\" />\n          <Skeleton className=\"h-64 w-full\" />\n        </div>\n        <WorkerBottomNav />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen pb-20 md:pb-0 bg-background\">\n      <div className=\"max-w-2xl mx-auto p-4 space-y-6\">\n        {/* Header */}\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-scan-title\">Room Scanner</h1>\n          <p className=\"text-muted-foreground mt-1\">Scan QR codes to verify room locations</p>\n        </div>\n\n        {/* Scanner Interface */}\n        <Card className=\"border-2\" data-testid=\"card-scanner\">\n          <CardContent className=\"p-6 space-y-6\">\n            {/* QR Scanner Display */}\n            <div className=\"aspect-square max-w-md mx-auto bg-card border-2 border-dashed rounded-lg flex items-center justify-center\">\n              {isScanning ? (\n                <div className=\"text-center\">\n                  <Camera className=\"h-16 w-16 mx-auto text-muted-foreground animate-pulse mb-3\" />\n                  <p className=\"text-sm text-muted-foreground\">Accessing camera...</p>\n                </div>\n              ) : (\n                <div className=\"text-center p-6\">\n                  <QrCode className=\"h-24 w-24 mx-auto text-muted-foreground mb-4\" />\n                  <p className=\"text-sm text-muted-foreground\">\n                    Scan a room QR code or enter code manually\n                  </p>\n                </div>\n              )}\n            </div>\n\n            {/* Camera Scan Button */}\n            <Button \n              size=\"lg\" \n              className=\"w-full min-h-14\"\n              onClick={handleCameraScan}\n              disabled={isScanning || scanMutation.isPending}\n              data-testid=\"button-camera-scan\"\n            >\n              <Camera className=\"h-5 w-5 mr-2\" />\n              Scan with Camera\n            </Button>\n\n            {/* Manual Entry */}\n            <div className=\"space-y-3\">\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 flex items-center\">\n                  <span className=\"w-full border-t\" />\n                </div>\n                <div className=\"relative flex justify-center text-xs uppercase\">\n                  <span className=\"bg-background px-2 text-muted-foreground\">Or enter manually</span>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Input\n                  placeholder=\"Enter room code...\"\n                  value={manualCode}\n                  onChange={(e) => setManualCode(e.target.value)}\n                  className=\"min-h-12 text-center font-mono text-lg\"\n                  data-testid=\"input-room-code\"\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter') {\n                      handleManualScan();\n                    }\n                  }}\n                />\n                <Button \n                  variant=\"outline\" \n                  size=\"lg\" \n                  className=\"w-full min-h-12\"\n                  onClick={handleManualScan}\n                  disabled={scanMutation.isPending || !manualCode.trim()}\n                  data-testid=\"button-manual-scan\"\n                >\n                  <QrCode className=\"h-5 w-5 mr-2\" />\n                  Verify Code\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Recent Scans */}\n        <Card data-testid=\"card-recent-scans\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Recent Scans</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {scansLoading ? (\n              <div className=\"space-y-3\">\n                <Skeleton className=\"h-20 w-full\" />\n                <Skeleton className=\"h-20 w-full\" />\n              </div>\n            ) : recentScans.length > 0 ? (\n              <div className=\"space-y-3\">\n                {recentScans\n                  .sort((a, b) => new Date(b.scannedAt).getTime() - new Date(a.scannedAt).getTime())\n                  .slice(0, 10)\n                  .map((scan) => (\n                    <div\n                      key={scan.id}\n                      className=\"flex items-start gap-3 p-4 rounded-lg border hover-elevate\"\n                      data-testid={`scan-record-${scan.id}`}\n                    >\n                      <div className=\"mt-0.5\">\n                        {statusIcons[scan.status as keyof typeof statusIcons]}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center justify-between mb-1\">\n                          <p className=\"font-medium text-sm\">{getRoomName(scan.roomId)}</p>\n                          <Badge \n                            variant=\"outline\" \n                            className={statusColors[scan.status as keyof typeof statusColors]}\n                          >\n                            {scan.status}\n                          </Badge>\n                        </div>\n                        <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                          <Clock className=\"h-3 w-3\" />\n                          <span>\n                            {format(new Date(scan.scannedAt), 'EEE, d MMM • HH:mm')}\n                          </span>\n                        </div>\n                        {scan.confidence !== undefined && (\n                          <div className=\"mt-2\">\n                            <div className=\"flex items-center justify-between text-xs mb-1\">\n                              <span className=\"text-muted-foreground\">Confidence</span>\n                              <span className=\"font-medium\">{scan.confidence}%</span>\n                            </div>\n                            <div className=\"h-1.5 bg-muted rounded-full overflow-hidden\">\n                              <div\n                                className={`h-full transition-all ${\n                                  scan.confidence > 80\n                                    ? 'bg-chart-5'\n                                    : scan.confidence > 50\n                                    ? 'bg-chart-1'\n                                    : 'bg-destructive'\n                                }`}\n                                style={{ width: `${scan.confidence}%` }}\n                              />\n                            </div>\n                          </div>\n                        )}\n                        {scan.notes && (\n                          <p className=\"text-xs text-muted-foreground mt-2 italic\">\n                            {scan.notes}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8\">\n                <QrCode className=\"h-12 w-12 mx-auto text-muted-foreground mb-3\" />\n                <p className=\"text-sm text-muted-foreground\">\n                  No scans yet. Start scanning rooms to see your history.\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n      <WorkerBottomNav />\n    </div>\n  );\n}\n","size_bytes":11896},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"server/storage.ts":{"content":"// Following Replit Auth blueprint patterns for storage implementation\nimport {\n  users,\n  sites,\n  shifts,\n  attendance,\n  rooms,\n  roomScans,\n  payrollRuns,\n  payslips,\n  queries,\n  queryMessages,\n  type User,\n  type UpsertUser,\n  type InsertUser,\n  type Site,\n  type InsertSite,\n  type Shift,\n  type InsertShift,\n  type Attendance,\n  type InsertAttendance,\n  type Room,\n  type InsertRoom,\n  type RoomScan,\n  type InsertRoomScan,\n  type PayrollRun,\n  type InsertPayrollRun,\n  type Payslip,\n  type InsertPayslip,\n  type Query,\n  type InsertQuery,\n  type QueryMessage,\n  type InsertQueryMessage,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, or, gte, lte, isNull, isNotNull, desc } from \"drizzle-orm\";\nimport crypto from \"crypto\";\n\nexport interface IStorage {\n  // User operations (required for Replit Auth)\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  \n  // Site operations\n  getAllSites(): Promise<Site[]>;\n  getSite(id: number): Promise<Site | undefined>;\n  createSite(site: InsertSite): Promise<Site>;\n  updateSite(id: number, site: Partial<InsertSite>): Promise<Site | undefined>;\n  refreshSiteClockQR(id: number): Promise<Site | undefined>;\n  \n  // User management operations\n  getAllUsers(): Promise<User[]>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, user: Partial<InsertUser>): Promise<User | undefined>;\n  deleteUser(id: string): Promise<boolean>;\n  \n  // Shift operations\n  getAllShifts(filters?: { date?: string, siteId?: number, userId?: string, status?: string }): Promise<(Shift & { user: User, site: Site })[]>;\n  getShift(id: number): Promise<(Shift & { user: User, site: Site }) | undefined>;\n  createShift(shift: InsertShift): Promise<Shift>;\n  updateShift(id: number, shift: Partial<InsertShift>): Promise<Shift | undefined>;\n  deleteShift(id: number): Promise<boolean>;\n  checkShiftConflict(userId: string, date: string, startTime: string, endTime: string, excludeShiftId?: number): Promise<boolean>;\n  \n  // Attendance operations\n  getAllAttendance(filters?: { date?: string, siteId?: number, userId?: string, approvalStatus?: string }): Promise<(Attendance & { user: User, site: Site })[]>;\n  getAttendance(id: number): Promise<(Attendance & { user: User, site: Site }) | undefined>;\n  clockIn(userId: string, siteId: number, shiftId?: number, notes?: string): Promise<Attendance>;\n  clockOut(attendanceId: number, notes?: string): Promise<Attendance | undefined>;\n  approveAttendance(id: number, approvedBy: string): Promise<Attendance | undefined>;\n  rejectAttendance(id: number, approvedBy: string): Promise<Attendance | undefined>;\n  calculateDuration(clockIn: string, clockOut: string): string;\n  \n  // Room operations\n  getAllRooms(filters?: { siteId?: number, isActive?: boolean }): Promise<(Room & { site: Site })[]>;\n  getRoom(id: number): Promise<(Room & { site: Site }) | undefined>;\n  createRoom(room: Omit<InsertRoom, 'qrCode' | 'qrCodeExpiry'>): Promise<Room>;\n  updateRoom(id: number, room: Partial<InsertRoom>): Promise<Room | undefined>;\n  refreshRoomQR(id: number): Promise<Room | undefined>;\n  deleteRoom(id: number): Promise<boolean>;\n  \n  // Room scan operations\n  logRoomScan(scan: InsertRoomScan): Promise<RoomScan>;\n  getAllRoomScans(filters?: { roomId?: number, userId?: string, status?: string, date?: string }): Promise<(RoomScan & { room: Room & { site: Site }, user: User })[]>;\n  \n  // Payroll operations\n  createPayrollRun(startDate: string, endDate: string, createdBy: string): Promise<PayrollRun>;\n  getPayrollRuns(filters?: { status?: string }): Promise<PayrollRun[]>;\n  getPayrollRun(id: number): Promise<(PayrollRun & { payslips: (Payslip & { user: User, site: Site })[] }) | undefined>;\n  processPayrollRun(id: number): Promise<void>;\n  finalizePayrollRun(id: number, finalizedBy: string): Promise<PayrollRun | undefined>;\n  getPayslips(filters?: { payrollRunId?: number, userId?: string }): Promise<(Payslip & { user: User, site: Site, payrollRun: PayrollRun })[]>;\n  getPayslip(id: number): Promise<(Payslip & { user: User, site: Site, payrollRun: PayrollRun }) | undefined>;\n  addDeduction(payslipId: number, deduction: { amount: number, reason: string, type: string }): Promise<Payslip | undefined>;\n  \n  // Query operations\n  getAllQueries(filters?: { userId?: string, category?: string, status?: string, priority?: string }): Promise<(Query & { user: User })[]>;\n  getQuery(id: number): Promise<(Query & { user: User, messages: (QueryMessage & { user: User })[] }) | undefined>;\n  createQuery(query: InsertQuery): Promise<Query>;\n  updateQueryStatus(id: number, status: string, updatedBy: string): Promise<Query | undefined>;\n  updateQueryPriority(id: number, priority: string): Promise<Query | undefined>;\n  addMessage(queryId: number, message: InsertQueryMessage): Promise<QueryMessage>;\n  getQueryMessages(queryId: number): Promise<(QueryMessage & { user: User })[]>;\n  \n  // Analytics operations\n  getHoursSummary(filters: { startDate: string, endDate: string, siteId?: number, userId?: string }): Promise<{ regularHours: number, overtimeHours: number, totalHours: number }>;\n  getCostSummary(filters: { startDate: string, endDate: string, siteId?: number }): Promise<{ regularCost: number, overtimeCost: number, totalCost: number }>;\n  getAttendanceSummary(filters: { startDate: string, endDate: string, siteId?: number }): Promise<{ total: number, pending: number, approved: number, rejected: number, onTime: number, late: number }>;\n  getSiteSummary(): Promise<{ siteId: number, siteName: string, activeWorkers: number, totalShifts: number, totalHours: number, totalCost: number }[]>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations (required for Replit Auth)\n  \n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  // Site operations\n  \n  async getAllSites(): Promise<Site[]> {\n    return await db.select().from(sites);\n  }\n\n  async getSite(id: number): Promise<Site | undefined> {\n    const [site] = await db.select().from(sites).where(eq(sites.id, id));\n    return site;\n  }\n\n  async createSite(siteData: InsertSite): Promise<Site> {\n    const [site] = await db.insert(sites).values(siteData).returning();\n    return site;\n  }\n\n  async updateSite(id: number, siteData: Partial<InsertSite>): Promise<Site | undefined> {\n    const [site] = await db\n      .update(sites)\n      .set(siteData)\n      .where(eq(sites.id, id))\n      .returning();\n    return site;\n  }\n\n  // User management operations\n  \n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users);\n  }\n\n  async createUser(userData: InsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(userData).returning();\n    return user;\n  }\n\n  async updateUser(id: string, userData: Partial<InsertUser>): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({\n        ...userData,\n        updatedAt: new Date(),\n      })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  async deleteUser(id: string): Promise<boolean> {\n    const result = await db.delete(users).where(eq(users.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Shift operations\n\n  async getAllShifts(filters?: { date?: string, siteId?: number, userId?: string, status?: string }): Promise<(Shift & { user: User, site: Site })[]> {\n    let query = db\n      .select({\n        shift: shifts,\n        user: users,\n        site: sites,\n      })\n      .from(shifts)\n      .innerJoin(users, eq(shifts.userId, users.id))\n      .innerJoin(sites, eq(shifts.siteId, sites.id));\n\n    const conditions = [];\n    if (filters?.date) {\n      conditions.push(eq(shifts.date, filters.date));\n    }\n    if (filters?.siteId) {\n      conditions.push(eq(shifts.siteId, filters.siteId));\n    }\n    if (filters?.userId) {\n      conditions.push(eq(shifts.userId, filters.userId));\n    }\n    if (filters?.status) {\n      conditions.push(eq(shifts.status, filters.status));\n    }\n\n    if (conditions.length > 0) {\n      query = query.where(and(...conditions)) as any;\n    }\n\n    const results = await query;\n    return results.map((r: any) => ({ ...r.shift, user: r.user, site: r.site }));\n  }\n\n  async getShift(id: number): Promise<(Shift & { user: User, site: Site }) | undefined> {\n    const [result] = await db\n      .select({\n        shift: shifts,\n        user: users,\n        site: sites,\n      })\n      .from(shifts)\n      .innerJoin(users, eq(shifts.userId, users.id))\n      .innerJoin(sites, eq(shifts.siteId, sites.id))\n      .where(eq(shifts.id, id));\n\n    if (!result) return undefined;\n    return { ...result.shift, user: result.user, site: result.site };\n  }\n\n  async checkShiftConflict(\n    userId: string,\n    date: string,\n    startTime: string,\n    endTime: string,\n    excludeShiftId?: number\n  ): Promise<boolean> {\n    const conditions = [\n      eq(shifts.userId, userId),\n      eq(shifts.date, date),\n    ];\n\n    if (excludeShiftId) {\n      conditions.push(eq(shifts.id, excludeShiftId));\n    }\n\n    let query = db\n      .select()\n      .from(shifts)\n      .where(and(\n        eq(shifts.userId, userId),\n        eq(shifts.date, date),\n      ));\n\n    if (excludeShiftId) {\n      query = query.where(and(\n        eq(shifts.userId, userId),\n        eq(shifts.date, date),\n      )) as any;\n    }\n\n    const existingShifts = await query;\n\n    // Filter out the excluded shift\n    const shiftsToCheck = excludeShiftId \n      ? existingShifts.filter(s => s.id !== excludeShiftId)\n      : existingShifts;\n\n    // Check for time overlap\n    for (const existingShift of shiftsToCheck) {\n      const conflict = this.doTimesOverlap(\n        startTime,\n        endTime,\n        existingShift.startTime,\n        existingShift.endTime\n      );\n      if (conflict) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  private doTimesOverlap(\n    start1: string,\n    end1: string,\n    start2: string,\n    end2: string\n  ): boolean {\n    // Convert HH:MM to minutes since midnight for comparison\n    const toMinutes = (time: string): number => {\n      const [hours, minutes] = time.split(':').map(Number);\n      return hours * 60 + minutes;\n    };\n\n    const start1Min = toMinutes(start1);\n    const end1Min = toMinutes(end1);\n    const start2Min = toMinutes(start2);\n    const end2Min = toMinutes(end2);\n\n    // Check if ranges overlap\n    return (start1Min < end2Min && end1Min > start2Min);\n  }\n\n  async createShift(shiftData: InsertShift): Promise<Shift> {\n    // Check for conflicts\n    const hasConflict = await this.checkShiftConflict(\n      shiftData.userId,\n      shiftData.date,\n      shiftData.startTime,\n      shiftData.endTime\n    );\n\n    // Set status to conflict if overlap detected\n    const status = hasConflict ? 'conflict' : (shiftData.status || 'scheduled');\n\n    const dataToInsert: any = {\n      ...shiftData,\n      status,\n    };\n\n    const [shift] = await db\n      .insert(shifts)\n      .values(dataToInsert)\n      .returning();\n\n    return shift;\n  }\n\n  async updateShift(id: number, shiftData: Partial<InsertShift>): Promise<Shift | undefined> {\n    // Get existing shift\n    const existing = await this.getShift(id);\n    if (!existing) return undefined;\n\n    // Check for conflicts if time/date/user changed\n    let status = (shiftData as any).status || existing.status;\n    \n    if ((shiftData as any).userId || (shiftData as any).date || (shiftData as any).startTime || (shiftData as any).endTime) {\n      const hasConflict = await this.checkShiftConflict(\n        (shiftData as any).userId || existing.userId,\n        (shiftData as any).date || existing.date,\n        (shiftData as any).startTime || existing.startTime,\n        (shiftData as any).endTime || existing.endTime,\n        id\n      );\n\n      if (hasConflict) {\n        status = 'conflict';\n      } else if (status === 'conflict') {\n        // If was conflict but no longer, reset to scheduled\n        status = 'scheduled';\n      }\n    }\n\n    const dataToUpdate: any = {\n      ...shiftData,\n      status,\n      updatedAt: new Date(),\n    };\n\n    const [shift] = await db\n      .update(shifts)\n      .set(dataToUpdate)\n      .where(eq(shifts.id, id))\n      .returning();\n\n    return shift;\n  }\n\n  async deleteShift(id: number): Promise<boolean> {\n    const result = await db.delete(shifts).where(eq(shifts.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Attendance operations\n\n  async getAllAttendance(filters?: { date?: string, siteId?: number, userId?: string, approvalStatus?: string }): Promise<(Attendance & { user: User, site: Site })[]> {\n    let query = db\n      .select({\n        attendance: attendance,\n        user: users,\n        site: sites,\n      })\n      .from(attendance)\n      .innerJoin(users, eq(attendance.userId, users.id))\n      .innerJoin(sites, eq(attendance.siteId, sites.id));\n\n    const conditions = [];\n    if (filters?.date) {\n      conditions.push(eq(attendance.date, filters.date));\n    }\n    if (filters?.siteId) {\n      conditions.push(eq(attendance.siteId, filters.siteId));\n    }\n    if (filters?.userId) {\n      conditions.push(eq(attendance.userId, filters.userId));\n    }\n    if (filters?.approvalStatus) {\n      conditions.push(eq(attendance.approvalStatus, filters.approvalStatus));\n    }\n\n    if (conditions.length > 0) {\n      query = query.where(and(...conditions)) as any;\n    }\n\n    const results = await query;\n    return results.map((r: any) => ({ ...r.attendance, user: r.user, site: r.site }));\n  }\n\n  async getAttendance(id: number): Promise<(Attendance & { user: User, site: Site }) | undefined> {\n    const [result] = await db\n      .select({\n        attendance: attendance,\n        user: users,\n        site: sites,\n      })\n      .from(attendance)\n      .innerJoin(users, eq(attendance.userId, users.id))\n      .innerJoin(sites, eq(attendance.siteId, sites.id))\n      .where(eq(attendance.id, id));\n\n    if (!result) return undefined;\n    return { ...result.attendance, user: result.user, site: result.site };\n  }\n\n  async clockIn(userId: string, siteId: number, shiftId?: number, notes?: string): Promise<Attendance> {\n    const now = new Date();\n    const date = now.toISOString().split('T')[0]; // YYYY-MM-DD\n    const clockInTime = now.toTimeString().substring(0, 5); // HH:MM\n\n    const attendanceData: InsertAttendance = {\n      userId,\n      siteId,\n      shiftId: shiftId || null,\n      date,\n      clockIn: clockInTime,\n      clockOut: null,\n      approvalStatus: 'pending',\n      approvedBy: null,\n      approvedAt: null,\n      notes: notes || null,\n    };\n\n    const [record] = await db.insert(attendance).values(attendanceData).returning();\n    return record;\n  }\n\n  async clockOut(attendanceId: number, notes?: string): Promise<Attendance | undefined> {\n    const now = new Date();\n    const clockOutTime = now.toTimeString().substring(0, 5); // HH:MM\n\n    const updateData: any = {\n      clockOut: clockOutTime,\n      updatedAt: new Date(),\n    };\n\n    if (notes) {\n      updateData.notes = notes;\n    }\n\n    const [record] = await db\n      .update(attendance)\n      .set(updateData)\n      .where(eq(attendance.id, attendanceId))\n      .returning();\n\n    return record;\n  }\n\n  async approveAttendance(id: number, approvedBy: string): Promise<Attendance | undefined> {\n    const [record] = await db\n      .update(attendance)\n      .set({\n        approvalStatus: 'approved',\n        approvedBy,\n        approvedAt: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(attendance.id, id))\n      .returning();\n\n    return record;\n  }\n\n  async rejectAttendance(id: number, approvedBy: string): Promise<Attendance | undefined> {\n    const [record] = await db\n      .update(attendance)\n      .set({\n        approvalStatus: 'rejected',\n        approvedBy,\n        approvedAt: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(attendance.id, id))\n      .returning();\n\n    return record;\n  }\n\n  calculateDuration(clockIn: string, clockOut: string): string {\n    const [inHours, inMinutes] = clockIn.split(':').map(Number);\n    const [outHours, outMinutes] = clockOut.split(':').map(Number);\n\n    let totalMinutes = (outHours * 60 + outMinutes) - (inHours * 60 + inMinutes);\n    \n    // Handle overnight shifts (clock out is next day)\n    if (totalMinutes < 0) {\n      totalMinutes += 24 * 60;\n    }\n\n    const hours = Math.floor(totalMinutes / 60);\n    const minutes = totalMinutes % 60;\n\n    return `${hours}h ${minutes}m`;\n  }\n\n  // Room operations\n\n  private generateQRCode(roomId: number): { qrCode: string, qrCodeExpiry: Date } {\n    const timestamp = Date.now();\n    const random = crypto.randomBytes(16).toString('hex');\n    const qrCode = `ROOM_${roomId}_${timestamp}_${random}`;\n    \n    // Set expiry to 10 minutes from now\n    const qrCodeExpiry = new Date(Date.now() + 10 * 60 * 1000);\n    \n    return { qrCode, qrCodeExpiry };\n  }\n\n  async getAllRooms(filters?: { siteId?: number, isActive?: boolean }): Promise<(Room & { site: Site })[]> {\n    let query = db\n      .select({\n        room: rooms,\n        site: sites,\n      })\n      .from(rooms)\n      .innerJoin(sites, eq(rooms.siteId, sites.id));\n\n    const conditions = [];\n    if (filters?.siteId !== undefined) {\n      conditions.push(eq(rooms.siteId, filters.siteId));\n    }\n    if (filters?.isActive !== undefined) {\n      conditions.push(eq(rooms.isActive, filters.isActive));\n    }\n\n    if (conditions.length > 0) {\n      query = query.where(and(...conditions)) as any;\n    }\n\n    const results = await query;\n    return results.map((r: any) => ({ ...r.room, site: r.site }));\n  }\n\n  async getRoom(id: number): Promise<(Room & { site: Site }) | undefined> {\n    const [result] = await db\n      .select({\n        room: rooms,\n        site: sites,\n      })\n      .from(rooms)\n      .innerJoin(sites, eq(rooms.siteId, sites.id))\n      .where(eq(rooms.id, id));\n\n    if (!result) return undefined;\n    return { ...result.room, site: result.site };\n  }\n\n  async createRoom(roomData: Omit<InsertRoom, 'qrCode' | 'qrCodeExpiry'>): Promise<Room> {\n    // First create the room to get the ID\n    const [room] = await db.insert(rooms).values({\n      ...roomData,\n      qrCode: 'temp',\n      qrCodeExpiry: new Date(),\n    }).returning();\n\n    // Generate QR code with the room ID\n    const { qrCode, qrCodeExpiry } = this.generateQRCode(room.id);\n\n    // Update the room with the actual QR code\n    const [updatedRoom] = await db\n      .update(rooms)\n      .set({ qrCode, qrCodeExpiry })\n      .where(eq(rooms.id, room.id))\n      .returning();\n\n    return updatedRoom;\n  }\n\n  async updateRoom(id: number, roomData: Partial<InsertRoom>): Promise<Room | undefined> {\n    const [room] = await db\n      .update(rooms)\n      .set(roomData)\n      .where(eq(rooms.id, id))\n      .returning();\n\n    return room;\n  }\n\n  async refreshRoomQR(id: number): Promise<Room | undefined> {\n    const { qrCode, qrCodeExpiry } = this.generateQRCode(id);\n    \n    const [room] = await db\n      .update(rooms)\n      .set({ qrCode, qrCodeExpiry })\n      .where(eq(rooms.id, id))\n      .returning();\n\n    return room;\n  }\n\n  async deleteRoom(id: number): Promise<boolean> {\n    const result = await db.delete(rooms).where(eq(rooms.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Room scan operations\n\n  async logRoomScan(scanData: InsertRoomScan): Promise<RoomScan> {\n    const [scan] = await db.insert(roomScans).values(scanData).returning();\n    return scan;\n  }\n\n  async getAllRoomScans(filters?: { roomId?: number, userId?: string, status?: string, date?: string }): Promise<(RoomScan & { room: Room & { site: Site }, user: User })[]> {\n    let query = db\n      .select({\n        scan: roomScans,\n        room: rooms,\n        site: sites,\n        user: users,\n      })\n      .from(roomScans)\n      .innerJoin(rooms, eq(roomScans.roomId, rooms.id))\n      .innerJoin(sites, eq(rooms.siteId, sites.id))\n      .innerJoin(users, eq(roomScans.userId, users.id))\n      .orderBy(desc(roomScans.scannedAt));\n\n    const conditions = [];\n    if (filters?.roomId !== undefined) {\n      conditions.push(eq(roomScans.roomId, filters.roomId));\n    }\n    if (filters?.userId) {\n      conditions.push(eq(roomScans.userId, filters.userId));\n    }\n    if (filters?.status) {\n      conditions.push(eq(roomScans.status, filters.status));\n    }\n    if (filters?.date) {\n      // Filter by date (scannedAt contains the full timestamp)\n      const startOfDay = new Date(filters.date);\n      startOfDay.setHours(0, 0, 0, 0);\n      const endOfDay = new Date(filters.date);\n      endOfDay.setHours(23, 59, 59, 999);\n      \n      conditions.push(\n        and(\n          gte(roomScans.scannedAt, startOfDay),\n          lte(roomScans.scannedAt, endOfDay)\n        ) as any\n      );\n    }\n\n    if (conditions.length > 0) {\n      query = query.where(and(...conditions)) as any;\n    }\n\n    const results = await query;\n    return results.map((r: any) => ({\n      ...r.scan,\n      room: { ...r.room, site: r.site },\n      user: r.user,\n    }));\n  }\n\n  // Payroll operations\n\n  async createPayrollRun(startDate: string, endDate: string, createdBy: string): Promise<PayrollRun> {\n    const period = this.generatePayrollPeriod(startDate, endDate);\n    \n    const [payrollRun] = await db\n      .insert(payrollRuns)\n      .values({\n        period,\n        startDate,\n        endDate,\n        status: 'draft',\n        createdBy,\n        finalizedAt: null,\n      })\n      .returning();\n\n    return payrollRun;\n  }\n\n  private generatePayrollPeriod(startDate: string, endDate: string): string {\n    const start = new Date(startDate);\n    const weekNumber = this.getWeekNumber(start);\n    const year = start.getFullYear();\n    return `Week ${weekNumber}, ${year}`;\n  }\n\n  private getWeekNumber(date: Date): number {\n    const firstDayOfYear = new Date(date.getFullYear(), 0, 1);\n    const pastDaysOfYear = (date.getTime() - firstDayOfYear.getTime()) / 86400000;\n    return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);\n  }\n\n  async getPayrollRuns(filters?: { status?: string }): Promise<PayrollRun[]> {\n    let query = db.select().from(payrollRuns).orderBy(desc(payrollRuns.createdAt));\n\n    if (filters?.status) {\n      query = query.where(eq(payrollRuns.status, filters.status)) as any;\n    }\n\n    return await query;\n  }\n\n  async getPayrollRun(id: number): Promise<(PayrollRun & { payslips: (Payslip & { user: User, site: Site })[] }) | undefined> {\n    const [run] = await db.select().from(payrollRuns).where(eq(payrollRuns.id, id));\n    \n    if (!run) return undefined;\n\n    const payslipsData = await db\n      .select({\n        payslip: payslips,\n        user: users,\n        site: sites,\n      })\n      .from(payslips)\n      .innerJoin(users, eq(payslips.userId, users.id))\n      .innerJoin(sites, eq(payslips.siteId, sites.id))\n      .where(eq(payslips.payrollRunId, id));\n\n    const payslipsWithDetails = payslipsData.map((p: any) => ({\n      ...p.payslip,\n      user: p.user,\n      site: p.site,\n    }));\n\n    return {\n      ...run,\n      payslips: payslipsWithDetails,\n    };\n  }\n\n  async processPayrollRun(id: number): Promise<void> {\n    const run = await this.getPayrollRun(id);\n    if (!run) throw new Error('Payroll run not found');\n    if (run.status !== 'draft') throw new Error('Payroll run is not in draft status');\n\n    const approvedAttendance = await db\n      .select({\n        attendance: attendance,\n        user: users,\n      })\n      .from(attendance)\n      .innerJoin(users, eq(attendance.userId, users.id))\n      .where(\n        and(\n          gte(attendance.date, run.startDate),\n          lte(attendance.date, run.endDate),\n          eq(attendance.approvalStatus, 'approved'),\n          isNotNull(attendance.clockOut)\n        )\n      );\n\n    const userAttendanceMap = new Map<string, Array<{ attendance: Attendance, user: User }>>();\n    \n    for (const record of approvedAttendance) {\n      const userId = record.user.id;\n      if (!userAttendanceMap.has(userId)) {\n        userAttendanceMap.set(userId, []);\n      }\n      userAttendanceMap.get(userId)!.push(record);\n    }\n\n    for (const [userId, records] of userAttendanceMap.entries()) {\n      const user = records[0].user;\n      const hourlyRate = parseFloat(user.hourlyRate || '0');\n      \n      if (hourlyRate === 0) continue;\n\n      const weeklyHours = this.groupByWeek(records.map(r => r.attendance));\n      \n      let totalRegularHours = 0;\n      let totalOvertimeHours = 0;\n      const lineItems: any[] = [];\n\n      for (const [weekKey, weekAttendance] of Object.entries(weeklyHours)) {\n        const weekTotalHours = weekAttendance.reduce((sum, att) => {\n          return sum + this.calculateHoursFromTimes(att.clockIn, att.clockOut!);\n        }, 0);\n\n        const regularHours = Math.min(weekTotalHours, 40);\n        const overtimeHours = Math.max(0, weekTotalHours - 40);\n\n        totalRegularHours += regularHours;\n        totalOvertimeHours += overtimeHours;\n\n        if (regularHours > 0) {\n          lineItems.push({\n            id: `regular-${weekKey}`,\n            description: `Regular hours - ${weekKey}`,\n            type: 'regular',\n            hours: regularHours.toFixed(2),\n            rate: hourlyRate.toFixed(2),\n            amount: (regularHours * hourlyRate).toFixed(2),\n            reason: null,\n          });\n        }\n\n        if (overtimeHours > 0) {\n          const overtimeRate = hourlyRate * 1.5;\n          lineItems.push({\n            id: `overtime-${weekKey}`,\n            description: `Overtime hours (1.5x) - ${weekKey}`,\n            type: 'overtime',\n            hours: overtimeHours.toFixed(2),\n            rate: overtimeRate.toFixed(2),\n            amount: (overtimeHours * overtimeRate).toFixed(2),\n            reason: null,\n          });\n        }\n      }\n\n      const regularPay = totalRegularHours * hourlyRate;\n      const overtimePay = totalOvertimeHours * hourlyRate * 1.5;\n      const grossPay = regularPay + overtimePay;\n      const deductions = 0;\n      const netPay = grossPay - deductions;\n\n      const siteId = records[0].attendance.siteId;\n\n      await db.insert(payslips).values({\n        payrollRunId: id,\n        userId,\n        siteId,\n        grossPay: grossPay.toFixed(2),\n        deductions: deductions.toFixed(2),\n        netPay: netPay.toFixed(2),\n        lineItems,\n      });\n    }\n\n    await db\n      .update(payrollRuns)\n      .set({ status: 'processing' })\n      .where(eq(payrollRuns.id, id));\n  }\n\n  private groupByWeek(attendanceRecords: Attendance[]): Record<string, Attendance[]> {\n    const weekMap: Record<string, Attendance[]> = {};\n\n    for (const att of attendanceRecords) {\n      const date = new Date(att.date);\n      const weekNumber = this.getWeekNumber(date);\n      const year = date.getFullYear();\n      const weekKey = `Week ${weekNumber}, ${year}`;\n\n      if (!weekMap[weekKey]) {\n        weekMap[weekKey] = [];\n      }\n      weekMap[weekKey].push(att);\n    }\n\n    return weekMap;\n  }\n\n  private calculateHoursFromTimes(clockIn: string, clockOut: string): number {\n    const [inHours, inMinutes] = clockIn.split(':').map(Number);\n    const [outHours, outMinutes] = clockOut.split(':').map(Number);\n\n    let totalMinutes = (outHours * 60 + outMinutes) - (inHours * 60 + inMinutes);\n    \n    if (totalMinutes < 0) {\n      totalMinutes += 24 * 60;\n    }\n\n    return totalMinutes / 60;\n  }\n\n  async finalizePayrollRun(id: number, finalizedBy: string): Promise<PayrollRun | undefined> {\n    const [run] = await db\n      .update(payrollRuns)\n      .set({\n        status: 'finalized',\n        finalizedAt: new Date(),\n      })\n      .where(eq(payrollRuns.id, id))\n      .returning();\n\n    return run;\n  }\n\n  async getPayslips(filters?: { payrollRunId?: number, userId?: string }): Promise<(Payslip & { user: User, site: Site, payrollRun: PayrollRun })[]> {\n    let query = db\n      .select({\n        payslip: payslips,\n        user: users,\n        site: sites,\n        payrollRun: payrollRuns,\n      })\n      .from(payslips)\n      .innerJoin(users, eq(payslips.userId, users.id))\n      .innerJoin(sites, eq(payslips.siteId, sites.id))\n      .innerJoin(payrollRuns, eq(payslips.payrollRunId, payrollRuns.id))\n      .orderBy(desc(payslips.createdAt));\n\n    const conditions = [];\n    if (filters?.payrollRunId !== undefined) {\n      conditions.push(eq(payslips.payrollRunId, filters.payrollRunId));\n    }\n    if (filters?.userId) {\n      conditions.push(eq(payslips.userId, filters.userId));\n    }\n\n    if (conditions.length > 0) {\n      query = query.where(and(...conditions)) as any;\n    }\n\n    const results = await query;\n    return results.map((r: any) => ({\n      ...r.payslip,\n      user: r.user,\n      site: r.site,\n      payrollRun: r.payrollRun,\n    }));\n  }\n\n  async getPayslip(id: number): Promise<(Payslip & { user: User, site: Site, payrollRun: PayrollRun }) | undefined> {\n    const [result] = await db\n      .select({\n        payslip: payslips,\n        user: users,\n        site: sites,\n        payrollRun: payrollRuns,\n      })\n      .from(payslips)\n      .innerJoin(users, eq(payslips.userId, users.id))\n      .innerJoin(sites, eq(payslips.siteId, sites.id))\n      .innerJoin(payrollRuns, eq(payslips.payrollRunId, payrollRuns.id))\n      .where(eq(payslips.id, id));\n\n    if (!result) return undefined;\n\n    return {\n      ...result.payslip,\n      user: result.user,\n      site: result.site,\n      payrollRun: result.payrollRun,\n    };\n  }\n\n  async addDeduction(payslipId: number, deduction: { amount: number, reason: string, type: string }): Promise<Payslip | undefined> {\n    const [payslip] = await db.select().from(payslips).where(eq(payslips.id, payslipId));\n    \n    if (!payslip) return undefined;\n\n    const currentLineItems = (payslip.lineItems as any[]) || [];\n    const deductionId = `deduction-${Date.now()}`;\n    \n    const newLineItem = {\n      id: deductionId,\n      description: deduction.reason,\n      type: deduction.type,\n      hours: null,\n      rate: null,\n      amount: (-Math.abs(deduction.amount)).toFixed(2),\n      reason: deduction.reason,\n    };\n\n    const updatedLineItems = [...currentLineItems, newLineItem];\n    const currentDeductions = parseFloat(payslip.deductions);\n    const newDeductions = currentDeductions + Math.abs(deduction.amount);\n    const grossPay = parseFloat(payslip.grossPay);\n    const newNetPay = grossPay - newDeductions;\n\n    const [updatedPayslip] = await db\n      .update(payslips)\n      .set({\n        lineItems: updatedLineItems,\n        deductions: newDeductions.toFixed(2),\n        netPay: newNetPay.toFixed(2),\n      })\n      .where(eq(payslips.id, payslipId))\n      .returning();\n\n    return updatedPayslip;\n  }\n\n  // Query operations\n\n  async getAllQueries(filters?: { userId?: string, category?: string, status?: string, priority?: string }): Promise<(Query & { user: User })[]> {\n    let query = db\n      .select({\n        query: queries,\n        user: users,\n      })\n      .from(queries)\n      .innerJoin(users, eq(queries.userId, users.id))\n      .orderBy(desc(queries.createdAt));\n\n    const conditions = [];\n    if (filters?.userId) {\n      conditions.push(eq(queries.userId, filters.userId));\n    }\n    if (filters?.category) {\n      conditions.push(eq(queries.category, filters.category));\n    }\n    if (filters?.status) {\n      conditions.push(eq(queries.status, filters.status));\n    }\n    if (filters?.priority) {\n      conditions.push(eq(queries.priority, filters.priority));\n    }\n\n    if (conditions.length > 0) {\n      query = query.where(and(...conditions)) as any;\n    }\n\n    const results = await query;\n    return results.map((r: any) => ({ ...r.query, user: r.user }));\n  }\n\n  async getQuery(id: number): Promise<(Query & { user: User, messages: (QueryMessage & { user: User })[] }) | undefined> {\n    const [result] = await db\n      .select({\n        query: queries,\n        user: users,\n      })\n      .from(queries)\n      .innerJoin(users, eq(queries.userId, users.id))\n      .where(eq(queries.id, id));\n\n    if (!result) return undefined;\n\n    const messages = await this.getQueryMessages(id);\n\n    return {\n      ...result.query,\n      user: result.user,\n      messages,\n    };\n  }\n\n  async createQuery(queryData: InsertQuery): Promise<Query> {\n    const [query] = await db.insert(queries).values(queryData).returning();\n    return query;\n  }\n\n  async updateQueryStatus(id: number, status: string, updatedBy: string): Promise<Query | undefined> {\n    const [query] = await db\n      .update(queries)\n      .set({\n        status,\n        assignedTo: updatedBy,\n        updatedAt: new Date(),\n      })\n      .where(eq(queries.id, id))\n      .returning();\n    return query;\n  }\n\n  async updateQueryPriority(id: number, priority: string): Promise<Query | undefined> {\n    const [query] = await db\n      .update(queries)\n      .set({\n        priority,\n        updatedAt: new Date(),\n      })\n      .where(eq(queries.id, id))\n      .returning();\n    return query;\n  }\n\n  async addMessage(queryId: number, messageData: InsertQueryMessage): Promise<QueryMessage> {\n    const [message] = await db.insert(queryMessages).values(messageData).returning();\n    \n    // Update the query's updatedAt timestamp\n    await db\n      .update(queries)\n      .set({ updatedAt: new Date() })\n      .where(eq(queries.id, queryId));\n    \n    return message;\n  }\n\n  async getQueryMessages(queryId: number): Promise<(QueryMessage & { user: User })[]> {\n    const results = await db\n      .select({\n        message: queryMessages,\n        user: users,\n      })\n      .from(queryMessages)\n      .innerJoin(users, eq(queryMessages.userId, users.id))\n      .where(eq(queryMessages.queryId, queryId))\n      .orderBy(queryMessages.createdAt);\n\n    return results.map((r: any) => ({ ...r.message, user: r.user }));\n  }\n\n  // Analytics operations\n\n  async getHoursSummary(filters: { startDate: string, endDate: string, siteId?: number, userId?: string }): Promise<{ regularHours: number, overtimeHours: number, totalHours: number }> {\n    const conditions = [\n      gte(attendance.date, filters.startDate),\n      lte(attendance.date, filters.endDate),\n      eq(attendance.approvalStatus, 'approved'),\n      isNotNull(attendance.clockOut),\n    ];\n\n    if (filters.siteId !== undefined) {\n      conditions.push(eq(attendance.siteId, filters.siteId));\n    }\n    if (filters.userId) {\n      conditions.push(eq(attendance.userId, filters.userId));\n    }\n\n    const records = await db\n      .select({\n        attendance: attendance,\n        user: users,\n      })\n      .from(attendance)\n      .innerJoin(users, eq(attendance.userId, users.id))\n      .where(and(...conditions));\n\n    let totalHours = 0;\n    let regularHours = 0;\n    let overtimeHours = 0;\n\n    // Calculate hours for each record\n    for (const record of records) {\n      const hours = this.calculateHoursDecimal(record.attendance.clockIn, record.attendance.clockOut!);\n      totalHours += hours;\n      \n      // Simple overtime calculation: hours beyond 8 in a single shift are overtime\n      if (hours > 8) {\n        regularHours += 8;\n        overtimeHours += (hours - 8);\n      } else {\n        regularHours += hours;\n      }\n    }\n\n    return {\n      regularHours: Math.round(regularHours * 100) / 100,\n      overtimeHours: Math.round(overtimeHours * 100) / 100,\n      totalHours: Math.round(totalHours * 100) / 100,\n    };\n  }\n\n  private calculateHoursDecimal(clockIn: string, clockOut: string): number {\n    const [inHours, inMinutes] = clockIn.split(':').map(Number);\n    const [outHours, outMinutes] = clockOut.split(':').map(Number);\n\n    let totalMinutes = (outHours * 60 + outMinutes) - (inHours * 60 + inMinutes);\n    \n    // Handle overnight shifts\n    if (totalMinutes < 0) {\n      totalMinutes += 24 * 60;\n    }\n\n    return totalMinutes / 60;\n  }\n\n  async getCostSummary(filters: { startDate: string, endDate: string, siteId?: number }): Promise<{ regularCost: number, overtimeCost: number, totalCost: number }> {\n    const conditions = [\n      gte(attendance.date, filters.startDate),\n      lte(attendance.date, filters.endDate),\n      eq(attendance.approvalStatus, 'approved'),\n      isNotNull(attendance.clockOut),\n    ];\n\n    if (filters.siteId !== undefined) {\n      conditions.push(eq(attendance.siteId, filters.siteId));\n    }\n\n    const records = await db\n      .select({\n        attendance: attendance,\n        user: users,\n      })\n      .from(attendance)\n      .innerJoin(users, eq(attendance.userId, users.id))\n      .where(and(...conditions));\n\n    let regularCost = 0;\n    let overtimeCost = 0;\n\n    for (const record of records) {\n      const hours = this.calculateHoursDecimal(record.attendance.clockIn, record.attendance.clockOut!);\n      const hourlyRate = parseFloat(record.user.hourlyRate || '0');\n      const overtimeRate = hourlyRate * 1.5; // 1.5x for overtime\n\n      if (hours > 8) {\n        regularCost += 8 * hourlyRate;\n        overtimeCost += (hours - 8) * overtimeRate;\n      } else {\n        regularCost += hours * hourlyRate;\n      }\n    }\n\n    return {\n      regularCost: Math.round(regularCost * 100) / 100,\n      overtimeCost: Math.round(overtimeCost * 100) / 100,\n      totalCost: Math.round((regularCost + overtimeCost) * 100) / 100,\n    };\n  }\n\n  async getAttendanceSummary(filters: { startDate: string, endDate: string, siteId?: number }): Promise<{ total: number, pending: number, approved: number, rejected: number, onTime: number, late: number }> {\n    const conditions = [\n      gte(attendance.date, filters.startDate),\n      lte(attendance.date, filters.endDate),\n    ];\n\n    if (filters.siteId !== undefined) {\n      conditions.push(eq(attendance.siteId, filters.siteId));\n    }\n\n    const records = await db\n      .select({\n        attendance: attendance,\n        shift: shifts,\n      })\n      .from(attendance)\n      .leftJoin(shifts, eq(attendance.shiftId, shifts.id))\n      .where(and(...conditions));\n\n    let total = records.length;\n    let pending = 0;\n    let approved = 0;\n    let rejected = 0;\n    let onTime = 0;\n    let late = 0;\n\n    for (const record of records) {\n      // Count by approval status\n      if (record.attendance.approvalStatus === 'pending') pending++;\n      if (record.attendance.approvalStatus === 'approved') approved++;\n      if (record.attendance.approvalStatus === 'rejected') rejected++;\n\n      // Count on-time vs late (if there's a shift to compare against)\n      if (record.shift) {\n        const clockInTime = record.attendance.clockIn;\n        const shiftStartTime = record.shift.startTime;\n        \n        if (clockInTime <= shiftStartTime) {\n          onTime++;\n        } else {\n          late++;\n        }\n      }\n    }\n\n    return { total, pending, approved, rejected, onTime, late };\n  }\n\n  async getSiteSummary(): Promise<{ siteId: number, siteName: string, activeWorkers: number, totalShifts: number, totalHours: number, totalCost: number }[]> {\n    const allSites = await this.getAllSites();\n    const summaries = [];\n\n    for (const site of allSites) {\n      // Get active workers at this site\n      const activeWorkers = await db\n        .select()\n        .from(users)\n        .where(and(eq(users.siteId, site.id), eq(users.isActive, true)));\n\n      // Get total shifts for this site (current week)\n      const now = new Date();\n      const startOfWeek = new Date(now);\n      startOfWeek.setDate(now.getDate() - now.getDay());\n      const endOfWeek = new Date(startOfWeek);\n      endOfWeek.setDate(startOfWeek.getDate() + 6);\n\n      const siteShifts = await db\n        .select()\n        .from(shifts)\n        .where(and(\n          eq(shifts.siteId, site.id),\n          gte(shifts.date, startOfWeek.toISOString().split('T')[0]),\n          lte(shifts.date, endOfWeek.toISOString().split('T')[0])\n        ));\n\n      // Get hours and cost for this site (current week)\n      const hoursSummary = await this.getHoursSummary({\n        startDate: startOfWeek.toISOString().split('T')[0],\n        endDate: endOfWeek.toISOString().split('T')[0],\n        siteId: site.id,\n      });\n\n      const costSummary = await this.getCostSummary({\n        startDate: startOfWeek.toISOString().split('T')[0],\n        endDate: endOfWeek.toISOString().split('T')[0],\n        siteId: site.id,\n      });\n\n      summaries.push({\n        siteId: site.id,\n        siteName: site.name,\n        activeWorkers: activeWorkers.length,\n        totalShifts: siteShifts.length,\n        totalHours: hoursSummary.totalHours,\n        totalCost: costSummary.totalCost,\n      });\n    }\n\n    return summaries;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":40944},"client/src/components/examples/attendance-row.tsx":{"content":"import { AttendanceRow } from \"../attendance-row\";\nimport { Card } from \"@/components/ui/card\";\n\nexport default function AttendanceRowExample() {\n  return (\n    <div className=\"p-4\">\n      <Card>\n        <AttendanceRow\n          id=\"1\"\n          staffName=\"Sarah Johnson\"\n          initials=\"SJ\"\n          site=\"Kent Site\"\n          clockIn=\"08:05\"\n          clockOut=\"16:10\"\n          status=\"late\"\n          duration=\"8h 5m\"\n        />\n        <AttendanceRow\n          id=\"2\"\n          staffName=\"Mike Chen\"\n          initials=\"MC\"\n          site=\"London Site\"\n          clockIn=\"14:00\"\n          status=\"on-time\"\n          onApprove={() => console.log(\"Approved\")}\n          onReject={() => console.log(\"Rejected\")}\n        />\n        <AttendanceRow\n          id=\"3\"\n          staffName=\"Emma Wilson\"\n          initials=\"EW\"\n          site=\"Essex Site\"\n          clockIn=\"07:55\"\n          clockOut=\"16:00\"\n          status=\"pending-approval\"\n          duration=\"8h 5m\"\n          onApprove={() => console.log(\"Approved\")}\n          onReject={() => console.log(\"Rejected\")}\n        />\n      </Card>\n    </div>\n  );\n}\n","size_bytes":1118},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/reports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { format } from \"date-fns\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Clock, DollarSign, Users, TrendingUp, Download, CalendarIcon, CheckCircle2, XCircle, AlertCircle } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nexport default function Reports() {\n  // Calculate default date range (current week)\n  const now = new Date();\n  const startOfWeek = new Date(now);\n  startOfWeek.setDate(now.getDate() - now.getDay());\n  const endOfWeek = new Date(startOfWeek);\n  endOfWeek.setDate(startOfWeek.getDate() + 6);\n\n  const [startDate, setStartDate] = useState<Date>(startOfWeek);\n  const [endDate, setEndDate] = useState<Date>(endOfWeek);\n  const [selectedSite, setSelectedSite] = useState<string>(\"all\");\n\n  // Format dates for API\n  const formatDate = (date: Date) => format(date, \"yyyy-MM-dd\");\n\n  // Build query params\n  const getQueryParams = () => {\n    const params = new URLSearchParams({\n      startDate: formatDate(startDate),\n      endDate: formatDate(endDate),\n    });\n    if (selectedSite !== \"all\") {\n      params.append(\"siteId\", selectedSite);\n    }\n    return params.toString();\n  };\n\n  // Fetch sites for filter\n  const { data: sites } = useQuery<any[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  // Fetch analytics data\n  const { data: hoursData, isLoading: hoursLoading } = useQuery({\n    queryKey: [\"/api/analytics/hours\", getQueryParams()],\n    queryFn: async () => {\n      const res = await fetch(`/api/analytics/hours?${getQueryParams()}`);\n      if (!res.ok) throw new Error(\"Failed to fetch hours data\");\n      return res.json();\n    },\n  });\n\n  const { data: costsData, isLoading: costsLoading } = useQuery({\n    queryKey: [\"/api/analytics/costs\", getQueryParams()],\n    queryFn: async () => {\n      const res = await fetch(`/api/analytics/costs?${getQueryParams()}`);\n      if (!res.ok) throw new Error(\"Failed to fetch costs data\");\n      return res.json();\n    },\n  });\n\n  const { data: attendanceData, isLoading: attendanceLoading } = useQuery({\n    queryKey: [\"/api/analytics/attendance\", getQueryParams()],\n    queryFn: async () => {\n      const res = await fetch(`/api/analytics/attendance?${getQueryParams()}`);\n      if (!res.ok) throw new Error(\"Failed to fetch attendance data\");\n      return res.json();\n    },\n  });\n\n  const { data: sitesData, isLoading: sitesLoading } = useQuery({\n    queryKey: [\"/api/analytics/sites\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/analytics/sites\");\n      if (!res.ok) throw new Error(\"Failed to fetch sites data\");\n      return res.json();\n    },\n  });\n\n  const isLoading = hoursLoading || costsLoading || attendanceLoading || sitesLoading;\n\n  // Calculate metrics\n  const totalHours = hoursData?.totalHours || 0;\n  const overtimeHours = hoursData?.overtimeHours || 0;\n  const totalCost = costsData?.totalCost || 0;\n  const attendanceRate = attendanceData?.total\n    ? Math.round((attendanceData.approved / attendanceData.total) * 100)\n    : 0;\n  const avgHoursPerWorker = sitesData?.length\n    ? Math.round((totalHours / sitesData.reduce((acc: number, s: any) => acc + s.activeWorkers, 0)) * 10) / 10\n    : 0;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">Reports & Analytics</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Hours, costs, and compliance tracking\n          </p>\n        </div>\n        <Button variant=\"outline\" data-testid=\"button-export-report\">\n          <Download className=\"h-4 w-4 mr-2\" />\n          Export Report\n        </Button>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex flex-col gap-4 md:flex-row md:items-end\">\n            <div className=\"flex-1\">\n              <label className=\"text-sm font-medium mb-2 block\">Start Date</label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\n                      \"w-full justify-start text-left font-normal\",\n                      !startDate && \"text-muted-foreground\"\n                    )}\n                    data-testid=\"button-start-date\"\n                  >\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                    {startDate ? format(startDate, \"PPP\") : <span>Pick a date</span>}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\">\n                  <Calendar\n                    mode=\"single\"\n                    selected={startDate}\n                    onSelect={(date) => date && setStartDate(date)}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            <div className=\"flex-1\">\n              <label className=\"text-sm font-medium mb-2 block\">End Date</label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\n                      \"w-full justify-start text-left font-normal\",\n                      !endDate && \"text-muted-foreground\"\n                    )}\n                    data-testid=\"button-end-date\"\n                  >\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                    {endDate ? format(endDate, \"PPP\") : <span>Pick a date</span>}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\">\n                  <Calendar\n                    mode=\"single\"\n                    selected={endDate}\n                    onSelect={(date) => date && setEndDate(date)}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            <div className=\"flex-1\">\n              <label className=\"text-sm font-medium mb-2 block\">Site</label>\n              <Select value={selectedSite} onValueChange={setSelectedSite}>\n                <SelectTrigger data-testid=\"select-site-filter\">\n                  <SelectValue placeholder=\"All Sites\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Sites</SelectItem>\n                  {sites?.map((site) => (\n                    <SelectItem key={site.id} value={site.id.toString()}>\n                      {site.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Summary Cards */}\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {[1, 2, 3, 4].map((i) => (\n            <Card key={i}>\n              <CardHeader className=\"space-y-0 pb-2\">\n                <Skeleton className=\"h-4 w-24\" />\n              </CardHeader>\n              <CardContent>\n                <Skeleton className=\"h-8 w-20 mb-1\" />\n                <Skeleton className=\"h-3 w-32\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card data-testid=\"card-total-hours\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <p className=\"text-sm font-medium text-muted-foreground\">Total Hours</p>\n              <Clock className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold\">{totalHours.toFixed(1)}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                {overtimeHours.toFixed(1)} overtime hours\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-total-cost\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <p className=\"text-sm font-medium text-muted-foreground\">Total Cost</p>\n              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold\">£{totalCost.toLocaleString()}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                £{costsData?.overtimeCost?.toFixed(2) || 0} overtime\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-attendance-rate\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <p className=\"text-sm font-medium text-muted-foreground\">Attendance Rate</p>\n              <CheckCircle2 className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold\">{attendanceRate}%</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                {attendanceData?.approved || 0} approved records\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-avg-hours\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <p className=\"text-sm font-medium text-muted-foreground\">Avg Hours/Worker</p>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold\">{avgHoursPerWorker.toFixed(1)}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Per worker this period\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Charts Section */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Hours by Site</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {sitesLoading ? (\n              <div className=\"space-y-4\">\n                {[1, 2, 3].map((i) => (\n                  <div key={i}>\n                    <Skeleton className=\"h-4 w-full mb-2\" />\n                    <Skeleton className=\"h-2 w-full\" />\n                  </div>\n                ))}\n              </div>\n            ) : sitesData && sitesData.length > 0 ? (\n              <div className=\"space-y-4\" data-testid=\"chart-hours-by-site\">\n                {sitesData.map((site: any, index: number) => {\n                  const maxHours = Math.max(...sitesData.map((s: any) => s.totalHours));\n                  const percentage = maxHours > 0 ? (site.totalHours / maxHours) * 100 : 0;\n                  const colors = [\"bg-chart-1\", \"bg-chart-2\", \"bg-chart-3\", \"bg-chart-4\", \"bg-chart-5\"];\n                  \n                  return (\n                    <div key={site.siteId}>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-sm font-medium\">{site.siteName}</span>\n                        <span className=\"text-sm font-mono\">{site.totalHours.toFixed(1)}h</span>\n                      </div>\n                      <div className=\"h-2 bg-secondary rounded-full overflow-hidden\">\n                        <div \n                          className={`h-full ${colors[index % colors.length]}`}\n                          style={{ width: `${percentage}%` }} \n                        />\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground text-center py-8\">\n                No site data available\n              </p>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Cost Breakdown</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {costsLoading ? (\n              <div className=\"space-y-3\">\n                {[1, 2, 3].map((i) => (\n                  <div key={i} className=\"flex justify-between\">\n                    <Skeleton className=\"h-4 w-24\" />\n                    <Skeleton className=\"h-4 w-20\" />\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"space-y-3\" data-testid=\"breakdown-cost\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm text-muted-foreground\">Regular Pay</span>\n                  <span className=\"font-mono font-medium\">\n                    £{costsData?.regularCost?.toLocaleString() || 0}\n                  </span>\n                </div>\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm text-muted-foreground\">Overtime</span>\n                  <span className=\"font-mono font-medium\">\n                    £{costsData?.overtimeCost?.toLocaleString() || 0}\n                  </span>\n                </div>\n                <div className=\"border-t pt-3 flex justify-between items-center\">\n                  <span className=\"font-medium\">Total</span>\n                  <span className=\"font-mono font-bold text-lg\">\n                    £{costsData?.totalCost?.toLocaleString() || 0}\n                  </span>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Attendance Status */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Attendance Status Distribution</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {attendanceLoading ? (\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              {[1, 2, 3, 4].map((i) => (\n                <Skeleton key={i} className=\"h-20\" />\n              ))}\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\" data-testid=\"breakdown-attendance\">\n              <div className=\"flex flex-col items-center p-4 rounded-lg border\">\n                <CheckCircle2 className=\"h-8 w-8 text-green-500 mb-2\" />\n                <span className=\"text-2xl font-bold\">{attendanceData?.approved || 0}</span>\n                <span className=\"text-sm text-muted-foreground\">Approved</span>\n              </div>\n              <div className=\"flex flex-col items-center p-4 rounded-lg border\">\n                <AlertCircle className=\"h-8 w-8 text-yellow-500 mb-2\" />\n                <span className=\"text-2xl font-bold\">{attendanceData?.pending || 0}</span>\n                <span className=\"text-sm text-muted-foreground\">Pending</span>\n              </div>\n              <div className=\"flex flex-col items-center p-4 rounded-lg border\">\n                <XCircle className=\"h-8 w-8 text-red-500 mb-2\" />\n                <span className=\"text-2xl font-bold\">{attendanceData?.rejected || 0}</span>\n                <span className=\"text-sm text-muted-foreground\">Rejected</span>\n              </div>\n              <div className=\"flex flex-col items-center p-4 rounded-lg border\">\n                <Clock className=\"h-8 w-8 text-blue-500 mb-2\" />\n                <span className=\"text-2xl font-bold\">{attendanceData?.total || 0}</span>\n                <span className=\"text-sm text-muted-foreground\">Total</span>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Site Summary Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Site Performance Summary</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {sitesLoading ? (\n            <div className=\"space-y-2\">\n              {[1, 2, 3].map((i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : sitesData && sitesData.length > 0 ? (\n            <div className=\"overflow-x-auto\" data-testid=\"table-site-summary\">\n              <table className=\"w-full\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th className=\"text-left py-3 px-4 font-medium\">Site</th>\n                    <th className=\"text-left py-3 px-4 font-medium\">Active Workers</th>\n                    <th className=\"text-left py-3 px-4 font-medium\">Total Shifts</th>\n                    <th className=\"text-left py-3 px-4 font-medium\">Total Hours</th>\n                    <th className=\"text-left py-3 px-4 font-medium\">Total Cost</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {sitesData.map((site: any) => (\n                    <tr key={site.siteId} className=\"border-b last:border-0\">\n                      <td className=\"py-3 px-4 font-medium\">{site.siteName}</td>\n                      <td className=\"py-3 px-4\">{site.activeWorkers}</td>\n                      <td className=\"py-3 px-4\">{site.totalShifts}</td>\n                      <td className=\"py-3 px-4 font-mono\">{site.totalHours.toFixed(1)}h</td>\n                      <td className=\"py-3 px-4 font-mono\">£{site.totalCost.toLocaleString()}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          ) : (\n            <p className=\"text-sm text-muted-foreground text-center py-8\">\n              No site data available\n            </p>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":17950},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* CHARCOAL THEME WITH PURPLE, WHITE, GOLD & BROWN ACCENTS */\n:root {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  /* CHARCOAL BACKGROUNDS */\n  --background: 0 0% 12%;\n\n  /* WHITE PRIMARY TEXT */\n  --foreground: 0 0% 98%;\n\n  /* SUBTLE BORDERS */\n  --border: 0 0% 22%;\n\n  /* SLIGHTLY LIGHTER CHARCOAL FOR CARDS */\n  --card: 0 0% 16%;\n\n  /* WHITE TEXT ON CARDS */\n  --card-foreground: 0 0% 98%;\n\n  --card-border: 0 0% 24%;\n\n  /* SIDEBAR - DARKER CHARCOAL */\n  --sidebar: 0 0% 10%;\n\n  /* WHITE SIDEBAR TEXT */\n  --sidebar-foreground: 0 0% 98%;\n\n  --sidebar-border: 0 0% 18%;\n\n  /* PURPLE PRIMARY */\n  --sidebar-primary: 270 75% 60%;\n\n  --sidebar-primary-foreground: 0 0% 100%;\n\n  --sidebar-accent: 270 20% 20%;\n\n  /* LIGHT PURPLE TEXT */\n  --sidebar-accent-foreground: 270 50% 85%;\n\n  --sidebar-ring: 270 75% 60%;\n\n  /* POPOVERS */\n  --popover: 0 0% 14%;\n\n  --popover-foreground: 0 0% 98%;\n\n  --popover-border: 0 0% 26%;\n\n  /* PURPLE PRIMARY BUTTONS/LINKS */\n  --primary: 270 75% 60%;\n\n  --primary-foreground: 0 0% 100%;\n\n  /* BROWN SECONDARY */\n  --secondary: 25 40% 35%;\n\n  --secondary-foreground: 0 0% 98%;\n\n  /* MUTED CHARCOAL */\n  --muted: 0 0% 20%;\n\n  /* LIGHT PURPLE MUTED TEXT */\n  --muted-foreground: 270 30% 70%;\n\n  /* GOLD ACCENT */\n  --accent: 45 90% 55%;\n\n  /* DARK TEXT ON GOLD */\n  --accent-foreground: 0 0% 12%;\n\n  --destructive: 0 84% 60%;\n\n  --destructive-foreground: 0 0% 100%;\n\n  --input: 0 0% 28%;\n  --ring: 270 75% 60%;\n  \n  /* CHART COLORS - PURPLE, GOLD, BROWN THEME */\n  --chart-1: 270 75% 60%;\n  --chart-2: 45 90% 55%;\n  --chart-3: 25 50% 50%;\n  --chart-4: 280 65% 65%;\n  --chart-5: 40 85% 60%;\n\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: JetBrains Mono, monospace;\n  --radius: .5rem;\n  \n  /* DARK SHADOWS FOR CHARCOAL THEME */\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.20);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.25);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.25), 0px 1px 2px -1px hsl(0 0% 0% / 0.30);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.30), 0px 1px 2px -1px hsl(0 0% 0% / 0.35);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.35), 0px 2px 4px -1px hsl(0 0% 0% / 0.40);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.40), 0px 4px 6px -1px hsl(0 0% 0% / 0.45);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.45), 0px 8px 10px -1px hsl(0 0% 0% / 0.50);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.55);\n  \n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders */\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n/* LIGHT MODE VARIANT (if user toggles light mode) */\n.light {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  --opaque-button-border-intensity: -8;\n\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 100%;\n  --foreground: 0 0% 12%;\n  --border: 214 15% 91%;\n  --card: 210 20% 98%;\n  --card-foreground: 0 0% 12%;\n  --card-border: 214 15% 91%;\n  \n  --sidebar: 210 20% 96%;\n  --sidebar-foreground: 0 0% 12%;\n  --sidebar-border: 214 15% 88%;\n  --sidebar-primary: 270 75% 50%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 214 15% 93%;\n  --sidebar-accent-foreground: 0 0% 12%;\n  --sidebar-ring: 270 75% 50%;\n  \n  --popover: 214 15% 94%;\n  --popover-foreground: 0 0% 12%;\n  --popover-border: 214 15% 86%;\n  \n  --primary: 270 75% 50%;\n  --primary-foreground: 0 0% 100%;\n  \n  --secondary: 25 40% 40%;\n  --secondary-foreground: 0 0% 100%;\n  \n  --muted: 214 12% 92%;\n  --muted-foreground: 215 16% 47%;\n  \n  --accent: 45 90% 50%;\n  --accent-foreground: 0 0% 12%;\n  \n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  \n  --input: 214 15% 75%;\n  --ring: 270 75% 50%;\n  \n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.02);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.03);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.03), 0px 1px 2px -1px hsl(0 0% 0% / 0.05);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.03), 0px 1px 2px -1px hsl(0 0% 0% / 0.06);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.04), 0px 2px 4px -1px hsl(0 0% 0% / 0.08);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.05), 0px 4px 6px -1px hsl(0 0% 0% / 0.10);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.06), 0px 8px 10px -1px hsl(0 0% 0% / 0.12);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.15);\n\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: -1;\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: 999;\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","size_bytes":8515},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"design_guidelines.md":{"content":"# Design Guidelines: Workforce Management Platform\n\n## Design Approach\n\n**Selected Approach:** Charcoal Luxury Theme - Sophisticated & Modern\n\n**Rationale:** A premium, professional aesthetic using a rich charcoal background with elegant purple, white, gold, and brown accents. This creates visual hierarchy while maintaining a modern, enterprise feel.\n\n**Key Principles:**\n- Charcoal background for reduced eye strain and premium feel\n- Purple and white text for primary content\n- Gold accents for highlights and important actions\n- Brown accents for secondary elements\n- High contrast for readability\n- Elegant, professional appearance\n\n---\n\n## Core Design Elements\n\n### A. Color Palette\n\n**Charcoal Theme (Default):**\n- **Background**: 0 0% 12% (deep charcoal, almost black)\n- **Surface/Cards**: 0 0% 16% (slightly lighter charcoal)\n- **Border**: 0 0% 22% (subtle charcoal borders)\n- **Text Primary**: 0 0% 98% (crisp white)\n- **Text Secondary**: 270 30% 70% (light purple)\n- **Primary Brand**: 270 75% 60% (vibrant purple for buttons/links)\n- **Accent Gold**: 45 90% 55% (warm gold for highlights)\n- **Accent Brown**: 25 40% 35% (rich brown for secondary elements)\n- **Success**: 142 71% 55% (green for approved/success states)\n- **Warning**: 38 92% 60% (amber for warnings)\n- **Error**: 0 84% 60% (red for errors/conflicts)\n\n**Site-Specific Colors:**\n- Site Kent: 280 65% 60% (purple - complementary to primary)\n- Site London: 168 76% 42% (teal)\n- Site Essex: 30 85% 55% (orange)\n\n**Usage Guidelines:**\n- Use white (98%) for primary headings and important text\n- Use light purple (270 30% 70%) for body text and secondary information\n- Use vibrant purple (270 75% 60%) for interactive elements, links, primary buttons\n- Use gold (45 90% 55%) sparingly for special highlights, premium features, or key metrics\n- Use brown (25 40% 35%) for secondary buttons, alternate cards, or tertiary information\n- Maintain high contrast between text and background (minimum 7:1 ratio)\n\n---\n\n### B. Typography\n\n**Font Families:**\n- Primary: 'Inter' - Clean, modern sans-serif for UI and data\n- Monospace: 'JetBrains Mono' - For timestamps, IDs, codes\n\n**Scale:**\n- Page Title: text-3xl font-semibold text-white (30px white)\n- Section Header: text-xl font-semibold text-white (20px white)\n- Card Title: text-base font-medium text-white (16px white)\n- Body Text: text-sm text-purple-200 (14px light purple)\n- Caption/Meta: text-xs text-muted-foreground (12px muted purple)\n- Emphasis: text-accent (gold) or text-primary (purple)\n\n**Hierarchy:**\n- White for main headings and labels\n- Light purple for body text and descriptions\n- Purple for interactive elements\n- Gold for special emphasis\n- Use font-weight (medium 500, semibold 600, bold 700) to create hierarchy\n\n---\n\n### C. Layout System\n\n**Spacing Primitives:**\n- Primary units: 2, 4, 6, 8 (0.5rem, 1rem, 1.5rem, 2rem)\n- Component padding: p-4 or p-6\n- Section spacing: space-y-6 or space-y-8\n- Card gaps: gap-4\n- Page margins: px-4 md:px-6 lg:px-8\n\n**Grid Structure:**\n- Admin: Darker charcoal sidebar (0 0% 10%) + Main content area\n- Content max-width: max-w-7xl mx-auto\n- Card grids: grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\n- Tables: Full width with horizontal scroll on mobile\n\n**Responsive Breakpoints:**\n- Mobile: base (< 640px) - Single column\n- Tablet: md (≥ 768px) - 2 columns\n- Desktop: lg (≥ 1024px) - Full multi-column\n\n---\n\n### D. Component Library\n\n**Navigation:**\n- Admin Sidebar: Darker charcoal (0 0% 10%) with white text and purple highlights\n- Active items: Purple background with white text\n- Hover: Subtle purple glow\n- Worker Mobile: Bottom tabs with purple active state\n\n**Cards:**\n- Background: Charcoal (0 0% 16%)\n- Border: Subtle (0 0% 24%)\n- Padding: p-4 or p-6\n- Shadow: Elevated shadows for depth\n- Title: White, bold\n- Content: Light purple text\n\n**Buttons:**\n- **Primary**: Purple background (270 75% 60%) + white text\n  - Hover: Slightly lighter purple\n  - Active: Slightly darker purple\n- **Secondary**: Brown background (25 40% 35%) + white text\n- **Accent/Special**: Gold background (45 90% 55%) + dark text\n- **Ghost**: Transparent + purple text, hover shows purple background\n- Icon buttons: p-2 with purple hover\n\n**Status Badges:**\n- Pill shape: rounded-full px-2.5 py-0.5 text-xs font-medium\n- Color-coded backgrounds with white text:\n  - Success: Green tint\n  - Warning: Gold/amber tint\n  - Error: Red tint\n  - Info: Purple tint\n  - Neutral: Brown tint\n\n**Forms:**\n- Input fields: Dark charcoal background with light borders\n- Text: White input text, light purple placeholder\n- Focus: Purple ring (ring-2 ring-primary)\n- Labels: White, font-medium\n- Helper text: Light purple\n\n**Data Tables:**\n- Header: White text on darker charcoal\n- Rows: Alternating subtle charcoal shades\n- Hover: Purple tint overlay\n- Numbers/data: Monospace font in white\n\n**Modals/Dialogs:**\n- Overlay: bg-black/70 backdrop-blur\n- Dialog: Charcoal background with borders\n- Header: White text\n- Content: Light purple text\n- Actions: Purple and brown buttons\n\n**Stats Cards:**\n- Large numbers: White, text-3xl font-bold\n- Labels: Light purple, text-sm\n- Icons: Gold or purple\n- Background: Slightly lighter charcoal with subtle border\n\n---\n\n### E. Module-Specific Patterns\n\n**Shift Scheduling (Rota):**\n- Weekly grid with charcoal cells\n- Shift cards: Lighter charcoal with colored left border (site color)\n- Text: White for names, light purple for details\n- Conflicts: Red border with warning badge\n\n**Attendance:**\n- Live status: Green pulse for \"Clocked In\"\n- Approval queue: Purple checkboxes\n- Duration: Monospace white text\n- Status badges: Color-coded\n\n**Room Scans:**\n- QR code: White on dark background\n- Expiry countdown: Gold text when < 2 minutes\n- Scan log: Monospace timestamps in light purple\n- Confidence score: Color gradient (green to red)\n\n**Payroll:**\n- Pay period card: White heading, light purple dates\n- Amounts: Large white numbers with currency symbol\n- Line items: Light purple with brown separators\n- Totals: Bold white with gold highlight\n- Download button: Gold accent\n\n**Reports:**\n- Charts: Purple, gold, brown color scheme\n- Filter bar: Darker charcoal with white inputs\n- Summary cards: Gold icons, white numbers\n- Export: Purple button with download icon\n\n**Worker Mobile:**\n- Large touch targets (min 44px)\n- Bottom nav: Purple active state\n- Quick actions: Purple buttons\n- Status: Color-coded badges\n- Clock display: Large white numbers\n\n---\n\n### F. Interactive States\n\n**Hover:** \n- Purple tint overlay\n- Shadow increase\n- Smooth transition (150ms)\n\n**Active:** \n- Slightly deeper purple\n- Subtle scale (active:scale-98)\n\n**Focus:** \n- Purple ring (focus:ring-2 ring-primary)\n- Outline offset\n\n**Loading:** \n- Purple spinner\n- Disabled state with opacity-50\n\n**Empty States:** \n- Purple icon\n- White heading\n- Light purple message\n- Gold action button\n\n**Animations:**\n- Minimal, purposeful only\n- Transitions: 150-200ms ease-out\n- NO decorative animations\n\n---\n\n### G. Special Elements\n\n**Gold Accents - Use For:**\n- Important metrics/KPIs\n- Premium features\n- Achievement indicators\n- Special highlights\n- Download/export buttons\n- Promotional badges\n\n**Brown Accents - Use For:**\n- Secondary buttons\n- Alternate cards\n- Supporting information\n- Tertiary navigation\n- Background variations\n- Subtle dividers\n\n**Purple Gradients:**\n- Use sparingly for hero sections\n- CTAs and important banners\n- Status indicators\n- Progress bars\n\n---\n\n## Implementation Notes\n\n- Charcoal theme is the default\n- Light mode available as fallback (toggle if needed)\n- All text maintains 7:1 contrast ratio minimum\n- Purple used for all primary interactive elements\n- Gold reserved for special emphasis and highlights\n- Brown for secondary/supporting elements\n- White for primary text and headings\n- Light purple for body text and descriptions\n- Strict consistency across all components\n- Mobile-first responsive design\n- Accessibility: Color + icon + text for all status indicators\n","size_bytes":7973},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/lib/theme-provider\";\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={() => setTheme(theme === \"light\" ? \"dark\" : \"light\")}\n      data-testid=\"button-theme-toggle\"\n    >\n      <Sun className=\"h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n      <Moon className=\"absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}\n","size_bytes":670},"client/src/pages/rota.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { ShiftCard } from \"@/components/shift-card\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Plus, Calendar, ChevronLeft, ChevronRight, AlertTriangle } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertShiftSchema, type InsertShift, type Shift, type User, type Site } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format, addWeeks, startOfWeek, endOfWeek, addDays } from \"date-fns\";\n\ntype ShiftWithDetails = Shift & { user: User; site: Site };\n\nconst shiftFormSchema = insertShiftSchema.extend({\n  date: z.string().min(1, \"Date is required\"),\n  startTime: z.string().regex(/^\\d{2}:\\d{2}$/, \"Time must be in HH:MM format\"),\n  endTime: z.string().regex(/^\\d{2}:\\d{2}$/, \"Time must be in HH:MM format\"),\n});\n\nexport default function Rota() {\n  const { toast } = useToast();\n  const [currentWeek, setCurrentWeek] = useState(new Date());\n  const [selectedSiteId, setSelectedSiteId] = useState<number | null>(null);\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\n  const [conflictWarning, setConflictWarning] = useState(false);\n\n  const weekStart = startOfWeek(currentWeek, { weekStartsOn: 1 });\n  const weekEnd = endOfWeek(currentWeek, { weekStartsOn: 1 });\n\n  const weekDays = useMemo(() => {\n    return Array.from({ length: 7 }, (_, i) => {\n      const date = addDays(weekStart, i);\n      return {\n        name: format(date, 'EEEE'),\n        date: format(date, 'yyyy-MM-dd'),\n        displayDate: format(date, 'MMM d'),\n      };\n    });\n  }, [weekStart]);\n\n  const { data: sites = [], isLoading: sitesLoading } = useQuery<Site[]>({\n    queryKey: ['/api/sites'],\n  });\n\n  const { data: users = [], isLoading: usersLoading } = useQuery<User[]>({\n    queryKey: ['/api/users'],\n  });\n\n  const { data: shifts = [], isLoading: shiftsLoading } = useQuery<ShiftWithDetails[]>({\n    queryKey: ['/api/shifts', selectedSiteId],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (selectedSiteId) {\n        params.append('siteId', selectedSiteId.toString());\n      }\n      const response = await fetch(`/api/shifts?${params}`);\n      if (!response.ok) throw new Error('Failed to fetch shifts');\n      return response.json();\n    },\n  });\n\n  const createShiftMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof shiftFormSchema>) => {\n      const response = await fetch('/api/shifts', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n        credentials: 'include',\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to create shift');\n      }\n      return response.json();\n    },\n    onSuccess: (response: any) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/shifts'] });\n      setIsCreateDialogOpen(false);\n      form.reset();\n      setConflictWarning(false);\n      \n      if (response.hasConflict) {\n        toast({\n          title: \"Shift created with conflict\",\n          description: \"Warning: This shift overlaps with another shift for the same user.\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Shift created\",\n          description: \"The shift has been successfully created.\",\n        });\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create shift\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  type ShiftFormData = z.infer<typeof shiftFormSchema>;\n\n  const form = useForm<ShiftFormData>({\n    resolver: zodResolver(shiftFormSchema),\n    defaultValues: {\n      userId: \"\",\n      siteId: 0,\n      date: format(new Date(), 'yyyy-MM-dd'),\n      startTime: \"09:00\",\n      endTime: \"17:00\",\n      role: \"\",\n      status: \"scheduled\",\n      notes: \"\",\n    },\n  });\n\n  const shiftsByDay = useMemo(() => {\n    const grouped: Record<string, ShiftWithDetails[]> = {};\n    \n    weekDays.forEach(day => {\n      grouped[day.date] = shifts.filter(shift => shift.date === day.date);\n    });\n    \n    return grouped;\n  }, [shifts, weekDays]);\n\n  const getSiteColor = (siteColor: string): \"purple\" | \"teal\" | \"orange\" => {\n    if (siteColor === \"purple\") return \"purple\";\n    if (siteColor === \"teal\") return \"teal\";\n    return \"orange\";\n  };\n\n  const calculateDuration = (startTime: string, endTime: string): string => {\n    const [startHour, startMin] = startTime.split(':').map(Number);\n    const [endHour, endMin] = endTime.split(':').map(Number);\n    const startMinutes = startHour * 60 + startMin;\n    const endMinutes = endHour * 60 + endMin;\n    const durationMinutes = endMinutes - startMinutes;\n    const hours = Math.floor(durationMinutes / 60);\n    const minutes = durationMinutes % 60;\n    return minutes > 0 ? `${hours}h ${minutes}m` : `${hours}h`;\n  };\n\n  async function onSubmit(values: ShiftFormData) {\n    createShiftMutation.mutate(values);\n  }\n\n  const handlePreviousWeek = () => {\n    setCurrentWeek(prev => addWeeks(prev, -1));\n  };\n\n  const handleNextWeek = () => {\n    setCurrentWeek(prev => addWeeks(prev, 1));\n  };\n\n  const isLoading = shiftsLoading || sitesLoading || usersLoading;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">Rota Management</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {format(weekStart, 'MMM d')} - {format(weekEnd, 'MMM d, yyyy')}\n          </p>\n        </div>\n        <div className=\"flex gap-2 flex-wrap\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={handlePreviousWeek}\n              data-testid=\"button-previous-week\"\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => setCurrentWeek(new Date())}\n              data-testid=\"button-current-week\"\n            >\n              Today\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={handleNextWeek}\n              data-testid=\"button-next-week\"\n            >\n              <ChevronRight className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          {!sitesLoading && sites.length > 0 && (\n            <Select\n              value={selectedSiteId?.toString() || \"all\"}\n              onValueChange={(value) => setSelectedSiteId(value === \"all\" ? null : parseInt(value))}\n            >\n              <SelectTrigger className=\"w-[180px]\" data-testid=\"select-site-filter\">\n                <SelectValue placeholder=\"Filter by site\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Sites</SelectItem>\n                {sites.map((site) => (\n                  <SelectItem key={site.id} value={site.id.toString()}>\n                    {site.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          )}\n          <Button onClick={() => setIsCreateDialogOpen(true)} data-testid=\"button-create-shift\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Create Shift\n          </Button>\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className=\"space-y-4\">\n          <Skeleton className=\"h-12 w-full\" />\n          <Skeleton className=\"h-64 w-full\" />\n        </div>\n      ) : (\n        <Tabs defaultValue={weekDays[0].date} className=\"w-full\">\n          <TabsList className=\"w-full justify-start\">\n            {weekDays.map((day) => (\n              <TabsTrigger key={day.date} value={day.date} data-testid={`tab-${day.name.toLowerCase()}`}>\n                <div className=\"flex flex-col items-center\">\n                  <span>{day.name}</span>\n                  <span className=\"text-xs text-muted-foreground\">{day.displayDate}</span>\n                </div>\n              </TabsTrigger>\n            ))}\n          </TabsList>\n          {weekDays.map((day) => (\n            <TabsContent key={day.date} value={day.date} className=\"space-y-4 mt-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">\n                    {day.name}, {day.displayDate} - {shiftsByDay[day.date]?.length || 0} shifts\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    {shiftsByDay[day.date]?.length > 0 ? (\n                      shiftsByDay[day.date].map((shift) => (\n                        <ShiftCard\n                          key={shift.id}\n                          id={shift.id.toString()}\n                          staffName={`${shift.user.firstName || ''} ${shift.user.lastName || ''}`.trim() || 'Unknown'}\n                          role={shift.role}\n                          site={shift.site.name}\n                          siteColor={getSiteColor(shift.site.color)}\n                          startTime={shift.startTime}\n                          endTime={shift.endTime}\n                          status={shift.status as any}\n                          duration={calculateDuration(shift.startTime, shift.endTime)}\n                        />\n                      ))\n                    ) : (\n                      <p className=\"text-sm text-muted-foreground col-span-full text-center py-8\">\n                        No shifts scheduled for this day\n                      </p>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          ))}\n        </Tabs>\n      )}\n\n      <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\n        <DialogContent className=\"max-w-md\" data-testid=\"dialog-create-shift\">\n          <DialogHeader>\n            <DialogTitle>Create New Shift</DialogTitle>\n            <DialogDescription>\n              Schedule a new shift for a staff member. Conflicts will be detected automatically.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"userId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Staff Member</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-user\">\n                          <SelectValue placeholder=\"Select staff member\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {users.map((user) => (\n                          <SelectItem key={user.id} value={user.id}>\n                            {`${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || user.id}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"siteId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Site</FormLabel>\n                    <Select onValueChange={(value) => field.onChange(parseInt(value))} value={field.value?.toString()}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-site\">\n                          <SelectValue placeholder=\"Select site\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {sites.map((site) => (\n                          <SelectItem key={site.id} value={site.id.toString()}>\n                            {site.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"date\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Date</FormLabel>\n                    <FormControl>\n                      <Input type=\"date\" {...field} data-testid=\"input-date\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"startTime\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Start Time</FormLabel>\n                      <FormControl>\n                        <Input type=\"time\" {...field} data-testid=\"input-start-time\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"endTime\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>End Time</FormLabel>\n                      <FormControl>\n                        <Input type=\"time\" {...field} data-testid=\"input-end-time\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"role\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Role</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"e.g., Care Assistant\" data-testid=\"input-role\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Notes (Optional)</FormLabel>\n                    <FormControl>\n                      <Textarea {...field} placeholder=\"Any additional notes...\" data-testid=\"input-notes\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {conflictWarning && (\n                <Alert variant=\"destructive\">\n                  <AlertTriangle className=\"h-4 w-4\" />\n                  <AlertDescription>\n                    Warning: This shift may conflict with existing shifts for this user.\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setIsCreateDialogOpen(false);\n                    form.reset();\n                    setConflictWarning(false);\n                  }}\n                  data-testid=\"button-cancel\"\n                >\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={createShiftMutation.isPending} data-testid=\"button-submit\">\n                  {createShiftMutation.isPending ? \"Creating...\" : \"Create Shift\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":17096},"client/src/pages/dashboard.tsx":{"content":"import { StatCard } from \"@/components/stat-card\";\nimport { ShiftCard } from \"@/components/shift-card\";\nimport { AttendanceRow } from \"@/components/attendance-row\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Users, Clock, AlertCircle, DollarSign, ArrowRight } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function Dashboard() {\n  //todo: remove mock functionality\n  const mockShifts = [\n    {\n      id: \"1\",\n      staffName: \"Sarah Johnson\",\n      role: \"Care Assistant\",\n      site: \"Kent\",\n      siteColor: \"purple\" as const,\n      startTime: \"08:00\",\n      endTime: \"16:00\",\n      status: \"in-progress\" as const,\n      duration: \"8h\",\n    },\n    {\n      id: \"2\",\n      staffName: \"Mike Chen\",\n      role: \"Senior Care\",\n      site: \"London\",\n      siteColor: \"teal\" as const,\n      startTime: \"14:00\",\n      endTime: \"22:00\",\n      status: \"scheduled\" as const,\n      duration: \"8h\",\n    },\n    {\n      id: \"3\",\n      staffName: \"Emma Wilson\",\n      role: \"Nurse\",\n      site: \"Essex\",\n      siteColor: \"orange\" as const,\n      startTime: \"22:00\",\n      endTime: \"06:00\",\n      status: \"scheduled\" as const,\n      duration: \"8h\",\n    },\n  ];\n\n  const mockAttendance = [\n    {\n      id: \"1\",\n      staffName: \"David Brown\",\n      initials: \"DB\",\n      site: \"Kent Site\",\n      clockIn: \"07:58\",\n      clockOut: \"16:05\",\n      status: \"pending-approval\" as const,\n      duration: \"8h 7m\",\n    },\n    {\n      id: \"2\",\n      staffName: \"Lisa White\",\n      initials: \"LW\",\n      site: \"London Site\",\n      clockIn: \"08:15\",\n      status: \"late\" as const,\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-semibold\">Overview</h1>\n        <p className=\"text-muted-foreground mt-1\">\n          Workforce management dashboard for all 3 sites\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <StatCard\n          title=\"Total Staff\"\n          value={156}\n          icon={Users}\n          trend={{ value: 12, label: \"from last month\" }}\n        />\n        <StatCard\n          title=\"Clocked In Now\"\n          value={89}\n          icon={Clock}\n          variant=\"success\"\n        />\n        <StatCard\n          title=\"Pending Approvals\"\n          value={7}\n          icon={AlertCircle}\n          variant=\"warning\"\n        />\n        <StatCard\n          title=\"Weekly Payroll\"\n          value=\"£45.2k\"\n          icon={DollarSign}\n          trend={{ value: -3, label: \"from last week\" }}\n        />\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-4\">\n            <CardTitle>Today's Shifts</CardTitle>\n            <Link href=\"/rota\">\n              <Button variant=\"ghost\" size=\"sm\" data-testid=\"link-view-all-shifts\">\n                View All\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </Link>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {mockShifts.map((shift) => (\n              <ShiftCard key={shift.id} {...shift} />\n            ))}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-4\">\n            <CardTitle>Recent Attendance</CardTitle>\n            <Link href=\"/attendance\">\n              <Button variant=\"ghost\" size=\"sm\" data-testid=\"link-view-all-attendance\">\n                View All\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </Link>\n          </CardHeader>\n          <CardContent className=\"space-y-0\">\n            {mockAttendance.map((record) => (\n              <AttendanceRow\n                key={record.id}\n                {...record}\n                onApprove={() => console.log(\"Approved\", record.id)}\n                onReject={() => console.log(\"Rejected\", record.id)}\n              />\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4193},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/examples/stat-card.tsx":{"content":"import { StatCard } from \"../stat-card\";\nimport { Users, Clock, DollarSign, CheckCircle } from \"lucide-react\";\n\nexport default function StatCardExample() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 p-4\">\n      <StatCard\n        title=\"Total Staff\"\n        value={156}\n        icon={Users}\n        trend={{ value: 12, label: \"from last month\" }}\n      />\n      <StatCard\n        title=\"Clocked In\"\n        value={89}\n        icon={Clock}\n        variant=\"success\"\n      />\n      <StatCard\n        title=\"Pending Approvals\"\n        value={7}\n        icon={CheckCircle}\n        variant=\"warning\"\n      />\n      <StatCard\n        title=\"Weekly Payroll\"\n        value=\"£45.2k\"\n        icon={DollarSign}\n        trend={{ value: -3, label: \"from last week\" }}\n      />\n    </div>\n  );\n}\n","size_bytes":823},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/examples/clock-in-widget.tsx":{"content":"import { ClockInWidget } from \"../clock-in-widget\";\nimport { useState } from \"react\";\n\nexport default function ClockInWidgetExample() {\n  const [isClockedIn, setIsClockedIn] = useState(false);\n\n  return (\n    <div className=\"p-4 max-w-md\">\n      <ClockInWidget\n        isClockedIn={isClockedIn}\n        currentSite=\"Kent Site\"\n        clockInTime=\"08:00\"\n        onClockIn={() => {\n          console.log(\"Clocked in\");\n          setIsClockedIn(true);\n        }}\n        onClockOut={() => {\n          console.log(\"Clocked out\");\n          setIsClockedIn(false);\n        }}\n      />\n    </div>\n  );\n}\n","size_bytes":599},"client/src/pages/worker-profile.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { WorkerBottomNav } from \"@/components/worker-bottom-nav\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { User as UserIcon, Mail, MapPin, DollarSign, Calendar } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { User, Site } from \"@shared/schema\";\n\nexport default function WorkerProfile() {\n  const { data: user, isLoading: userLoading } = useQuery<User>({\n    queryKey: ['/api/auth/user'],\n  });\n\n  const { data: sites = [] } = useQuery<Site[]>({\n    queryKey: ['/api/sites'],\n  });\n\n  const userSite = sites.find(s => s.id === user?.siteId);\n\n  if (userLoading) {\n    return (\n      <div className=\"min-h-screen pb-20 md:pb-0\">\n        <div className=\"max-w-2xl mx-auto p-4 space-y-6\">\n          <Skeleton className=\"h-16 w-full\" />\n          <Skeleton className=\"h-48 w-full\" />\n        </div>\n        <WorkerBottomNav />\n      </div>\n    );\n  }\n\n  const getInitials = (firstName?: string | null, lastName?: string | null) => {\n    const first = firstName?.[0] || '';\n    const last = lastName?.[0] || '';\n    return (first + last).toUpperCase() || 'W';\n  };\n\n  return (\n    <div className=\"min-h-screen pb-20 md:pb-0 bg-background\">\n      <div className=\"max-w-2xl mx-auto p-4 space-y-6\">\n        {/* Header */}\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-profile-title\">My Profile</h1>\n          <p className=\"text-muted-foreground mt-1\">View your personal information</p>\n        </div>\n\n        {/* Profile Card */}\n        <Card data-testid=\"card-profile\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-start gap-4 mb-6\">\n              <Avatar className=\"h-20 w-20\">\n                <AvatarImage src={user?.profileImageUrl || undefined} />\n                <AvatarFallback className=\"text-2xl\">\n                  {getInitials(user?.firstName, user?.lastName)}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1\">\n                <h2 className=\"text-2xl font-semibold\" data-testid=\"text-user-name\">\n                  {user?.firstName} {user?.lastName}\n                </h2>\n                <Badge variant=\"outline\" className=\"mt-2 capitalize\">\n                  {user?.role}\n                </Badge>\n              </div>\n            </div>\n\n            <div className=\"space-y-4\">\n              {user?.email && (\n                <div className=\"flex items-center gap-3\">\n                  <Mail className=\"h-5 w-5 text-muted-foreground\" />\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Email</p>\n                    <p className=\"font-medium\" data-testid=\"text-user-email\">{user.email}</p>\n                  </div>\n                </div>\n              )}\n\n              {userSite && (\n                <div className=\"flex items-center gap-3\">\n                  <MapPin className=\"h-5 w-5 text-muted-foreground\" />\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Site</p>\n                    <p className=\"font-medium\" data-testid=\"text-user-site\">\n                      {userSite.name} - {userSite.location}\n                    </p>\n                  </div>\n                </div>\n              )}\n\n              {user?.hourlyRate && (\n                <div className=\"flex items-center gap-3\">\n                  <DollarSign className=\"h-5 w-5 text-muted-foreground\" />\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Hourly Rate</p>\n                    <p className=\"font-medium font-mono\" data-testid=\"text-user-rate\">\n                      £{Number(user.hourlyRate).toFixed(2)}/hour\n                    </p>\n                  </div>\n                </div>\n              )}\n\n              <div className=\"flex items-center gap-3\">\n                <Calendar className=\"h-5 w-5 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Member Since</p>\n                  <p className=\"font-medium\" data-testid=\"text-user-joined\">\n                    {format(new Date(user?.createdAt || new Date()), 'MMMM yyyy')}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Account Status */}\n        <Card data-testid=\"card-account-status\">\n          <CardHeader>\n            <CardTitle className=\"text-base\">Account Status</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm text-muted-foreground\">Account Active</span>\n              <Badge \n                variant=\"outline\" \n                className={\n                  user?.isActive \n                    ? \"bg-chart-5/10 text-chart-5 border-chart-5/20\" \n                    : \"bg-destructive/10 text-destructive border-destructive/20\"\n                }\n              >\n                {user?.isActive ? 'Active' : 'Inactive'}\n              </Badge>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n      <WorkerBottomNav />\n    </div>\n  );\n}\n","size_bytes":5408},"client/src/components/stat-card.tsx":{"content":"import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface StatCardProps {\n  title: string;\n  value: string | number;\n  icon: LucideIcon;\n  trend?: {\n    value: number;\n    label: string;\n  };\n  variant?: \"default\" | \"success\" | \"warning\" | \"destructive\";\n}\n\nconst variantStyles = {\n  default: \"text-foreground\",\n  success: \"text-chart-5\",\n  warning: \"text-chart-4\",\n  destructive: \"text-destructive\",\n};\n\nexport function StatCard({ title, value, icon: Icon, trend, variant = \"default\" }: StatCardProps) {\n  return (\n    <Card data-testid={`stat-card-${title.toLowerCase().replace(/\\s/g, '-')}`}>\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n        <p className=\"text-sm font-medium text-muted-foreground\">{title}</p>\n        <Icon className=\"h-4 w-4 text-muted-foreground\" />\n      </CardHeader>\n      <CardContent>\n        <div className={`text-3xl font-bold ${variantStyles[variant]}`}>{value}</div>\n        {trend && (\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            <span className={trend.value >= 0 ? \"text-chart-5\" : \"text-destructive\"}>\n              {trend.value >= 0 ? \"+\" : \"\"}{trend.value}%\n            </span>{\" \"}\n            {trend.label}\n          </p>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1355},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/examples/room-scan-log.tsx":{"content":"import { RoomScanLog } from \"../room-scan-log\";\nimport { Card } from \"@/components/ui/card\";\n\nexport default function RoomScanLogExample() {\n  return (\n    <div className=\"p-4\">\n      <Card>\n        <RoomScanLog\n          id=\"1\"\n          roomName=\"Room 101 - Patient Ward\"\n          staffName=\"Sarah Johnson\"\n          timestamp=\"22:30\"\n          confidence={98}\n          deviceId=\"KIOSK-01\"\n          status=\"verified\"\n        />\n        <RoomScanLog\n          id=\"2\"\n          roomName=\"Room 205 - Common Area\"\n          staffName=\"Mike Chen\"\n          timestamp=\"23:00\"\n          confidence={75}\n          deviceId=\"MOBILE-42\"\n          status=\"low-confidence\"\n        />\n        <RoomScanLog\n          id=\"3\"\n          roomName=\"Room 310 - Storage\"\n          staffName=\"Emma Wilson\"\n          timestamp=\"23:30\"\n          confidence={45}\n          deviceId=\"KIOSK-02\"\n          status=\"failed\"\n        />\n      </Card>\n    </div>\n  );\n}\n","size_bytes":942},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/examples/theme-toggle.tsx":{"content":"import { ThemeToggle } from \"../theme-toggle\";\nimport { ThemeProvider } from \"@/lib/theme-provider\";\n\nexport default function ThemeToggleExample() {\n  return (\n    <ThemeProvider>\n      <div className=\"p-4\">\n        <ThemeToggle />\n      </div>\n    </ThemeProvider>\n  );\n}\n","size_bytes":273},"client/src/components/shift-card.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Clock, MapPin, User } from \"lucide-react\";\n\ninterface ShiftCardProps {\n  id: string;\n  staffName: string;\n  role: string;\n  site: string;\n  siteColor: \"purple\" | \"teal\" | \"orange\";\n  startTime: string;\n  endTime: string;\n  status: \"scheduled\" | \"in-progress\" | \"completed\" | \"conflict\";\n  duration?: string;\n}\n\nconst siteColors = {\n  purple: \"bg-chart-3/10 text-chart-3 border-chart-3/20\",\n  teal: \"bg-chart-2/10 text-chart-2 border-chart-2/20\",\n  orange: \"bg-chart-4/10 text-chart-4 border-chart-4/20\",\n};\n\nconst statusColors = {\n  scheduled: \"bg-secondary text-secondary-foreground\",\n  \"in-progress\": \"bg-chart-5/10 text-chart-5 border-chart-5/20\",\n  completed: \"bg-muted text-muted-foreground\",\n  conflict: \"bg-destructive/10 text-destructive border-destructive/20\",\n};\n\nexport function ShiftCard({\n  id,\n  staffName,\n  role,\n  site,\n  siteColor,\n  startTime,\n  endTime,\n  status,\n  duration,\n}: ShiftCardProps) {\n  return (\n    <Card\n      className=\"hover-elevate cursor-pointer transition-all\"\n      data-testid={`shift-card-${id}`}\n    >\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start justify-between mb-3\">\n          <div className=\"flex-1 min-w-0\">\n            <h4 className=\"font-medium text-sm truncate\">{staffName}</h4>\n            <p className=\"text-xs text-muted-foreground\">{role}</p>\n          </div>\n          <Badge variant=\"outline\" className={siteColors[siteColor]}>\n            {site}\n          </Badge>\n        </div>\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n            <Clock className=\"h-3 w-3\" />\n            <span className=\"font-mono\">{startTime} - {endTime}</span>\n            {duration && <span>({duration})</span>}\n          </div>\n          <Badge className={statusColors[status]} variant=\"outline\">\n            {status.replace(\"-\", \" \")}\n          </Badge>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":2066},"client/src/lib/authUtils.ts":{"content":"// Following Replit Auth blueprint patterns for error handling\nexport function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","size_bytes":179},"client/src/components/examples/qr-scanner.tsx":{"content":"import { QRScanner } from \"../qr-scanner\";\n\nexport default function QRScannerExample() {\n  return (\n    <div className=\"p-4 max-w-md\">\n      <QRScanner\n        roomName=\"Room 101 - Patient Ward\"\n        roomId=\"101\"\n        onRefresh={() => console.log(\"QR code refreshed\")}\n      />\n    </div>\n  );\n}\n","size_bytes":302},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/pages/settings.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Settings as SettingsIcon, Bell, Shield, Palette, Database } from \"lucide-react\";\n\nexport default function Settings() {\n  const settingsSections = [\n    {\n      title: \"General\",\n      description: \"Manage general application settings\",\n      icon: SettingsIcon,\n    },\n    {\n      title: \"Notifications\",\n      description: \"Configure notification preferences\",\n      icon: Bell,\n    },\n    {\n      title: \"Security\",\n      description: \"Security and authentication settings\",\n      icon: Shield,\n    },\n    {\n      title: \"Appearance\",\n      description: \"Customize the application appearance\",\n      icon: Palette,\n    },\n    {\n      title: \"Data & Backup\",\n      description: \"Data management and backup options\",\n      icon: Database,\n    },\n  ];\n\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-semibold\" data-testid=\"text-page-title\">\n          Settings\n        </h1>\n        <p className=\"text-sm text-muted-foreground mt-1\">\n          Configure your application preferences and settings\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {settingsSections.map((section) => (\n          <Card\n            key={section.title}\n            className=\"hover-elevate cursor-pointer\"\n            data-testid={`card-${section.title.toLowerCase().replace(/\\s/g, '-')}`}\n          >\n            <CardHeader className=\"flex flex-row items-center gap-4 space-y-0 pb-2\">\n              <div className=\"h-10 w-10 rounded-md bg-primary/10 flex items-center justify-center\">\n                <section.icon className=\"h-5 w-5 text-primary\" />\n              </div>\n              <CardTitle className=\"text-base font-medium\">\n                {section.title}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground\">\n                {section.description}\n              </p>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      <Card className=\"p-12\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"mx-auto h-12 w-12 rounded-full bg-muted flex items-center justify-center\">\n            <SettingsIcon className=\"h-6 w-6 text-muted-foreground\" />\n          </div>\n          <div>\n            <h3 className=\"font-medium\">Settings Coming Soon</h3>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Advanced configuration options will be available in a future update\n            </p>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":2699},"server/routes.ts":{"content":"// Following Replit Auth blueprint patterns for route setup\nimport type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated, hasRole } from \"./replitAuth\";\nimport { insertSiteSchema, insertUserSchema, insertShiftSchema, insertAttendanceSchema, insertRoomSchema, insertRoomScanSchema, insertQuerySchema, insertQueryMessageSchema } from \"@shared/schema\";\nimport { z } from \"zod\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Setup Replit Auth middleware and routes\n  await setupAuth(app);\n\n  // Auth routes (required for Replit Auth integration)\n  app.get('/api/auth/user', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Protected test route to verify auth is working\n  app.get(\"/api/protected/test\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      res.json({\n        message: \"Authentication successful\",\n        userId,\n        user,\n      });\n    } catch (error) {\n      console.error(\"Error in protected test route:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  // Site Management Routes\n  \n  // GET /api/sites - list all sites\n  app.get(\"/api/sites\", isAuthenticated, async (req, res) => {\n    try {\n      const sites = await storage.getAllSites();\n      res.json(sites);\n    } catch (error) {\n      console.error(\"Error fetching sites:\", error);\n      res.status(500).json({ message: \"Failed to fetch sites\" });\n    }\n  });\n\n  // POST /api/sites - create site (admin only)\n  app.post(\"/api/sites\", isAuthenticated, hasRole([\"admin\"]), async (req, res) => {\n    try {\n      const siteData = insertSiteSchema.parse(req.body);\n      const site = await storage.createSite(siteData);\n      res.status(201).json(site);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid site data\", errors: error.errors });\n      }\n      console.error(\"Error creating site:\", error);\n      res.status(500).json({ message: \"Failed to create site\" });\n    }\n  });\n\n  // PATCH /api/sites/:id - update site (admin only)\n  app.patch(\"/api/sites/:id\", isAuthenticated, hasRole([\"admin\"]), async (req, res) => {\n    try {\n      const siteId = parseInt(req.params.id);\n      const siteData = insertSiteSchema.partial().parse(req.body);\n      const site = await storage.updateSite(siteId, siteData);\n      \n      if (!site) {\n        return res.status(404).json({ message: \"Site not found\" });\n      }\n      \n      res.json(site);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid site data\", errors: error.errors });\n      }\n      console.error(\"Error updating site:\", error);\n      res.status(500).json({ message: \"Failed to update site\" });\n    }\n  });\n\n  // POST /api/sites/:id/refresh-clock-qr - refresh site clock-in QR code (admin, site_manager)\n  app.post(\"/api/sites/:id/refresh-clock-qr\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const siteId = parseInt(req.params.id);\n      const site = await storage.refreshSiteClockQR(siteId);\n      \n      if (!site) {\n        return res.status(404).json({ message: \"Site not found\" });\n      }\n      \n      res.json(site);\n    } catch (error) {\n      console.error(\"Error refreshing site clock-in QR:\", error);\n      res.status(500).json({ message: \"Failed to refresh clock-in QR code\" });\n    }\n  });\n\n  // User Management Routes\n\n  // GET /api/users - list all users with their site/role info\n  app.get(\"/api/users\", isAuthenticated, async (req, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  // POST /api/users - create/invite user (admin/site_manager only)\n  app.post(\"/api/users\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const userData = insertUserSchema.parse(req.body);\n      const user = await storage.createUser(userData);\n      res.status(201).json(user);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid user data\", errors: error.errors });\n      }\n      console.error(\"Error creating user:\", error);\n      res.status(500).json({ message: \"Failed to create user\" });\n    }\n  });\n\n  // PATCH /api/users/:id - update user role/site/rate (admin/site_manager only)\n  app.patch(\"/api/users/:id\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const userId = req.params.id;\n      const userData = insertUserSchema.partial().parse(req.body);\n      const user = await storage.updateUser(userId, userData);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      res.json(user);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid user data\", errors: error.errors });\n      }\n      console.error(\"Error updating user:\", error);\n      res.status(500).json({ message: \"Failed to update user\" });\n    }\n  });\n\n  // DELETE /api/users/:id - deactivate user (admin only)\n  app.delete(\"/api/users/:id\", isAuthenticated, hasRole([\"admin\"]), async (req, res) => {\n    try {\n      const userId = req.params.id;\n      const success = await storage.deleteUser(userId);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      res.status(500).json({ message: \"Failed to delete user\" });\n    }\n  });\n\n  // Shift Management Routes\n\n  // GET /api/shifts - list shifts with optional filters\n  app.get(\"/api/shifts\", isAuthenticated, async (req, res) => {\n    try {\n      const filters: any = {};\n      \n      if (req.query.date) {\n        filters.date = req.query.date as string;\n      }\n      if (req.query.siteId) {\n        filters.siteId = parseInt(req.query.siteId as string);\n      }\n      if (req.query.userId) {\n        filters.userId = req.query.userId as string;\n      }\n      if (req.query.status) {\n        filters.status = req.query.status as string;\n      }\n\n      const shifts = await storage.getAllShifts(filters);\n      res.json(shifts);\n    } catch (error) {\n      console.error(\"Error fetching shifts:\", error);\n      res.status(500).json({ message: \"Failed to fetch shifts\" });\n    }\n  });\n\n  // GET /api/shifts/:id - get single shift with user/site details\n  app.get(\"/api/shifts/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const shiftId = parseInt(req.params.id);\n      const shift = await storage.getShift(shiftId);\n      \n      if (!shift) {\n        return res.status(404).json({ message: \"Shift not found\" });\n      }\n      \n      res.json(shift);\n    } catch (error) {\n      console.error(\"Error fetching shift:\", error);\n      res.status(500).json({ message: \"Failed to fetch shift\" });\n    }\n  });\n\n  // POST /api/shifts - create shift (admin/site_manager only) with conflict detection\n  app.post(\"/api/shifts\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const shiftData = insertShiftSchema.parse(req.body) as any;\n      \n      // Check for conflicts\n      const hasConflict = await storage.checkShiftConflict(\n        shiftData.userId,\n        shiftData.date,\n        shiftData.startTime,\n        shiftData.endTime\n      );\n\n      const shift = await storage.createShift(shiftData);\n      \n      // Return shift with conflict indicator\n      res.status(201).json({\n        ...shift,\n        hasConflict,\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid shift data\", errors: error.errors });\n      }\n      console.error(\"Error creating shift:\", error);\n      res.status(500).json({ message: \"Failed to create shift\" });\n    }\n  });\n\n  // PATCH /api/shifts/:id - update shift (admin/site_manager only) with conflict recheck\n  app.patch(\"/api/shifts/:id\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const shiftId = parseInt(req.params.id);\n      const shiftData = insertShiftSchema.partial().parse(req.body);\n      \n      const shift = await storage.updateShift(shiftId, shiftData);\n      \n      if (!shift) {\n        return res.status(404).json({ message: \"Shift not found\" });\n      }\n      \n      res.json(shift);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid shift data\", errors: error.errors });\n      }\n      console.error(\"Error updating shift:\", error);\n      res.status(500).json({ message: \"Failed to update shift\" });\n    }\n  });\n\n  // DELETE /api/shifts/:id - delete shift (admin only)\n  app.delete(\"/api/shifts/:id\", isAuthenticated, hasRole([\"admin\"]), async (req, res) => {\n    try {\n      const shiftId = parseInt(req.params.id);\n      const success = await storage.deleteShift(shiftId);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"Shift not found\" });\n      }\n      \n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting shift:\", error);\n      res.status(500).json({ message: \"Failed to delete shift\" });\n    }\n  });\n\n  // Attendance Management Routes\n\n  // GET /api/attendance - list attendance records with filters\n  app.get(\"/api/attendance\", isAuthenticated, async (req, res) => {\n    try {\n      const filters: any = {};\n      \n      if (req.query.date) {\n        filters.date = req.query.date as string;\n      }\n      if (req.query.siteId) {\n        filters.siteId = parseInt(req.query.siteId as string);\n      }\n      if (req.query.userId) {\n        filters.userId = req.query.userId as string;\n      }\n      if (req.query.approvalStatus) {\n        filters.approvalStatus = req.query.approvalStatus as string;\n      }\n\n      const attendanceRecords = await storage.getAllAttendance(filters);\n      \n      // Add duration for completed records\n      const recordsWithDuration = attendanceRecords.map(record => ({\n        ...record,\n        duration: record.clockOut ? storage.calculateDuration(record.clockIn, record.clockOut) : null,\n      }));\n      \n      res.json(recordsWithDuration);\n    } catch (error) {\n      console.error(\"Error fetching attendance:\", error);\n      res.status(500).json({ message: \"Failed to fetch attendance\" });\n    }\n  });\n\n  // GET /api/attendance/:id - get single record\n  app.get(\"/api/attendance/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const attendanceId = parseInt(req.params.id);\n      const record = await storage.getAttendance(attendanceId);\n      \n      if (!record) {\n        return res.status(404).json({ message: \"Attendance record not found\" });\n      }\n      \n      // Add duration if completed\n      const recordWithDuration = {\n        ...record,\n        duration: record.clockOut ? storage.calculateDuration(record.clockIn, record.clockOut) : null,\n      };\n      \n      res.json(recordWithDuration);\n    } catch (error) {\n      console.error(\"Error fetching attendance record:\", error);\n      res.status(500).json({ message: \"Failed to fetch attendance record\" });\n    }\n  });\n\n  // POST /api/attendance/clock-in - clock in (worker, site_manager, admin)\n  app.post(\"/api/attendance/clock-in\", isAuthenticated, hasRole([\"worker\", \"site_manager\", \"admin\"]), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      const clockInSchema = z.object({\n        siteId: z.number(),\n        shiftId: z.number().optional(),\n        notes: z.string().optional(),\n      });\n      \n      const { siteId, shiftId, notes } = clockInSchema.parse(req.body);\n      \n      const record = await storage.clockIn(userId, siteId, shiftId, notes);\n      res.status(201).json(record);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid clock-in data\", errors: error.errors });\n      }\n      console.error(\"Error clocking in:\", error);\n      res.status(500).json({ message: \"Failed to clock in\" });\n    }\n  });\n\n  // PATCH /api/attendance/:id/clock-out - clock out (worker, site_manager, admin)\n  app.patch(\"/api/attendance/:id/clock-out\", isAuthenticated, hasRole([\"worker\", \"site_manager\", \"admin\"]), async (req, res) => {\n    try {\n      const attendanceId = parseInt(req.params.id);\n      \n      const clockOutSchema = z.object({\n        notes: z.string().optional(),\n      });\n      \n      const { notes } = clockOutSchema.parse(req.body);\n      \n      const record = await storage.clockOut(attendanceId, notes);\n      \n      if (!record) {\n        return res.status(404).json({ message: \"Attendance record not found\" });\n      }\n      \n      res.json(record);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid clock-out data\", errors: error.errors });\n      }\n      console.error(\"Error clocking out:\", error);\n      res.status(500).json({ message: \"Failed to clock out\" });\n    }\n  });\n\n  // PATCH /api/attendance/:id/approve - approve (admin, site_manager)\n  app.patch(\"/api/attendance/:id/approve\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req: any, res) => {\n    try {\n      const attendanceId = parseInt(req.params.id);\n      const approverId = req.user.claims.sub;\n      \n      const record = await storage.approveAttendance(attendanceId, approverId);\n      \n      if (!record) {\n        return res.status(404).json({ message: \"Attendance record not found\" });\n      }\n      \n      res.json(record);\n    } catch (error) {\n      console.error(\"Error approving attendance:\", error);\n      res.status(500).json({ message: \"Failed to approve attendance\" });\n    }\n  });\n\n  // PATCH /api/attendance/:id/reject - reject (admin, site_manager)\n  app.patch(\"/api/attendance/:id/reject\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req: any, res) => {\n    try {\n      const attendanceId = parseInt(req.params.id);\n      const approverId = req.user.claims.sub;\n      \n      const record = await storage.rejectAttendance(attendanceId, approverId);\n      \n      if (!record) {\n        return res.status(404).json({ message: \"Attendance record not found\" });\n      }\n      \n      res.json(record);\n    } catch (error) {\n      console.error(\"Error rejecting attendance:\", error);\n      res.status(500).json({ message: \"Failed to reject attendance\" });\n    }\n  });\n\n  // Room Management Routes\n\n  // GET /api/rooms - list rooms with site info\n  app.get(\"/api/rooms\", isAuthenticated, async (req, res) => {\n    try {\n      const filters: any = {};\n      \n      if (req.query.siteId) {\n        filters.siteId = parseInt(req.query.siteId as string);\n      }\n      if (req.query.isActive !== undefined) {\n        filters.isActive = req.query.isActive === 'true';\n      }\n\n      const rooms = await storage.getAllRooms(filters);\n      res.json(rooms);\n    } catch (error) {\n      console.error(\"Error fetching rooms:\", error);\n      res.status(500).json({ message: \"Failed to fetch rooms\" });\n    }\n  });\n\n  // POST /api/rooms - create room (admin only)\n  app.post(\"/api/rooms\", isAuthenticated, hasRole([\"admin\"]), async (req, res) => {\n    try {\n      const roomData = insertRoomSchema.parse(req.body);\n      const room = await storage.createRoom(roomData);\n      res.status(201).json(room);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid room data\", errors: error.errors });\n      }\n      console.error(\"Error creating room:\", error);\n      res.status(500).json({ message: \"Failed to create room\" });\n    }\n  });\n\n  // PATCH /api/rooms/:id - update room (admin only)\n  app.patch(\"/api/rooms/:id\", isAuthenticated, hasRole([\"admin\"]), async (req, res) => {\n    try {\n      const roomId = parseInt(req.params.id);\n      const roomData = insertRoomSchema.partial().parse(req.body);\n      const room = await storage.updateRoom(roomId, roomData);\n      \n      if (!room) {\n        return res.status(404).json({ message: \"Room not found\" });\n      }\n      \n      res.json(room);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid room data\", errors: error.errors });\n      }\n      console.error(\"Error updating room:\", error);\n      res.status(500).json({ message: \"Failed to update room\" });\n    }\n  });\n\n  // POST /api/rooms/:id/refresh-qr - refresh QR code (admin, site_manager)\n  app.post(\"/api/rooms/:id/refresh-qr\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const roomId = parseInt(req.params.id);\n      const room = await storage.refreshRoomQR(roomId);\n      \n      if (!room) {\n        return res.status(404).json({ message: \"Room not found\" });\n      }\n      \n      res.json(room);\n    } catch (error) {\n      console.error(\"Error refreshing QR code:\", error);\n      res.status(500).json({ message: \"Failed to refresh QR code\" });\n    }\n  });\n\n  // DELETE /api/rooms/:id - delete room (admin only)\n  app.delete(\"/api/rooms/:id\", isAuthenticated, hasRole([\"admin\"]), async (req, res) => {\n    try {\n      const roomId = parseInt(req.params.id);\n      const success = await storage.deleteRoom(roomId);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"Room not found\" });\n      }\n      \n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting room:\", error);\n      res.status(500).json({ message: \"Failed to delete room\" });\n    }\n  });\n\n  // Room Scan Routes\n\n  // POST /api/room-scans - log scan (worker, site_manager, admin)\n  app.post(\"/api/room-scans\", isAuthenticated, hasRole([\"worker\", \"site_manager\", \"admin\"]), async (req, res) => {\n    try {\n      const scanData = insertRoomScanSchema.parse(req.body);\n      const scan = await storage.logRoomScan(scanData);\n      res.status(201).json(scan);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid scan data\", errors: error.errors });\n      }\n      console.error(\"Error logging room scan:\", error);\n      res.status(500).json({ message: \"Failed to log room scan\" });\n    }\n  });\n\n  // GET /api/room-scans - list scans with filters\n  app.get(\"/api/room-scans\", isAuthenticated, async (req, res) => {\n    try {\n      const filters: any = {};\n      \n      if (req.query.roomId) {\n        filters.roomId = parseInt(req.query.roomId as string);\n      }\n      if (req.query.userId) {\n        filters.userId = req.query.userId as string;\n      }\n      if (req.query.status) {\n        filters.status = req.query.status as string;\n      }\n      if (req.query.date) {\n        filters.date = req.query.date as string;\n      }\n\n      const scans = await storage.getAllRoomScans(filters);\n      res.json(scans);\n    } catch (error) {\n      console.error(\"Error fetching room scans:\", error);\n      res.status(500).json({ message: \"Failed to fetch room scans\" });\n    }\n  });\n\n  // Payroll Routes\n\n  // GET /api/payroll-runs - list payroll runs (admin, site_manager)\n  app.get(\"/api/payroll-runs\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const filters: any = {};\n      \n      if (req.query.status) {\n        filters.status = req.query.status as string;\n      }\n\n      const runs = await storage.getPayrollRuns(filters);\n      res.json(runs);\n    } catch (error) {\n      console.error(\"Error fetching payroll runs:\", error);\n      res.status(500).json({ message: \"Failed to fetch payroll runs\" });\n    }\n  });\n\n  // POST /api/payroll-runs - create payroll run (admin only)\n  app.post(\"/api/payroll-runs\", isAuthenticated, hasRole([\"admin\"]), async (req: any, res) => {\n    try {\n      const { startDate, endDate } = req.body;\n      \n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"Start date and end date are required\" });\n      }\n\n      const userId = req.user.claims.sub;\n      const run = await storage.createPayrollRun(startDate, endDate, userId);\n      res.status(201).json(run);\n    } catch (error) {\n      console.error(\"Error creating payroll run:\", error);\n      res.status(500).json({ message: \"Failed to create payroll run\" });\n    }\n  });\n\n  // GET /api/payroll-runs/:id - get single payroll run with payslips\n  app.get(\"/api/payroll-runs/:id\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const runId = parseInt(req.params.id);\n      const run = await storage.getPayrollRun(runId);\n      \n      if (!run) {\n        return res.status(404).json({ message: \"Payroll run not found\" });\n      }\n      \n      res.json(run);\n    } catch (error) {\n      console.error(\"Error fetching payroll run:\", error);\n      res.status(500).json({ message: \"Failed to fetch payroll run\" });\n    }\n  });\n\n  // POST /api/payroll-runs/:id/process - process run to generate payslips (admin only)\n  app.post(\"/api/payroll-runs/:id/process\", isAuthenticated, hasRole([\"admin\"]), async (req, res) => {\n    try {\n      const runId = parseInt(req.params.id);\n      \n      await storage.processPayrollRun(runId);\n      \n      const updatedRun = await storage.getPayrollRun(runId);\n      res.json(updatedRun);\n    } catch (error: any) {\n      console.error(\"Error processing payroll run:\", error);\n      res.status(500).json({ message: error.message || \"Failed to process payroll run\" });\n    }\n  });\n\n  // POST /api/payroll-runs/:id/finalize - finalize run (admin only)\n  app.post(\"/api/payroll-runs/:id/finalize\", isAuthenticated, hasRole([\"admin\"]), async (req: any, res) => {\n    try {\n      const runId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      \n      const run = await storage.finalizePayrollRun(runId, userId);\n      \n      if (!run) {\n        return res.status(404).json({ message: \"Payroll run not found\" });\n      }\n      \n      res.json(run);\n    } catch (error) {\n      console.error(\"Error finalizing payroll run:\", error);\n      res.status(500).json({ message: \"Failed to finalize payroll run\" });\n    }\n  });\n\n  // GET /api/payslips - list payslips (admin sees all, workers see their own)\n  app.get(\"/api/payslips\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const filters: any = {};\n      \n      if (req.query.payrollRunId) {\n        filters.payrollRunId = parseInt(req.query.payrollRunId as string);\n      }\n      \n      // Workers can only see their own payslips\n      if (user.role === 'worker') {\n        filters.userId = userId;\n      } else if (req.query.userId) {\n        filters.userId = req.query.userId as string;\n      }\n\n      const payslips = await storage.getPayslips(filters);\n      res.json(payslips);\n    } catch (error) {\n      console.error(\"Error fetching payslips:\", error);\n      res.status(500).json({ message: \"Failed to fetch payslips\" });\n    }\n  });\n\n  // GET /api/payslips/:id - get single payslip with breakdown\n  app.get(\"/api/payslips/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const payslipId = parseInt(req.params.id);\n      const payslip = await storage.getPayslip(payslipId);\n      \n      if (!payslip) {\n        return res.status(404).json({ message: \"Payslip not found\" });\n      }\n\n      // Check authorization - workers can only see their own payslips\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (user?.role === 'worker' && payslip.userId !== userId) {\n        return res.status(403).json({ message: \"Not authorized to view this payslip\" });\n      }\n      \n      res.json(payslip);\n    } catch (error) {\n      console.error(\"Error fetching payslip:\", error);\n      res.status(500).json({ message: \"Failed to fetch payslip\" });\n    }\n  });\n\n  // POST /api/payslips/:id/deductions - add deduction to payslip (admin only)\n  app.post(\"/api/payslips/:id/deductions\", isAuthenticated, hasRole([\"admin\"]), async (req, res) => {\n    try {\n      const payslipId = parseInt(req.params.id);\n      const { amount, reason, type } = req.body;\n      \n      if (!amount || !reason || !type) {\n        return res.status(400).json({ message: \"Amount, reason, and type are required\" });\n      }\n\n      const payslip = await storage.addDeduction(payslipId, {\n        amount: parseFloat(amount),\n        reason,\n        type,\n      });\n      \n      if (!payslip) {\n        return res.status(404).json({ message: \"Payslip not found\" });\n      }\n      \n      res.json(payslip);\n    } catch (error) {\n      console.error(\"Error adding deduction:\", error);\n      res.status(500).json({ message: \"Failed to add deduction\" });\n    }\n  });\n\n  // Query/Ticket Routes\n\n  // GET /api/queries - list queries (workers see their own, admin/site_manager see all)\n  app.get(\"/api/queries\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const filters: any = {};\n      \n      if (req.query.category) {\n        filters.category = req.query.category as string;\n      }\n      if (req.query.status) {\n        filters.status = req.query.status as string;\n      }\n      if (req.query.priority) {\n        filters.priority = req.query.priority as string;\n      }\n      \n      // Workers can only see their own queries\n      if (user.role === 'worker') {\n        filters.userId = userId;\n      } else if (req.query.userId) {\n        filters.userId = req.query.userId as string;\n      }\n\n      const queries = await storage.getAllQueries(filters);\n      res.json(queries);\n    } catch (error) {\n      console.error(\"Error fetching queries:\", error);\n      res.status(500).json({ message: \"Failed to fetch queries\" });\n    }\n  });\n\n  // GET /api/queries/:id - get query with messages\n  app.get(\"/api/queries/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const queryId = parseInt(req.params.id);\n      const query = await storage.getQuery(queryId);\n      \n      if (!query) {\n        return res.status(404).json({ message: \"Query not found\" });\n      }\n\n      // Check authorization - workers can only see their own queries\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (user?.role === 'worker' && query.userId !== userId) {\n        return res.status(403).json({ message: \"Not authorized to view this query\" });\n      }\n      \n      res.json(query);\n    } catch (error) {\n      console.error(\"Error fetching query:\", error);\n      res.status(500).json({ message: \"Failed to fetch query\" });\n    }\n  });\n\n  // POST /api/queries - create query (all authenticated users)\n  app.post(\"/api/queries\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const queryData = insertQuerySchema.parse({\n        ...req.body,\n        userId,\n      });\n      \n      const query = await storage.createQuery(queryData);\n      res.status(201).json(query);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid query data\", errors: error.errors });\n      }\n      console.error(\"Error creating query:\", error);\n      res.status(500).json({ message: \"Failed to create query\" });\n    }\n  });\n\n  // PATCH /api/queries/:id/status - update status (admin, site_manager)\n  app.patch(\"/api/queries/:id/status\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req: any, res) => {\n    try {\n      const queryId = parseInt(req.params.id);\n      const { status } = req.body;\n      const userId = req.user.claims.sub;\n      \n      if (!status) {\n        return res.status(400).json({ message: \"Status is required\" });\n      }\n\n      const query = await storage.updateQueryStatus(queryId, status, userId);\n      \n      if (!query) {\n        return res.status(404).json({ message: \"Query not found\" });\n      }\n      \n      res.json(query);\n    } catch (error) {\n      console.error(\"Error updating query status:\", error);\n      res.status(500).json({ message: \"Failed to update query status\" });\n    }\n  });\n\n  // PATCH /api/queries/:id/priority - update priority (admin, site_manager)\n  app.patch(\"/api/queries/:id/priority\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req: any, res) => {\n    try {\n      const queryId = parseInt(req.params.id);\n      const { priority } = req.body;\n      \n      if (!priority) {\n        return res.status(400).json({ message: \"Priority is required\" });\n      }\n\n      const query = await storage.updateQueryPriority(queryId, priority);\n      \n      if (!query) {\n        return res.status(404).json({ message: \"Query not found\" });\n      }\n      \n      res.json(query);\n    } catch (error) {\n      console.error(\"Error updating query priority:\", error);\n      res.status(500).json({ message: \"Failed to update query priority\" });\n    }\n  });\n\n  // POST /api/queries/:id/messages - add message to query (all authenticated users)\n  app.post(\"/api/queries/:id/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const queryId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      \n      // Verify query exists and user has access\n      const query = await storage.getQuery(queryId);\n      if (!query) {\n        return res.status(404).json({ message: \"Query not found\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (user?.role === 'worker' && query.userId !== userId) {\n        return res.status(403).json({ message: \"Not authorized to add messages to this query\" });\n      }\n\n      const messageData = insertQueryMessageSchema.parse({\n        queryId,\n        userId,\n        message: req.body.message,\n      });\n      \n      const message = await storage.addMessage(queryId, messageData);\n      \n      // Return message with user info\n      const userInfo = await storage.getUser(userId);\n      res.status(201).json({ ...message, user: userInfo });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid message data\", errors: error.errors });\n      }\n      console.error(\"Error adding message:\", error);\n      res.status(500).json({ message: \"Failed to add message\" });\n    }\n  });\n\n  // GET /api/queries/:id/messages - get all messages for query\n  app.get(\"/api/queries/:id/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const queryId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      \n      // Verify query exists and user has access\n      const query = await storage.getQuery(queryId);\n      if (!query) {\n        return res.status(404).json({ message: \"Query not found\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (user?.role === 'worker' && query.userId !== userId) {\n        return res.status(403).json({ message: \"Not authorized to view messages for this query\" });\n      }\n\n      const messages = await storage.getQueryMessages(queryId);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  // Analytics Routes\n\n  // GET /api/analytics/hours - get hours summary (admin, site_manager)\n  app.get(\"/api/analytics/hours\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const { startDate, endDate, siteId, userId } = req.query;\n      \n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"Start date and end date are required\" });\n      }\n\n      const filters: any = {\n        startDate: startDate as string,\n        endDate: endDate as string,\n      };\n\n      if (siteId) {\n        filters.siteId = parseInt(siteId as string);\n      }\n      if (userId) {\n        filters.userId = userId as string;\n      }\n\n      const summary = await storage.getHoursSummary(filters);\n      res.json(summary);\n    } catch (error) {\n      console.error(\"Error fetching hours summary:\", error);\n      res.status(500).json({ message: \"Failed to fetch hours summary\" });\n    }\n  });\n\n  // GET /api/analytics/costs - get cost summary (admin only)\n  app.get(\"/api/analytics/costs\", isAuthenticated, hasRole([\"admin\"]), async (req, res) => {\n    try {\n      const { startDate, endDate, siteId } = req.query;\n      \n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"Start date and end date are required\" });\n      }\n\n      const filters: any = {\n        startDate: startDate as string,\n        endDate: endDate as string,\n      };\n\n      if (siteId) {\n        filters.siteId = parseInt(siteId as string);\n      }\n\n      const summary = await storage.getCostSummary(filters);\n      res.json(summary);\n    } catch (error) {\n      console.error(\"Error fetching cost summary:\", error);\n      res.status(500).json({ message: \"Failed to fetch cost summary\" });\n    }\n  });\n\n  // GET /api/analytics/attendance - get attendance summary (admin, site_manager)\n  app.get(\"/api/analytics/attendance\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const { startDate, endDate, siteId } = req.query;\n      \n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"Start date and end date are required\" });\n      }\n\n      const filters: any = {\n        startDate: startDate as string,\n        endDate: endDate as string,\n      };\n\n      if (siteId) {\n        filters.siteId = parseInt(siteId as string);\n      }\n\n      const summary = await storage.getAttendanceSummary(filters);\n      res.json(summary);\n    } catch (error) {\n      console.error(\"Error fetching attendance summary:\", error);\n      res.status(500).json({ message: \"Failed to fetch attendance summary\" });\n    }\n  });\n\n  // GET /api/analytics/sites - get per-site summary (admin, site_manager)\n  app.get(\"/api/analytics/sites\", isAuthenticated, hasRole([\"admin\", \"site_manager\"]), async (req, res) => {\n    try {\n      const summary = await storage.getSiteSummary();\n      res.json(summary);\n    } catch (error) {\n      console.error(\"Error fetching site summary:\", error);\n      res.status(500).json({ message: \"Failed to fetch site summary\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","size_bytes":35361},"client/src/pages/sites.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertSiteSchema, type InsertSite, type Site } from \"@shared/schema\";\nimport { Building2, MapPin, Plus, Edit2, CheckCircle2, XCircle } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nconst siteColors = [\n  { value: \"purple\", label: \"Purple\", bg: \"bg-purple-500\", text: \"text-purple-500\" },\n  { value: \"teal\", label: \"Teal\", bg: \"bg-teal-500\", text: \"text-teal-500\" },\n  { value: \"orange\", label: \"Orange\", bg: \"bg-orange-500\", text: \"text-orange-500\" },\n];\n\nexport default function Sites() {\n  const { toast } = useToast();\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [editingSite, setEditingSite] = useState<Site | null>(null);\n\n  const { data: sites, isLoading } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertSite) => {\n      return await apiRequest(\"POST\", \"/api/sites\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sites\"] });\n      setIsCreateOpen(false);\n      toast({\n        title: \"Success\",\n        description: \"Site created successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create site\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<InsertSite> }) => {\n      return await apiRequest(\"PATCH\", `/api/sites/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sites\"] });\n      setEditingSite(null);\n      toast({\n        title: \"Success\",\n        description: \"Site updated successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update site\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const form = useForm<InsertSite>({\n    resolver: zodResolver(insertSiteSchema),\n    defaultValues: {\n      name: \"\",\n      color: \"purple\",\n      location: \"\",\n      isActive: true,\n    },\n  });\n\n  const onSubmit = (data: InsertSite) => {\n    if (editingSite) {\n      updateMutation.mutate({ id: editingSite.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const handleEdit = (site: Site) => {\n    setEditingSite(site);\n    form.reset({\n      name: site.name,\n      color: site.color,\n      location: site.location,\n      isActive: site.isActive,\n    });\n  };\n\n  const handleCloseDialog = () => {\n    if (editingSite) {\n      setEditingSite(null);\n    } else {\n      setIsCreateOpen(false);\n    }\n    form.reset({\n      name: \"\",\n      color: \"purple\",\n      location: \"\",\n      isActive: true,\n    });\n  };\n\n  const getColorClasses = (color: string) => {\n    const colorConfig = siteColors.find((c) => c.value === color);\n    return colorConfig || siteColors[0];\n  };\n\n  return (\n    <div className=\"max-w-7xl mx-auto space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\" data-testid=\"text-page-title\">\n            Site Management\n          </h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Manage your organization's locations and facilities\n          </p>\n        </div>\n        <Button\n          onClick={() => setIsCreateOpen(true)}\n          data-testid=\"button-create-site\"\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Site\n        </Button>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {[1, 2, 3].map((i) => (\n            <Card key={i}>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-1 space-y-0 pb-2\">\n                <Skeleton className=\"h-6 w-32\" />\n                <Skeleton className=\"h-8 w-8\" />\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <Skeleton className=\"h-4 w-full\" />\n                <Skeleton className=\"h-4 w-24\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : sites && sites.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {sites.map((site) => {\n            const colorClasses = getColorClasses(site.color);\n            return (\n              <Card\n                key={site.id}\n                className=\"hover-elevate\"\n                data-testid={`card-site-${site.id}`}\n              >\n                <CardHeader className=\"flex flex-row items-center justify-between gap-1 space-y-0 pb-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <div className={`h-8 w-8 rounded-md ${colorClasses.bg} flex items-center justify-center`}>\n                      <Building2 className=\"h-5 w-5 text-white\" />\n                    </div>\n                    <CardTitle className=\"text-base font-medium\">\n                      {site.name}\n                    </CardTitle>\n                  </div>\n                  <Button\n                    size=\"icon\"\n                    variant=\"ghost\"\n                    onClick={() => handleEdit(site)}\n                    data-testid={`button-edit-site-${site.id}`}\n                  >\n                    <Edit2 className=\"h-4 w-4\" />\n                  </Button>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <MapPin className=\"h-4 w-4\" />\n                    <span data-testid={`text-location-${site.id}`}>{site.location}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {site.isActive ? (\n                      <>\n                        <CheckCircle2 className=\"h-4 w-4 text-success\" />\n                        <span className=\"text-xs text-success\" data-testid={`text-status-${site.id}`}>Active</span>\n                      </>\n                    ) : (\n                      <>\n                        <XCircle className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"text-xs text-muted-foreground\" data-testid={`text-status-${site.id}`}>\n                          Inactive\n                        </span>\n                      </>\n                    )}\n                    <div className={`ml-auto h-3 w-3 rounded-full ${colorClasses.bg}`} />\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      ) : (\n        <Card className=\"p-12\">\n          <div className=\"text-center space-y-4\">\n            <div className=\"mx-auto h-12 w-12 rounded-full bg-muted flex items-center justify-center\">\n              <Building2 className=\"h-6 w-6 text-muted-foreground\" />\n            </div>\n            <div>\n              <h3 className=\"font-medium\">No sites yet</h3>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Get started by creating your first site\n              </p>\n            </div>\n            <Button onClick={() => setIsCreateOpen(true)} data-testid=\"button-create-first-site\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Create Site\n            </Button>\n          </div>\n        </Card>\n      )}\n\n      <Dialog open={isCreateOpen || !!editingSite} onOpenChange={handleCloseDialog}>\n        <DialogContent data-testid=\"dialog-site-form\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingSite ? \"Edit Site\" : \"Create New Site\"}\n            </DialogTitle>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Site Name</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Downtown Office\"\n                        {...field}\n                        data-testid=\"input-site-name\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"location\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Location</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"123 Main St, City\"\n                        {...field}\n                        data-testid=\"input-site-location\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"color\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Color Identifier</FormLabel>\n                    <Select\n                      onValueChange={field.onChange}\n                      defaultValue={field.value}\n                    >\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-site-color\">\n                          <SelectValue placeholder=\"Select a color\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {siteColors.map((color) => (\n                          <SelectItem key={color.value} value={color.value}>\n                            <div className=\"flex items-center gap-2\">\n                              <div className={`h-3 w-3 rounded-full ${color.bg}`} />\n                              <span>{color.label}</span>\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={handleCloseDialog}\n                  data-testid=\"button-cancel\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending || updateMutation.isPending}\n                  data-testid=\"button-submit-site\"\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? \"Saving...\"\n                    : editingSite\n                    ? \"Update Site\"\n                    : \"Create Site\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":11964},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/pages/worker-pay.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { WorkerBottomNav } from \"@/components/worker-bottom-nav\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Download, ChevronRight, DollarSign, TrendingUp, Clock } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useState } from \"react\";\nimport type { User, Payslip, PayrollRun } from \"@shared/schema\";\n\ninterface PayslipLineItem {\n  id: string;\n  description: string;\n  type: \"earning\" | \"deduction\";\n  hours?: number;\n  rate?: number;\n  amount: number;\n  reason?: string;\n}\n\nexport default function WorkerPay() {\n  const [selectedPayslip, setSelectedPayslip] = useState<Payslip | null>(null);\n\n  const { data: user, isLoading: userLoading } = useQuery<User>({\n    queryKey: ['/api/auth/user'],\n  });\n\n  const { data: payslips = [], isLoading: payslipsLoading } = useQuery<Payslip[]>({\n    queryKey: ['/api/payslips', { userId: user?.id }],\n    enabled: !!user,\n  });\n\n  const { data: payrollRuns = [], isLoading: runsLoading } = useQuery<PayrollRun[]>({\n    queryKey: ['/api/payroll-runs'],\n  });\n\n  const latestPayslip = payslips.sort((a, b) => \n    new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n  )[0];\n\n  const getPayrollRunPeriod = (payslipRunId: number) => {\n    const run = payrollRuns.find(r => r.id === payslipRunId);\n    return run?.period || \"Unknown Period\";\n  };\n\n  const calculateTotalHours = (lineItems: PayslipLineItem[]) => {\n    const regularHours = lineItems\n      .filter(item => item.type === 'earning' && item.description.toLowerCase().includes('base'))\n      .reduce((sum, item) => sum + (item.hours || 0), 0);\n    \n    const overtimeHours = lineItems\n      .filter(item => item.type === 'earning' && item.description.toLowerCase().includes('overtime'))\n      .reduce((sum, item) => sum + (item.hours || 0), 0);\n\n    return { regularHours, overtimeHours };\n  };\n\n  if (userLoading || payslipsLoading) {\n    return (\n      <div className=\"min-h-screen pb-20 md:pb-0\">\n        <div className=\"max-w-2xl mx-auto p-4 space-y-6\">\n          <Skeleton className=\"h-16 w-full\" />\n          <Skeleton className=\"h-48 w-full\" />\n          <Skeleton className=\"h-32 w-full\" />\n        </div>\n        <WorkerBottomNav />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen pb-20 md:pb-0 bg-background\">\n      <div className=\"max-w-2xl mx-auto p-4 space-y-6\">\n        {/* Header */}\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-pay-title\">My Pay</h1>\n          <p className=\"text-muted-foreground mt-1\">View your payslips and earnings</p>\n        </div>\n\n        {/* Current Period Summary */}\n        {latestPayslip && (\n          <Card className=\"border-2\" data-testid=\"card-current-period\">\n            <CardHeader>\n              <div className=\"flex items-start justify-between\">\n                <div>\n                  <CardTitle className=\"text-lg\">Current Pay Period</CardTitle>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    {getPayrollRunPeriod(latestPayslip.payrollRunId)}\n                  </p>\n                </div>\n                <DollarSign className=\"h-6 w-6 text-muted-foreground\" />\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {/* Net Pay - Large Display */}\n              <div className=\"text-center py-4 bg-card rounded-lg border\">\n                <p className=\"text-sm text-muted-foreground mb-2\">Net Pay</p>\n                <p className=\"text-4xl font-bold font-mono text-chart-5\" data-testid=\"text-net-pay\">\n                  £{Number(latestPayslip.netPay).toFixed(2)}\n                </p>\n              </div>\n\n              {/* Gross Pay & Deductions */}\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"p-3 rounded-lg border\">\n                  <p className=\"text-xs text-muted-foreground mb-1\">Gross Pay</p>\n                  <p className=\"text-xl font-mono font-medium\" data-testid=\"text-gross-pay\">\n                    £{Number(latestPayslip.grossPay).toFixed(2)}\n                  </p>\n                </div>\n                <div className=\"p-3 rounded-lg border\">\n                  <p className=\"text-xs text-muted-foreground mb-1\">Deductions</p>\n                  <p className=\"text-xl font-mono font-medium text-destructive\" data-testid=\"text-deductions\">\n                    -£{Number(latestPayslip.deductions).toFixed(2)}\n                  </p>\n                </div>\n              </div>\n\n              {/* Hours Breakdown */}\n              {(() => {\n                const lineItems = latestPayslip.lineItems as unknown as PayslipLineItem[];\n                const { regularHours, overtimeHours } = calculateTotalHours(lineItems);\n                \n                if (regularHours > 0 || overtimeHours > 0) {\n                  return (\n                    <div className=\"space-y-2\">\n                      <Separator />\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <div className=\"flex items-center gap-2\">\n                          <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"text-muted-foreground\">Regular Hours</span>\n                        </div>\n                        <span className=\"font-mono font-medium\">{regularHours}h</span>\n                      </div>\n                      {overtimeHours > 0 && (\n                        <div className=\"flex items-center justify-between text-sm\">\n                          <div className=\"flex items-center gap-2\">\n                            <TrendingUp className=\"h-4 w-4 text-chart-1\" />\n                            <span className=\"text-muted-foreground\">Overtime Hours</span>\n                          </div>\n                          <span className=\"font-mono font-medium text-chart-1\">{overtimeHours}h</span>\n                        </div>\n                      )}\n                    </div>\n                  );\n                }\n                return null;\n              })()}\n\n              {/* View Details Button */}\n              <Dialog>\n                <DialogTrigger asChild>\n                  <Button \n                    variant=\"outline\" \n                    className=\"w-full min-h-12 justify-between\"\n                    onClick={() => setSelectedPayslip(latestPayslip)}\n                    data-testid=\"button-view-breakdown\"\n                  >\n                    View Detailed Breakdown\n                    <ChevronRight className=\"h-4 w-4\" />\n                  </Button>\n                </DialogTrigger>\n                <PayslipDetailDialog payslip={selectedPayslip} payrollRuns={payrollRuns} />\n              </Dialog>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Recent Payslips */}\n        <div className=\"space-y-3\">\n          <h2 className=\"text-lg font-semibold\">Recent Payslips</h2>\n          \n          {payslips.length > 0 ? (\n            <div className=\"space-y-3\">\n              {payslips\n                .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n                .map((payslip) => (\n                  <Dialog key={payslip.id}>\n                    <DialogTrigger asChild>\n                      <Card \n                        className=\"hover-elevate cursor-pointer transition-all\"\n                        onClick={() => setSelectedPayslip(payslip)}\n                        data-testid={`payslip-card-${payslip.id}`}\n                      >\n                        <CardContent className=\"p-4\">\n                          <div className=\"flex items-center justify-between mb-3\">\n                            <div>\n                              <p className=\"font-medium\">\n                                {getPayrollRunPeriod(payslip.payrollRunId)}\n                              </p>\n                              <p className=\"text-xs text-muted-foreground mt-1\">\n                                {format(new Date(payslip.createdAt), 'd MMM yyyy')}\n                              </p>\n                            </div>\n                            <div className=\"text-right\">\n                              <p className=\"text-sm text-muted-foreground\">Net Pay</p>\n                              <p className=\"text-xl font-mono font-bold text-chart-5\">\n                                £{Number(payslip.netPay).toFixed(2)}\n                              </p>\n                            </div>\n                          </div>\n                          <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                            <span>Gross: £{Number(payslip.grossPay).toFixed(2)}</span>\n                            <span>Deductions: -£{Number(payslip.deductions).toFixed(2)}</span>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    </DialogTrigger>\n                    <PayslipDetailDialog payslip={selectedPayslip} payrollRuns={payrollRuns} />\n                  </Dialog>\n                ))}\n            </div>\n          ) : (\n            <Card>\n              <CardContent className=\"p-8 text-center\">\n                <DollarSign className=\"h-12 w-12 mx-auto text-muted-foreground mb-3\" />\n                <p className=\"text-sm text-muted-foreground\">\n                  No payslips available yet\n                </p>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      </div>\n      <WorkerBottomNav />\n    </div>\n  );\n}\n\nfunction PayslipDetailDialog({ \n  payslip, \n  payrollRuns \n}: { \n  payslip: Payslip | null; \n  payrollRuns: PayrollRun[];\n}) {\n  if (!payslip) return null;\n\n  const lineItems = payslip.lineItems as unknown as PayslipLineItem[];\n  const earnings = lineItems.filter(item => item.type === 'earning');\n  const deductions = lineItems.filter(item => item.type === 'deduction');\n  const payrollRun = payrollRuns.find(r => r.id === payslip.payrollRunId);\n\n  return (\n    <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\" data-testid=\"dialog-payslip-detail\">\n      <DialogHeader>\n        <DialogTitle>Payslip Details</DialogTitle>\n        <p className=\"text-sm text-muted-foreground\">\n          {payrollRun?.period || \"Unknown Period\"}\n        </p>\n      </DialogHeader>\n\n      <div className=\"space-y-6\">\n        {/* Summary */}\n        <div className=\"bg-card rounded-lg p-4 border\">\n          <div className=\"flex justify-between items-center mb-3\">\n            <span className=\"text-sm text-muted-foreground\">Gross Pay</span>\n            <span className=\"font-mono font-medium\">£{Number(payslip.grossPay).toFixed(2)}</span>\n          </div>\n          <div className=\"flex justify-between items-center mb-3\">\n            <span className=\"text-sm text-muted-foreground\">Total Deductions</span>\n            <span className=\"font-mono font-medium text-destructive\">\n              -£{Number(payslip.deductions).toFixed(2)}\n            </span>\n          </div>\n          <Separator className=\"my-3\" />\n          <div className=\"flex justify-between items-center\">\n            <span className=\"font-medium\">Net Pay</span>\n            <span className=\"text-2xl font-mono font-bold text-chart-5\">\n              £{Number(payslip.netPay).toFixed(2)}\n            </span>\n          </div>\n        </div>\n\n        {/* Earnings Breakdown */}\n        <div>\n          <h3 className=\"font-medium mb-3\">Earnings</h3>\n          <div className=\"space-y-2\">\n            {earnings.map((item) => (\n              <div \n                key={item.id} \n                className=\"flex justify-between items-start p-3 rounded-lg border\"\n                data-testid={`earning-${item.id}`}\n              >\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium\">{item.description}</p>\n                  {item.hours && item.rate && (\n                    <p className=\"text-xs text-muted-foreground font-mono mt-1\">\n                      {item.hours}h × £{item.rate}/h\n                    </p>\n                  )}\n                </div>\n                <span className=\"font-mono font-medium\">£{item.amount.toFixed(2)}</span>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Deductions Breakdown */}\n        <div>\n          <h3 className=\"font-medium mb-3\">Deductions</h3>\n          <div className=\"space-y-2\">\n            {deductions.map((item) => (\n              <div \n                key={item.id} \n                className=\"flex justify-between items-start p-3 rounded-lg border\"\n                data-testid={`deduction-${item.id}`}\n              >\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium\">{item.description}</p>\n                  {item.reason && (\n                    <p className=\"text-xs text-muted-foreground mt-1\">{item.reason}</p>\n                  )}\n                </div>\n                <span className=\"font-mono font-medium text-destructive\">\n                  -£{item.amount.toFixed(2)}\n                </span>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Download Button */}\n        <Button \n          variant=\"outline\" \n          className=\"w-full min-h-12\" \n          disabled\n          data-testid=\"button-download-payslip\"\n        >\n          <Download className=\"h-4 w-4 mr-2\" />\n          Download Payslip (Coming Soon)\n        </Button>\n      </div>\n    </DialogContent>\n  );\n}\n","size_bytes":13863},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/pages/payroll.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Plus, Play, Lock, Eye } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst createPayrollRunSchema = z.object({\n  startDate: z.string().min(1, \"Start date is required\"),\n  endDate: z.string().min(1, \"End date is required\"),\n});\n\nconst addDeductionSchema = z.object({\n  amount: z.string().min(1, \"Amount is required\"),\n  reason: z.string().min(1, \"Reason is required\"),\n  type: z.string().min(1, \"Type is required\"),\n});\n\ntype PayrollRun = {\n  id: number;\n  period: string;\n  startDate: string;\n  endDate: string;\n  status: string;\n  createdAt: string;\n  finalizedAt: string | null;\n};\n\ntype Payslip = {\n  id: number;\n  payrollRunId: number;\n  userId: string;\n  siteId: number;\n  grossPay: string;\n  deductions: string;\n  netPay: string;\n  lineItems: Array<{\n    id: string;\n    description: string;\n    type: string;\n    hours: string | null;\n    rate: string | null;\n    amount: string;\n    reason: string | null;\n  }>;\n  user: {\n    firstName: string | null;\n    lastName: string | null;\n  };\n  site: {\n    name: string;\n  };\n  payrollRun: {\n    period: string;\n  };\n};\n\nexport default function Payroll() {\n  const { toast } = useToast();\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [detailDialogOpen, setDetailDialogOpen] = useState(false);\n  const [deductionDialogOpen, setDeductionDialogOpen] = useState(false);\n  const [selectedPayslip, setSelectedPayslip] = useState<Payslip | null>(null);\n\n  const { data: payrollRuns, isLoading: runsLoading } = useQuery<PayrollRun[]>({\n    queryKey: [\"/api/payroll-runs\"],\n  });\n\n  const { data: payslips, isLoading: payslipsLoading } = useQuery<Payslip[]>({\n    queryKey: [\"/api/payslips\"],\n  });\n\n  const createForm = useForm<z.infer<typeof createPayrollRunSchema>>({\n    resolver: zodResolver(createPayrollRunSchema),\n    defaultValues: {\n      startDate: \"\",\n      endDate: \"\",\n    },\n  });\n\n  const deductionForm = useForm<z.infer<typeof addDeductionSchema>>({\n    resolver: zodResolver(addDeductionSchema),\n    defaultValues: {\n      amount: \"\",\n      reason: \"\",\n      type: \"tax\",\n    },\n  });\n\n  const createRunMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof createPayrollRunSchema>) => {\n      return await apiRequest(\"POST\", \"/api/payroll-runs\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/payroll-runs\"] });\n      toast({\n        title: \"Payroll run created\",\n        description: \"New payroll run has been created successfully.\",\n      });\n      setCreateDialogOpen(false);\n      createForm.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create payroll run\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const processRunMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return await apiRequest(\"POST\", `/api/payroll-runs/${id}/process`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/payroll-runs\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/payslips\"] });\n      toast({\n        title: \"Payroll processed\",\n        description: \"Payslips have been generated successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to process payroll run\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const finalizeRunMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return await apiRequest(\"POST\", `/api/payroll-runs/${id}/finalize`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/payroll-runs\"] });\n      toast({\n        title: \"Payroll finalized\",\n        description: \"Payroll run has been locked and finalized.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to finalize payroll run\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const addDeductionMutation = useMutation({\n    mutationFn: async ({ payslipId, data }: { payslipId: number; data: z.infer<typeof addDeductionSchema> }) => {\n      return await apiRequest(\"POST\", `/api/payslips/${payslipId}/deductions`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/payslips\"] });\n      toast({\n        title: \"Deduction added\",\n        description: \"Deduction has been added to the payslip.\",\n      });\n      setDeductionDialogOpen(false);\n      deductionForm.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to add deduction\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onCreateSubmit = (data: z.infer<typeof createPayrollRunSchema>) => {\n    createRunMutation.mutate(data);\n  };\n\n  const onDeductionSubmit = (data: z.infer<typeof addDeductionSchema>) => {\n    if (selectedPayslip) {\n      addDeductionMutation.mutate({ payslipId: selectedPayslip.id, data });\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"draft\":\n        return <Badge variant=\"secondary\" data-testid={`badge-status-draft`}>Draft</Badge>;\n      case \"processing\":\n        return <Badge variant=\"default\" data-testid={`badge-status-processing`}>Processing</Badge>;\n      case \"finalized\":\n        return <Badge variant=\"outline\" data-testid={`badge-status-finalized`}>Finalized</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">Payroll Management</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage payroll runs and generate payslips with overtime calculations\n          </p>\n        </div>\n        <Button onClick={() => setCreateDialogOpen(true)} data-testid=\"button-create-payrun\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Create Pay Run\n        </Button>\n      </div>\n\n      <Tabs defaultValue=\"runs\" className=\"w-full\">\n        <TabsList>\n          <TabsTrigger value=\"runs\" data-testid=\"tab-payroll-runs\">\n            Payroll Runs\n          </TabsTrigger>\n          <TabsTrigger value=\"payslips\" data-testid=\"tab-payslips\">\n            Payslips\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"runs\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Payroll Runs</CardTitle>\n              <CardDescription>\n                Create and manage payroll runs for different pay periods\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {runsLoading ? (\n                <div className=\"space-y-2\">\n                  <Skeleton className=\"h-12 w-full\" />\n                  <Skeleton className=\"h-12 w-full\" />\n                  <Skeleton className=\"h-12 w-full\" />\n                </div>\n              ) : payrollRuns && payrollRuns.length > 0 ? (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Period</TableHead>\n                      <TableHead>Date Range</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Created</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {payrollRuns.map((run) => (\n                      <TableRow key={run.id} data-testid={`row-payroll-run-${run.id}`}>\n                        <TableCell className=\"font-medium\" data-testid={`text-period-${run.id}`}>\n                          {run.period}\n                        </TableCell>\n                        <TableCell data-testid={`text-daterange-${run.id}`}>\n                          {run.startDate} to {run.endDate}\n                        </TableCell>\n                        <TableCell>{getStatusBadge(run.status)}</TableCell>\n                        <TableCell data-testid={`text-created-${run.id}`}>\n                          {new Date(run.createdAt).toLocaleDateString()}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex gap-2 justify-end\">\n                            {run.status === \"draft\" && (\n                              <Button\n                                size=\"sm\"\n                                onClick={() => processRunMutation.mutate(run.id)}\n                                disabled={processRunMutation.isPending}\n                                data-testid={`button-process-${run.id}`}\n                              >\n                                <Play className=\"h-3 w-3 mr-1\" />\n                                Process\n                              </Button>\n                            )}\n                            {run.status === \"processing\" && (\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => finalizeRunMutation.mutate(run.id)}\n                                disabled={finalizeRunMutation.isPending}\n                                data-testid={`button-finalize-${run.id}`}\n                              >\n                                <Lock className=\"h-3 w-3 mr-1\" />\n                                Finalize\n                              </Button>\n                            )}\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              ) : (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">\n                  No payroll runs created yet. Create one to get started.\n                </p>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"payslips\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Payslips</CardTitle>\n              <CardDescription>\n                View and manage employee payslips with detailed breakdowns\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {payslipsLoading ? (\n                <div className=\"space-y-2\">\n                  <Skeleton className=\"h-12 w-full\" />\n                  <Skeleton className=\"h-12 w-full\" />\n                  <Skeleton className=\"h-12 w-full\" />\n                </div>\n              ) : payslips && payslips.length > 0 ? (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Employee</TableHead>\n                      <TableHead>Period</TableHead>\n                      <TableHead>Site</TableHead>\n                      <TableHead className=\"text-right\">Gross Pay</TableHead>\n                      <TableHead className=\"text-right\">Deductions</TableHead>\n                      <TableHead className=\"text-right\">Net Pay</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {payslips.map((payslip) => (\n                      <TableRow key={payslip.id} data-testid={`row-payslip-${payslip.id}`}>\n                        <TableCell className=\"font-medium\" data-testid={`text-employee-${payslip.id}`}>\n                          {payslip.user.firstName} {payslip.user.lastName}\n                        </TableCell>\n                        <TableCell data-testid={`text-period-${payslip.id}`}>\n                          {payslip.payrollRun.period}\n                        </TableCell>\n                        <TableCell data-testid={`text-site-${payslip.id}`}>\n                          {payslip.site.name}\n                        </TableCell>\n                        <TableCell className=\"text-right\" data-testid={`text-gross-${payslip.id}`}>\n                          £{parseFloat(payslip.grossPay).toFixed(2)}\n                        </TableCell>\n                        <TableCell className=\"text-right\" data-testid={`text-deductions-${payslip.id}`}>\n                          £{parseFloat(payslip.deductions).toFixed(2)}\n                        </TableCell>\n                        <TableCell className=\"text-right font-semibold\" data-testid={`text-net-${payslip.id}`}>\n                          £{parseFloat(payslip.netPay).toFixed(2)}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex gap-2 justify-end\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => {\n                                setSelectedPayslip(payslip);\n                                setDetailDialogOpen(true);\n                              }}\n                              data-testid={`button-view-${payslip.id}`}\n                            >\n                              <Eye className=\"h-3 w-3 mr-1\" />\n                              View\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => {\n                                setSelectedPayslip(payslip);\n                                setDeductionDialogOpen(true);\n                              }}\n                              data-testid={`button-add-deduction-${payslip.id}`}\n                            >\n                              <Plus className=\"h-3 w-3 mr-1\" />\n                              Deduction\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              ) : (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">\n                  No payslips generated yet. Process a payroll run to generate payslips.\n                </p>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      <Dialog open={createDialogOpen} onOpenChange={setCreateDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Create Payroll Run</DialogTitle>\n            <DialogDescription>\n              Create a new payroll run for a specific date range\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...createForm}>\n            <form onSubmit={createForm.handleSubmit(onCreateSubmit)} className=\"space-y-4\">\n              <FormField\n                control={createForm.control}\n                name=\"startDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Start Date</FormLabel>\n                    <FormControl>\n                      <Input type=\"date\" {...field} data-testid=\"input-start-date\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={createForm.control}\n                name=\"endDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>End Date</FormLabel>\n                    <FormControl>\n                      <Input type=\"date\" {...field} data-testid=\"input-end-date\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setCreateDialogOpen(false)}\n                  data-testid=\"button-cancel-create\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createRunMutation.isPending}\n                  data-testid=\"button-submit-create\"\n                >\n                  Create\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={detailDialogOpen} onOpenChange={setDetailDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Payslip Details</DialogTitle>\n            <DialogDescription>\n              Detailed breakdown of earnings and deductions\n            </DialogDescription>\n          </DialogHeader>\n          {selectedPayslip && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Employee</p>\n                  <p className=\"font-medium\">\n                    {selectedPayslip.user.firstName} {selectedPayslip.user.lastName}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Period</p>\n                  <p className=\"font-medium\">{selectedPayslip.payrollRun.period}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Site</p>\n                  <p className=\"font-medium\">{selectedPayslip.site.name}</p>\n                </div>\n              </div>\n\n              <div className=\"border rounded-md\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Description</TableHead>\n                      <TableHead className=\"text-right\">Hours</TableHead>\n                      <TableHead className=\"text-right\">Rate</TableHead>\n                      <TableHead className=\"text-right\">Amount</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {selectedPayslip.lineItems.map((item) => (\n                      <TableRow key={item.id}>\n                        <TableCell>\n                          {item.description}\n                          {item.type === \"overtime\" && (\n                            <Badge variant=\"secondary\" className=\"ml-2\">1.5x</Badge>\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          {item.hours ? parseFloat(item.hours).toFixed(2) : \"-\"}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          {item.rate ? `£${parseFloat(item.rate).toFixed(2)}` : \"-\"}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          £{Math.abs(parseFloat(item.amount)).toFixed(2)}\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                    <TableRow className=\"border-t-2\">\n                      <TableCell colSpan={3} className=\"font-semibold\">Gross Pay</TableCell>\n                      <TableCell className=\"text-right font-semibold\">\n                        £{parseFloat(selectedPayslip.grossPay).toFixed(2)}\n                      </TableCell>\n                    </TableRow>\n                    <TableRow>\n                      <TableCell colSpan={3} className=\"font-semibold\">Deductions</TableCell>\n                      <TableCell className=\"text-right font-semibold\">\n                        £{parseFloat(selectedPayslip.deductions).toFixed(2)}\n                      </TableCell>\n                    </TableRow>\n                    <TableRow className=\"border-t-2\">\n                      <TableCell colSpan={3} className=\"font-bold text-lg\">Net Pay</TableCell>\n                      <TableCell className=\"text-right font-bold text-lg\">\n                        £{parseFloat(selectedPayslip.netPay).toFixed(2)}\n                      </TableCell>\n                    </TableRow>\n                  </TableBody>\n                </Table>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setDetailDialogOpen(false)}\n              data-testid=\"button-close-detail\"\n            >\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={deductionDialogOpen} onOpenChange={setDeductionDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Add Deduction</DialogTitle>\n            <DialogDescription>\n              Add a deduction to this payslip\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...deductionForm}>\n            <form onSubmit={deductionForm.handleSubmit(onDeductionSubmit)} className=\"space-y-4\">\n              <FormField\n                control={deductionForm.control}\n                name=\"type\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Type</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"e.g., tax, loan, advance\" data-testid=\"input-deduction-type\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={deductionForm.control}\n                name=\"reason\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Reason</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"Reason for deduction\" data-testid=\"input-deduction-reason\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={deductionForm.control}\n                name=\"amount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Amount (£)</FormLabel>\n                    <FormControl>\n                      <Input type=\"number\" step=\"0.01\" {...field} placeholder=\"0.00\" data-testid=\"input-deduction-amount\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setDeductionDialogOpen(false)}\n                  data-testid=\"button-cancel-deduction\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={addDeductionMutation.isPending}\n                  data-testid=\"button-submit-deduction\"\n                >\n                  Add Deduction\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":24416},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/pages/attendance.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { AttendanceRow } from \"@/components/attendance-row\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Input } from \"@/components/ui/input\";\nimport { Search, Download, Calendar } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Calendar as CalendarComponent } from \"@/components/ui/calendar\";\nimport { format } from \"date-fns\";\n\ninterface AttendanceRecord {\n  id: number;\n  userId: string;\n  siteId: number;\n  shiftId: number | null;\n  date: string;\n  clockIn: string;\n  clockOut: string | null;\n  approvalStatus: string;\n  approvedBy: string | null;\n  approvedAt: string | null;\n  notes: string | null;\n  duration: string | null;\n  user: {\n    id: string;\n    firstName: string | null;\n    lastName: string | null;\n    email: string | null;\n  };\n  site: {\n    id: number;\n    name: string;\n    color: string;\n  };\n}\n\nexport default function Attendance() {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [dateRange, setDateRange] = useState<{ from?: Date; to?: Date }>({});\n\n  // Fetch all attendance records\n  const { data: allAttendance = [], isLoading } = useQuery<AttendanceRecord[]>({\n    queryKey: [\"/api/attendance\"],\n  });\n\n  // Filter records based on search query\n  const filteredAttendance = useMemo(() => {\n    if (!searchQuery) return allAttendance;\n    \n    const query = searchQuery.toLowerCase();\n    return allAttendance.filter(record => {\n      const fullName = `${record.user.firstName || ''} ${record.user.lastName || ''}`.toLowerCase();\n      const siteName = record.site.name.toLowerCase();\n      return fullName.includes(query) || siteName.includes(query);\n    });\n  }, [allAttendance, searchQuery]);\n\n  // Live tab: Currently clocked in (no clockOut)\n  const liveAttendance = useMemo(() => {\n    return filteredAttendance.filter(record => !record.clockOut);\n  }, [filteredAttendance]);\n\n  // Pending Approvals tab: Has clockOut and status is 'pending'\n  const pendingApprovals = useMemo(() => {\n    return filteredAttendance.filter(\n      record => record.clockOut && record.approvalStatus === 'pending'\n    );\n  }, [filteredAttendance]);\n\n  // History tab: approved or rejected records\n  const historyRecords = useMemo(() => {\n    let records = filteredAttendance.filter(\n      record => record.approvalStatus === 'approved' || record.approvalStatus === 'rejected'\n    );\n\n    // Filter by date range if selected\n    if (dateRange.from) {\n      const fromDate = format(dateRange.from, 'yyyy-MM-dd');\n      records = records.filter(record => record.date >= fromDate);\n    }\n    if (dateRange.to) {\n      const toDate = format(dateRange.to, 'yyyy-MM-dd');\n      records = records.filter(record => record.date <= toDate);\n    }\n\n    return records;\n  }, [filteredAttendance, dateRange]);\n\n  // Approve attendance mutation\n  const approveMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"PATCH\", `/api/attendance/${id}/approve`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance\"] });\n      toast({\n        title: \"Attendance Approved\",\n        description: \"The attendance record has been approved successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to approve attendance\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Reject attendance mutation\n  const rejectMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"PATCH\", `/api/attendance/${id}/reject`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance\"] });\n      toast({\n        title: \"Attendance Rejected\",\n        description: \"The attendance record has been rejected.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to reject attendance\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleApprove = (id: number) => {\n    approveMutation.mutate(id);\n  };\n\n  const handleReject = (id: number) => {\n    rejectMutation.mutate(id);\n  };\n\n  const getInitials = (firstName: string | null, lastName: string | null) => {\n    const first = firstName?.charAt(0) || '';\n    const last = lastName?.charAt(0) || '';\n    return (first + last).toUpperCase() || '?';\n  };\n\n  const getFullName = (firstName: string | null, lastName: string | null) => {\n    return `${firstName || ''} ${lastName || ''}`.trim() || 'Unknown User';\n  };\n\n  // Determine status (on-time or late) by comparing with shift start time if available\n  const getStatus = (record: AttendanceRecord) => {\n    if (record.approvalStatus === 'approved') return 'approved' as const;\n    if (record.approvalStatus === 'rejected') return 'rejected' as const;\n    if (record.clockOut && record.approvalStatus === 'pending') return 'pending-approval' as const;\n    \n    // For live records, we could check if they're late based on shift time\n    // For now, assume on-time if no shift or if clockIn is reasonable\n    return 'on-time' as const;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">Attendance Tracking</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Real-time attendance monitoring and approvals\n          </p>\n        </div>\n        <Button variant=\"outline\" data-testid=\"button-export-attendance\">\n          <Download className=\"h-4 w-4 mr-2\" />\n          Export\n        </Button>\n      </div>\n\n      <div className=\"flex gap-2\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search staff...\"\n            className=\"pl-9\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            data-testid=\"input-search-staff\"\n          />\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"live\" className=\"w-full\">\n        <TabsList>\n          <TabsTrigger value=\"live\" data-testid=\"tab-live\">\n            Live ({liveAttendance.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"approvals\" data-testid=\"tab-approvals\">\n            Pending Approvals ({pendingApprovals.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"history\" data-testid=\"tab-history\">\n            History\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"live\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Currently Clocked In</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              {isLoading ? (\n                <div className=\"p-4 space-y-4\">\n                  <Skeleton className=\"h-16 w-full\" />\n                  <Skeleton className=\"h-16 w-full\" />\n                  <Skeleton className=\"h-16 w-full\" />\n                </div>\n              ) : liveAttendance.length === 0 ? (\n                <div className=\"p-8 text-center text-sm text-muted-foreground\">\n                  No staff currently clocked in\n                </div>\n              ) : (\n                liveAttendance.map((record) => (\n                  <AttendanceRow\n                    key={record.id}\n                    id={record.id.toString()}\n                    staffName={getFullName(record.user.firstName, record.user.lastName)}\n                    initials={getInitials(record.user.firstName, record.user.lastName)}\n                    site={record.site.name}\n                    clockIn={record.clockIn}\n                    clockOut={record.clockOut || undefined}\n                    status={getStatus(record)}\n                    duration={record.duration || undefined}\n                  />\n                ))\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"approvals\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Requires Approval</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              {isLoading ? (\n                <div className=\"p-4 space-y-4\">\n                  <Skeleton className=\"h-16 w-full\" />\n                  <Skeleton className=\"h-16 w-full\" />\n                </div>\n              ) : pendingApprovals.length === 0 ? (\n                <div className=\"p-8 text-center text-sm text-muted-foreground\">\n                  No attendance records pending approval\n                </div>\n              ) : (\n                pendingApprovals.map((record) => (\n                  <AttendanceRow\n                    key={record.id}\n                    id={record.id.toString()}\n                    staffName={getFullName(record.user.firstName, record.user.lastName)}\n                    initials={getInitials(record.user.firstName, record.user.lastName)}\n                    site={record.site.name}\n                    clockIn={record.clockIn}\n                    clockOut={record.clockOut || undefined}\n                    status={getStatus(record)}\n                    duration={record.duration || undefined}\n                    onApprove={() => handleApprove(record.id)}\n                    onReject={() => handleReject(record.id)}\n                  />\n                ))\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"history\" className=\"mt-6\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-4\">\n              <CardTitle>Attendance History</CardTitle>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"outline\" size=\"sm\" data-testid=\"button-select-date-range\">\n                    <Calendar className=\"h-4 w-4 mr-2\" />\n                    {dateRange.from ? (\n                      dateRange.to ? (\n                        <>\n                          {format(dateRange.from, 'MMM dd')} - {format(dateRange.to, 'MMM dd')}\n                        </>\n                      ) : (\n                        format(dateRange.from, 'MMM dd, yyyy')\n                      )\n                    ) : (\n                      'Select dates'\n                    )}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"end\">\n                  <CalendarComponent\n                    mode=\"range\"\n                    selected={{ from: dateRange.from, to: dateRange.to }}\n                    onSelect={(range: any) => setDateRange(range || {})}\n                    numberOfMonths={2}\n                  />\n                </PopoverContent>\n              </Popover>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              {isLoading ? (\n                <div className=\"p-4 space-y-4\">\n                  <Skeleton className=\"h-16 w-full\" />\n                  <Skeleton className=\"h-16 w-full\" />\n                  <Skeleton className=\"h-16 w-full\" />\n                </div>\n              ) : historyRecords.length === 0 ? (\n                <div className=\"p-8 text-center text-sm text-muted-foreground\">\n                  {dateRange.from \n                    ? 'No attendance records found for the selected date range'\n                    : 'Select a date range to view historical attendance records'\n                  }\n                </div>\n              ) : (\n                historyRecords.map((record) => (\n                  <AttendanceRow\n                    key={record.id}\n                    id={record.id.toString()}\n                    staffName={getFullName(record.user.firstName, record.user.lastName)}\n                    initials={getInitials(record.user.firstName, record.user.lastName)}\n                    site={record.site.name}\n                    clockIn={record.clockIn}\n                    clockOut={record.clockOut || undefined}\n                    status={getStatus(record)}\n                    duration={record.duration || undefined}\n                  />\n                ))\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","size_bytes":12806},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/examples/app-sidebar.tsx":{"content":"import { AppSidebar } from \"../app-sidebar\";\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\nimport { ThemeProvider } from \"@/lib/theme-provider\";\n\nexport default function AppSidebarExample() {\n  return (\n    <ThemeProvider>\n      <SidebarProvider>\n        <div className=\"flex h-screen w-full\">\n          <AppSidebar />\n          <div className=\"flex-1 p-4\">\n            <p className=\"text-sm text-muted-foreground\">Main content area</p>\n          </div>\n        </div>\n      </SidebarProvider>\n    </ThemeProvider>\n  );\n}\n","size_bytes":535},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/payslip-card.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ChevronRight, Download } from \"lucide-react\";\nimport { useState } from \"react\";\n\ninterface PayslipLineItem {\n  id: string;\n  description: string;\n  type: \"earning\" | \"deduction\";\n  hours?: number;\n  rate?: number;\n  amount: number;\n  reason?: string;\n}\n\ninterface PayslipCardProps {\n  id: string;\n  period: string;\n  site: string;\n  grossPay: number;\n  deductions: number;\n  netPay: number;\n  lineItems: PayslipLineItem[];\n  onDownload?: () => void;\n}\n\nexport function PayslipCard({\n  id,\n  period,\n  site,\n  grossPay,\n  deductions,\n  netPay,\n  lineItems,\n  onDownload,\n}: PayslipCardProps) {\n  const [expanded, setExpanded] = useState(false);\n\n  return (\n    <Card data-testid={`payslip-card-${id}`}>\n      <CardHeader>\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <CardTitle className=\"text-base\">{period}</CardTitle>\n            <p className=\"text-sm text-muted-foreground mt-1\">{site}</p>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onDownload}\n            data-testid={`button-download-${id}`}\n          >\n            <Download className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-3\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-sm text-muted-foreground\">Gross Pay</span>\n            <span className=\"font-mono font-medium\">£{grossPay.toFixed(2)}</span>\n          </div>\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-sm text-muted-foreground\">Deductions</span>\n            <span className=\"font-mono font-medium text-destructive\">\n              -£{deductions.toFixed(2)}\n            </span>\n          </div>\n          <div className=\"border-t pt-3 flex justify-between items-center\">\n            <span className=\"font-medium\">Net Pay</span>\n            <span className=\"font-mono font-bold text-lg text-chart-5\">\n              £{netPay.toFixed(2)}\n            </span>\n          </div>\n\n          <Button\n            variant=\"ghost\"\n            className=\"w-full justify-between\"\n            onClick={() => setExpanded(!expanded)}\n            data-testid={`button-expand-${id}`}\n          >\n            <span className=\"text-sm\">View Breakdown</span>\n            <ChevronRight\n              className={`h-4 w-4 transition-transform ${expanded ? \"rotate-90\" : \"\"}`}\n            />\n          </Button>\n\n          {expanded && (\n            <div className=\"space-y-2 pt-2 border-t\">\n              <div className=\"space-y-1\">\n                <p className=\"text-xs font-medium text-muted-foreground\">Earnings</p>\n                {lineItems\n                  .filter((item) => item.type === \"earning\")\n                  .map((item) => (\n                    <div key={item.id} className=\"flex justify-between text-sm\">\n                      <div>\n                        <p>{item.description}</p>\n                        {item.hours && item.rate && (\n                          <p className=\"text-xs text-muted-foreground font-mono\">\n                            {item.hours}h × £{item.rate}/h\n                          </p>\n                        )}\n                      </div>\n                      <span className=\"font-mono\">£{item.amount.toFixed(2)}</span>\n                    </div>\n                  ))}\n              </div>\n              <div className=\"space-y-1 pt-2\">\n                <p className=\"text-xs font-medium text-muted-foreground\">Deductions</p>\n                {lineItems\n                  .filter((item) => item.type === \"deduction\")\n                  .map((item) => (\n                    <div key={item.id} className=\"flex justify-between text-sm\">\n                      <div>\n                        <p>{item.description}</p>\n                        {item.reason && (\n                          <p className=\"text-xs text-muted-foreground\">{item.reason}</p>\n                        )}\n                      </div>\n                      <span className=\"font-mono text-destructive\">\n                        -£{item.amount.toFixed(2)}\n                      </span>\n                    </div>\n                  ))}\n              </div>\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4519},"client/src/components/examples/shift-card.tsx":{"content":"import { ShiftCard } from \"../shift-card\";\n\nexport default function ShiftCardExample() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4\">\n      <ShiftCard\n        id=\"1\"\n        staffName=\"Sarah Johnson\"\n        role=\"Care Assistant\"\n        site=\"Kent\"\n        siteColor=\"purple\"\n        startTime=\"08:00\"\n        endTime=\"16:00\"\n        status=\"scheduled\"\n        duration=\"8h\"\n      />\n      <ShiftCard\n        id=\"2\"\n        staffName=\"Mike Chen\"\n        role=\"Senior Care\"\n        site=\"London\"\n        siteColor=\"teal\"\n        startTime=\"14:00\"\n        endTime=\"22:00\"\n        status=\"in-progress\"\n        duration=\"8h\"\n      />\n      <ShiftCard\n        id=\"3\"\n        staffName=\"Emma Wilson\"\n        role=\"Nurse\"\n        site=\"Essex\"\n        siteColor=\"orange\"\n        startTime=\"22:00\"\n        endTime=\"06:00\"\n        status=\"conflict\"\n        duration=\"8h\"\n      />\n    </div>\n  );\n}\n","size_bytes":934},"client/src/components/role-redirect.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Redirect } from \"wouter\";\nimport type { User } from \"@shared/schema\";\n\ninterface RoleRedirectProps {\n  adminComponent: React.ComponentType;\n  workerRedirect?: string;\n}\n\nexport function RoleRedirect({ adminComponent: AdminComponent, workerRedirect = \"/worker\" }: RoleRedirectProps) {\n  const { data: user, isLoading } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-screen\">\n        <div className=\"text-center\">\n          <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Redirect workers to their mobile interface\n  if (user?.role === \"worker\") {\n    return <Redirect to={workerRedirect} />;\n  }\n\n  // Show admin component for admins and site managers\n  return <AdminComponent />;\n}\n","size_bytes":1018},"client/src/pages/login.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Building2, UserCircle } from \"lucide-react\";\n\nexport default function Login() {\n  const handleLogin = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center space-y-4\">\n          <div className=\"mx-auto w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center\">\n            <Building2 className=\"w-8 h-8 text-primary\" />\n          </div>\n          <div>\n            <CardTitle className=\"text-2xl\">Workforce Management</CardTitle>\n            <CardDescription className=\"text-base mt-2\">\n              Kent • London • Essex Care Sites\n            </CardDescription>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"text-center text-sm text-muted-foreground\">\n            Sign in to access your schedule, attendance, payroll, and more\n          </div>\n          \n          <Button \n            onClick={handleLogin}\n            className=\"w-full h-12 text-base\"\n            data-testid=\"button-login\"\n          >\n            <UserCircle className=\"mr-2 h-5 w-5\" />\n            Login with Replit\n          </Button>\n\n          <div className=\"text-xs text-center text-muted-foreground space-y-1\">\n            <p>Staff will see their mobile interface</p>\n            <p>Admins and managers will see the management dashboard</p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":1697},"client/src/components/auth-wrapper.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Redirect } from \"wouter\";\nimport type { User } from \"@shared/schema\";\n\ninterface AuthWrapperProps {\n  children: React.ReactNode;\n  loginPath?: string;\n}\n\nexport function AuthWrapper({ children, loginPath = \"/login\" }: AuthWrapperProps) {\n  const { data: user, isLoading, error } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-screen\">\n        <div className=\"text-center\">\n          <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // If not authenticated (401 error), redirect to login\n  if (error || !user) {\n    return <Redirect to={loginPath} />;\n  }\n\n  // User is authenticated, show the children\n  return <>{children}</>;\n}\n","size_bytes":980}},"version":2}